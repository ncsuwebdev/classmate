//mootools base javascript (moo.base.js), cnet.base.js, cnet.global.utils.js
//see readme.txt in parent directory for details
//dbugScripts - will include non-compressed versions of this code if "jsdebug=true" is in the url of this page,
//otherwise it will execute this code.
//example: dbugScripts("/the/location/of/my/scripts/",["script1.js","script2.js","etc"])
//returns true if scripts are included, otherwise false.
function dbugScripts(baseurl,libs){var value=document.cookie.match('(?:^|;)\\s*jsdebug=([^;]*)');var debugCookie=value?unescape(value[1]):false;if(window.location.href.indexOf("basePath=this")>0){var path=baseurl.substring(baseurl.substring(7,baseurl.length).indexOf("/")+8,baseurl.length);var href=window.location.href;baseurl=href.substring(href.substring(7,href.length).indexOf("/")+8,href.length)}if(window.location.href.indexOf("jsdebug=true")>0||window.location.href.indexOf("jsdebugCookie=true")>0||debugCookie=='true'){for(i=0;i<libs.length;i++){document.write("<scri"+"pt src=\""+baseurl+libs[i]+"\" type=\"text/javascript\"></script>")}return true}return false};
if(!dbugScripts("http://clientside.cnet.com/wp-content/themes/clientsidev2/js/",["clientside.moo.v1.1.js", "Debugger.cnet.js"])){
/*	clientside.moo.v1.1.packed.js - packed	*/

var dbug={logged:[],timers:{},firebug:false,debug:false,log:function(){dbug.logged.push(arguments)},nolog:function(msg){dbug.logged.push(arguments)},time:function(name){dbug.timers[name]=new Date().getTime()},timeEnd:function(name){if(dbug.timers[name]){var end=new Date().getTime()-dbug.timers[name];dbug.timers[name]=false;dbug.log('%s: %s',name,end)}else dbug.log('no such timer: %s',name)},enable:function(){if(dbug.firebug){try{dbug.debug=true;dbug.log=console.debug||console.log;dbug.time=console.time;dbug.timeEnd=console.timeEnd;dbug.log('enabling dbug');for(var i=0;i<dbug.logged.length;i++){dbug.log.apply(console,dbug.logged[i])}dbug.logged=[]}catch(e){dbug.enable.delay(400)}}},disable:function(){if(dbug.firebug)dbug.debug=false;dbug.log=dbug.nolog;dbug.time=function(){};dbug.timeEnd=function(){}},cookie:function(set){var value=document.cookie.match('(?:^|;)\\s*jsdebug=([^;]*)');var debugCookie=value?unescape(value[1]):false;if((debugCookie!='true'||set)&&!set){dbug.enable();dbug.log('setting debugging cookie');var date=new Date();date.setTime(date.getTime()+(24*60*60*1000));document.cookie='jsdebug=true;expires='+date.toGMTString()}else dbug.disableCookie()},disableCookie:function(){dbug.log('disabling debugging cookie');document.cookie='jsdebug=false'}};dbug.setMethods=function(){var fb=typeof console!="undefined";var debugMethods=['debug','info','warn','error','assert','dir','dirxml'];var otherMethods=['trace','group','groupEnd','profile','profileEnd','count'];function set(methodList,defaultFunction){for(var i=0;i<methodList.length;i++){dbug[methodList[i]]=(fb&&console[methodList[i]])?console[methodList[i]]:defaultFunction}};set(debugMethods,dbug.log);set(otherMethods,function(){})};dbug.setMethods();if(typeof console!="undefined"&&console.warn){dbug.firebug=true;var value=document.cookie.match('(?:^|;)\\s*jsdebug=([^;]*)');var debugCookie=value?unescape(value[1]):false;if(window.location.href.indexOf("jsdebug=true")>0||debugCookie=='true')dbug.enable();if(debugCookie=='true')dbug.log('debugging cookie enabled');if(window.location.href.indexOf("jsdebugCookie=true")>0){dbug.cookie();if(!dbug.debug)dbug.enable()}if(window.location.href.indexOf("jsdebugCookie=false")>0)dbug.disableCookie()}var MooTools={version:'1.11'};function $defined(obj){return(obj!=undefined)};function $type(obj){if(!$defined(obj))return false;if(obj.htmlElement)return'element';var type=typeof obj;if(type=='object'&&obj.nodeName){switch(obj.nodeType){case 1:return'element';case 3:return(/\S/).test(obj.nodeValue)?'textnode':'whitespace'}}if(type=='object'||type=='function'){switch(obj.constructor){case Array:return'array';case RegExp:return'regexp';case Class:return'class'}if(typeof obj.length=='number'){if(obj.item)return'collection';if(obj.callee)return'arguments'}}return type};function $merge(){var mix={};for(var i=0;i<arguments.length;i++){for(var property in arguments[i]){var ap=arguments[i][property];var mp=mix[property];if(mp&&$type(ap)=='object'&&$type(mp)=='object')mix[property]=$merge(mp,ap);else mix[property]=ap}}return mix};var $extend=function(){var args=arguments;if(!args[1])args=[this,args[0]];for(var property in args[1])args[0][property]=args[1][property];return args[0]};var $native=function(){for(var i=0,l=arguments.length;i<l;i++){arguments[i].extend=function(props){for(var prop in props){if(!this.prototype[prop])this.prototype[prop]=props[prop];if(!this[prop])this[prop]=$native.generic(prop)}}}};$native.generic=function(prop){return function(bind){return this.prototype[prop].apply(bind,Array.prototype.slice.call(arguments,1))}};$native(Function,Array,String,Number);function $chk(obj){return!!(obj||obj===0)};function $pick(obj,picked){return $defined(obj)?obj:picked};function $random(min,max){return Math.floor(Math.random()*(max-min+1)+min)};function $time(){return new Date().getTime()};function $clear(timer){clearTimeout(timer);clearInterval(timer);return null};var Abstract=function(obj){obj=obj||{};obj.extend=$extend;return obj};var Window=new Abstract(window);var Document=new Abstract(document);document.head=document.getElementsByTagName('head')[0];window.xpath=!!(document.evaluate);if(window.ActiveXObject)window.ie=window[window.XMLHttpRequest?'ie7':'ie6']=true;else if(document.childNodes&&!document.all&&!navigator.taintEnabled)window.webkit=window[window.xpath?'webkit420':'webkit419']=true;else if(document.getBoxObjectFor!=null)window.gecko=true;window.khtml=window.webkit;Object.extend=$extend;if(typeof HTMLElement=='undefined'){var HTMLElement=function(){};if(window.webkit)document.createElement("iframe");HTMLElement.prototype=(window.webkit)?window["[[DOMElement.prototype]]"]:{}}HTMLElement.prototype.htmlElement=function(){};if(window.ie6)try{document.execCommand("BackgroundImageCache",false,true)}catch(e){};var Class=function(properties){var klass=function(){return(arguments[0]!==null&&this.initialize&&$type(this.initialize)=='function')?this.initialize.apply(this,arguments):this};$extend(klass,this);klass.prototype=properties;klass.constructor=Class;return klass};Class.empty=function(){};Class.prototype={extend:function(properties){var proto=new this(null);for(var property in properties){var pp=proto[property];proto[property]=Class.Merge(pp,properties[property])}return new Class(proto)},implement:function(){for(var i=0,l=arguments.length;i<l;i++)$extend(this.prototype,arguments[i])}};Class.Merge=function(previous,current){if(previous&&previous!=current){var type=$type(current);if(type!=$type(previous))return current;switch(type){case'function':var merged=function(){this.parent=arguments.callee.parent;return current.apply(this,arguments)};merged.parent=previous;return merged;case'object':return $merge(previous,current)}}return current};var Chain=new Class({chain:function(fn){this.chains=this.chains||[];this.chains.push(fn);return this},callChain:function(){if(this.chains&&this.chains.length)this.chains.shift().delay(10,this)},clearChain:function(){this.chains=[]}});var Events=new Class({addEvent:function(type,fn){if(fn!=Class.empty){this.$events=this.$events||{};this.$events[type]=this.$events[type]||[];this.$events[type].include(fn)}return this},fireEvent:function(type,args,delay){if(this.$events&&this.$events[type]){this.$events[type].each(function(fn){fn.create({'bind':this,'delay':delay,'arguments':args})()},this)}return this},removeEvent:function(type,fn){if(this.$events&&this.$events[type])this.$events[type].remove(fn);return this}});var Options=new Class({setOptions:function(){this.options=$merge.apply(null,[this.options].extend(arguments));if(this.addEvent){for(var option in this.options){if($type(this.options[option]=='function')&&(/^on[A-Z]/).test(option))this.addEvent(option,this.options[option])}}return this}});Array.extend({forEach:function(fn,bind){for(var i=0,j=this.length;i<j;i++)fn.call(bind,this[i],i,this)},filter:function(fn,bind){var results=[];for(var i=0,j=this.length;i<j;i++){if(fn.call(bind,this[i],i,this))results.push(this[i])}return results},map:function(fn,bind){var results=[];for(var i=0,j=this.length;i<j;i++)results[i]=fn.call(bind,this[i],i,this);return results},every:function(fn,bind){for(var i=0,j=this.length;i<j;i++){if(!fn.call(bind,this[i],i,this))return false}return true},some:function(fn,bind){for(var i=0,j=this.length;i<j;i++){if(fn.call(bind,this[i],i,this))return true}return false},indexOf:function(item,from){var len=this.length;for(var i=(from<0)?Math.max(0,len+from):from||0;i<len;i++){if(this[i]===item)return i}return-1},copy:function(start,length){start=start||0;if(start<0)start=this.length+start;length=length||(this.length-start);var newArray=[];for(var i=0;i<length;i++)newArray[i]=this[start++];return newArray},remove:function(item){var i=0;var len=this.length;while(i<len){if(this[i]===item){this.splice(i,1);len--}else{i++}}return this},contains:function(item,from){return this.indexOf(item,from)!=-1},associate:function(keys){var obj={},length=Math.min(this.length,keys.length);for(var i=0;i<length;i++)obj[keys[i]]=this[i];return obj},extend:function(array){for(var i=0,j=array.length;i<j;i++)this.push(array[i]);return this},merge:function(array){for(var i=0,l=array.length;i<l;i++)this.include(array[i]);return this},include:function(item){if(!this.contains(item))this.push(item);return this},getRandom:function(){return this[$random(0,this.length-1)]||null},getLast:function(){return this[this.length-1]||null}});Array.prototype.each=Array.prototype.forEach;Array.each=Array.forEach;function $A(array){return Array.copy(array)};function $each(iterable,fn,bind){if(iterable&&typeof iterable.length=='number'&&$type(iterable)!='object'){Array.forEach(iterable,fn,bind)}else{for(var name in iterable)fn.call(bind||iterable,iterable[name],name)}};Array.prototype.test=Array.prototype.contains;String.extend({test:function(regex,params){return(($type(regex)=='string')?new RegExp(regex,params):regex).test(this)},toInt:function(){return parseInt(this,10)},toFloat:function(){return parseFloat(this)},camelCase:function(){return this.replace(/-\D/g,function(match){return match.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/\w[A-Z]/g,function(match){return(match.charAt(0)+'-'+match.charAt(1).toLowerCase())})},capitalize:function(){return this.replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},trim:function(){return this.replace(/^\s+|\s+$/g,'')},clean:function(){return this.replace(/\s{2,}/g,' ').trim()},rgbToHex:function(array){var rgb=this.match(/\d{1,3}/g);return(rgb)?rgb.rgbToHex(array):false},hexToRgb:function(array){var hex=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(hex)?hex.slice(1).hexToRgb(array):false},contains:function(string,s){return(s)?(s+this+s).indexOf(s+string+s)>-1:this.indexOf(string)>-1},escapeRegExp:function(){return this.replace(/([.*+?^${}()|[\]\/\\])/g,'\\$1')}});Array.extend({rgbToHex:function(array){if(this.length<3)return false;if(this.length==4&&this[3]==0&&!array)return'transparent';var hex=[];for(var i=0;i<3;i++){var bit=(this[i]-0).toString(16);hex.push((bit.length==1)?'0'+bit:bit)}return array?hex:'#'+hex.join('')},hexToRgb:function(array){if(this.length!=3)return false;var rgb=[];for(var i=0;i<3;i++){rgb.push(parseInt((this[i].length==1)?this[i]+this[i]:this[i],16))}return array?rgb:'rgb('+rgb.join(',')+')'}});Function.extend({create:function(options){var fn=this;options=$merge({'bind':fn,'event':false,'arguments':null,'delay':false,'periodical':false,'attempt':false},options);if($chk(options.arguments)&&$type(options.arguments)!='array')options.arguments=[options.arguments];return function(event){var args;if(options.event){event=event||window.event;args=[(options.event===true)?event:new options.event(event)];if(options.arguments)args.extend(options.arguments)}else args=options.arguments||arguments;var returns=function(){return fn.apply($pick(options.bind,fn),args)};if(options.delay)return setTimeout(returns,options.delay);if(options.periodical)return setInterval(returns,options.periodical);if(options.attempt)try{return returns()}catch(err){return false};return returns()}},pass:function(args,bind){return this.create({'arguments':args,'bind':bind})},attempt:function(args,bind){return this.create({'arguments':args,'bind':bind,'attempt':true})()},bind:function(bind,args){return this.create({'bind':bind,'arguments':args})},bindAsEventListener:function(bind,args){return this.create({'bind':bind,'event':true,'arguments':args})},delay:function(delay,bind,args){return this.create({'delay':delay,'bind':bind,'arguments':args})()},periodical:function(interval,bind,args){return this.create({'periodical':interval,'bind':bind,'arguments':args})()}});Number.extend({toInt:function(){return parseInt(this)},toFloat:function(){return parseFloat(this)},limit:function(min,max){return Math.min(max,Math.max(min,this))},round:function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision},times:function(fn){for(var i=0;i<this;i++)fn(i)}});var Element=new Class({initialize:function(el,props){if($type(el)=='string'){if(window.ie&&props&&(props.name||props.type)){var name=(props.name)?' name="'+props.name+'"':'';var type=(props.type)?' type="'+props.type+'"':'';delete props.name;delete props.type;el='<'+el+name+type+'>'}el=document.createElement(el)}el=$(el);return(!props||!el)?el:el.set(props)}});var Elements=new Class({initialize:function(elements){return(elements)?$extend(elements,this):this}});Elements.extend=function(props){for(var prop in props){this.prototype[prop]=props[prop];this[prop]=$native.generic(prop)}};function $(el){if(!el)return null;if(el.htmlElement)return Garbage.collect(el);if([window,document].contains(el))return el;var type=$type(el);if(type=='string'){el=document.getElementById(el);type=(el)?'element':false}if(type!='element')return null;if(el.htmlElement)return Garbage.collect(el);if(['object','embed'].contains(el.tagName.toLowerCase()))return el;$extend(el,Element.prototype);el.htmlElement=function(){};return Garbage.collect(el)};document.getElementsBySelector=document.getElementsByTagName;function $$(){var elements=[];for(var i=0,j=arguments.length;i<j;i++){var selector=arguments[i];switch($type(selector)){case'element':elements.push(selector);case'boolean':break;case false:break;case'string':selector=document.getElementsBySelector(selector,true);default:elements.extend(selector)}}return $$.unique(elements)};$$.unique=function(array){var elements=[];for(var i=0,l=array.length;i<l;i++){if(array[i].$included)continue;var element=$(array[i]);if(element&&!element.$included){element.$included=true;elements.push(element)}}for(var n=0,d=elements.length;n<d;n++)elements[n].$included=null;return new Elements(elements)};Elements.Multi=function(property){return function(){var args=arguments;var items=[];var elements=true;for(var i=0,j=this.length,returns;i<j;i++){returns=this[i][property].apply(this[i],args);if($type(returns)!='element')elements=false;items.push(returns)};return(elements)?$$.unique(items):items}};Element.extend=function(properties){for(var property in properties){HTMLElement.prototype[property]=properties[property];Element.prototype[property]=properties[property];Element[property]=$native.generic(property);var elementsProperty=(Array.prototype[property])?property+'Elements':property;Elements.prototype[elementsProperty]=Elements.Multi(property)}};Element.extend({set:function(props){for(var prop in props){var val=props[prop];switch(prop){case'styles':this.setStyles(val);break;case'events':if(this.addEvents)this.addEvents(val);break;case'properties':this.setProperties(val);break;default:this.setProperty(prop,val)}}return this},inject:function(el,where){el=$(el);switch(where){case'before':el.parentNode.insertBefore(this,el);break;case'after':var next=el.getNext();if(!next)el.parentNode.appendChild(this);else el.parentNode.insertBefore(this,next);break;case'top':var first=el.firstChild;if(first){el.insertBefore(this,first);break}default:el.appendChild(this)}return this},injectBefore:function(el){return this.inject(el,'before')},injectAfter:function(el){return this.inject(el,'after')},injectInside:function(el){return this.inject(el,'bottom')},injectTop:function(el){return this.inject(el,'top')},adopt:function(){var elements=[];$each(arguments,function(argument){elements=elements.concat(argument)});$$(elements).inject(this);return this},remove:function(){return this.parentNode.removeChild(this)},clone:function(contents){var el=$(this.cloneNode(contents!==false));if(!el.$events)return el;el.$events={};for(var type in this.$events)el.$events[type]={'keys':$A(this.$events[type].keys),'values':$A(this.$events[type].values)};return el.removeEvents()},replaceWith:function(el){el=$(el);this.parentNode.replaceChild(el,this);return el},appendText:function(text){this.appendChild(document.createTextNode(text));return this},hasClass:function(className){return this.className.contains(className,' ')},addClass:function(className){if(!this.hasClass(className))this.className=(this.className+' '+className).clean();return this},removeClass:function(className){this.className=this.className.replace(new RegExp('(^|\\s)'+className+'(?:\\s|$)'),'$1').clean();return this},toggleClass:function(className){return this.hasClass(className)?this.removeClass(className):this.addClass(className)},setStyle:function(property,value){switch(property){case'opacity':return this.setOpacity(parseFloat(value));case'float':property=(window.ie)?'styleFloat':'cssFloat'}property=property.camelCase();switch($type(value)){case'number':if(!['zIndex','zoom'].contains(property))value+='px';break;case'array':value='rgb('+value.join(',')+')'}this.style[property]=value;return this},setStyles:function(source){switch($type(source)){case'object':Element.setMany(this,'setStyle',source);break;case'string':this.style.cssText=source}return this},setOpacity:function(opacity){if(opacity==0){if(this.style.visibility!="hidden")this.style.visibility="hidden"}else{if(this.style.visibility!="visible")this.style.visibility="visible"}if(!this.currentStyle||!this.currentStyle.hasLayout)this.style.zoom=1;if(window.ie)this.style.filter=(opacity==1)?'':"alpha(opacity="+opacity*100+")";this.style.opacity=this.$tmp.opacity=opacity;return this},getStyle:function(property){property=property.camelCase();var result=this.style[property];if(!$chk(result)){if(property=='opacity')return this.$tmp.opacity;result=[];for(var style in Element.Styles){if(property==style){Element.Styles[style].each(function(s){var style=this.getStyle(s);result.push(parseInt(style)?style:'0px')},this);if(property=='border'){var every=result.every(function(bit){return(bit==result[0])});return(every)?result[0]:false}return result.join(' ')}}if(property.contains('border')){if(Element.Styles.border.contains(property)){return['Width','Style','Color'].map(function(p){return this.getStyle(property+p)},this).join(' ')}else if(Element.borderShort.contains(property)){return['Top','Right','Bottom','Left'].map(function(p){return this.getStyle('border'+p+property.replace('border',''))},this).join(' ')}}if(document.defaultView)result=document.defaultView.getComputedStyle(this,null).getPropertyValue(property.hyphenate());else if(this.currentStyle)result=this.currentStyle[property]}if(window.ie)result=Element.fixStyle(property,result,this);if(result&&property.test(/color/i)&&result.contains('rgb')){return result.split('rgb').splice(1,4).map(function(color){return color.rgbToHex()}).join(' ')}return result},getStyles:function(){return Element.getMany(this,'getStyle',arguments)},walk:function(brother,start){brother+='Sibling';var el=(start)?this[start]:this[brother];while(el&&$type(el)!='element')el=el[brother];return $(el)},getPrevious:function(){return this.walk('previous')},getNext:function(){return this.walk('next')},getFirst:function(){return this.walk('next','firstChild')},getLast:function(){return this.walk('previous','lastChild')},getParent:function(){return $(this.parentNode)},getChildren:function(){return $$(this.childNodes)},hasChild:function(el){return!!$A(this.getElementsByTagName('*')).contains(el)},getProperty:function(property){var index=Element.Properties[property];if(index)return this[index];var flag=Element.PropertiesIFlag[property]||0;if(!window.ie||flag)return this.getAttribute(property,flag);var node=this.attributes[property];return(node)?node.nodeValue:null},removeProperty:function(property){var index=Element.Properties[property];if(index)this[index]='';else this.removeAttribute(property);return this},getProperties:function(){return Element.getMany(this,'getProperty',arguments)},setProperty:function(property,value){var index=Element.Properties[property];if(index)this[index]=value;else this.setAttribute(property,value);return this},setProperties:function(source){return Element.setMany(this,'setProperty',source)},setHTML:function(){this.innerHTML=$A(arguments).join('');return this},setText:function(text){var tag=this.getTag();if(['style','script'].contains(tag)){if(window.ie){if(tag=='style')this.styleSheet.cssText=text;else if(tag=='script')this.setProperty('text',text);return this}else{if(this.firstChild)this.removeChild(this.firstChild);return this.appendText(text)}}this[$defined(this.innerText)?'innerText':'textContent']=text;return this},getText:function(){var tag=this.getTag();if(['style','script'].contains(tag)){if(window.ie){if(tag=='style')return this.styleSheet.cssText;else if(tag=='script')return this.getProperty('text')}else{return this.innerHTML}}return($pick(this.innerText,this.textContent))},getTag:function(){return this.tagName.toLowerCase()},empty:function(){Garbage.trash(this.getElementsByTagName('*'));return this.setHTML('')}});Element.fixStyle=function(property,result,element){if($chk(parseInt(result)))return result;if(['height','width'].contains(property)){var values=(property=='width')?['left','right']:['top','bottom'];var size=0;values.each(function(value){size+=element.getStyle('border-'+value+'-width').toInt()+element.getStyle('padding-'+value).toInt()});return element['offset'+property.capitalize()]-size+'px'}else if(property.test(/border(.+)Width|margin|padding/)){return'0px'}return result};Element.Styles={'border':[],'padding':[],'margin':[]};['Top','Right','Bottom','Left'].each(function(direction){for(var style in Element.Styles)Element.Styles[style].push(style+direction)});Element.borderShort=['borderWidth','borderStyle','borderColor'];Element.getMany=function(el,method,keys){var result={};$each(keys,function(key){result[key]=el[method](key)});return result};Element.setMany=function(el,method,pairs){for(var key in pairs)el[method](key,pairs[key]);return el};Element.Properties=new Abstract({'class':'className','for':'htmlFor','colspan':'colSpan','rowspan':'rowSpan','accesskey':'accessKey','tabindex':'tabIndex','maxlength':'maxLength','readonly':'readOnly','frameborder':'frameBorder','value':'value','disabled':'disabled','checked':'checked','multiple':'multiple','selected':'selected'});Element.PropertiesIFlag={'href':2,'src':2};Element.Methods={Listeners:{addListener:function(type,fn){if(this.addEventListener)this.addEventListener(type,fn,false);else this.attachEvent('on'+type,fn);return this},removeListener:function(type,fn){if(this.removeEventListener)this.removeEventListener(type,fn,false);else this.detachEvent('on'+type,fn);return this}}};window.extend(Element.Methods.Listeners);document.extend(Element.Methods.Listeners);Element.extend(Element.Methods.Listeners);var Garbage={elements:[],collect:function(el){if(!el.$tmp){Garbage.elements.push(el);el.$tmp={'opacity':1}}return el},trash:function(elements){for(var i=0,j=elements.length,el;i<j;i++){if(!(el=elements[i])||!el.$tmp)continue;if(el.$events)el.fireEvent('trash').removeEvents();for(var p in el.$tmp)el.$tmp[p]=null;for(var d in Element.prototype)el[d]=null;Garbage.elements[Garbage.elements.indexOf(el)]=null;el.htmlElement=el.$tmp=el=null}Garbage.elements.remove(null)},empty:function(){Garbage.collect(window);Garbage.collect(document);Garbage.trash(Garbage.elements)}};window.addListener('beforeunload',function(){window.addListener('unload',Garbage.empty);if(window.ie)window.addListener('unload',CollectGarbage)});var Event=new Class({initialize:function(event){if(event&&event.$extended)return event;this.$extended=true;event=event||window.event;this.event=event;this.type=event.type;this.target=event.target||event.srcElement;if(this.target.nodeType==3)this.target=this.target.parentNode;this.shift=event.shiftKey;this.control=event.ctrlKey;this.alt=event.altKey;this.meta=event.metaKey;if(['DOMMouseScroll','mousewheel'].contains(this.type)){this.wheel=(event.wheelDelta)?event.wheelDelta/120:-(event.detail||0)/3}else if(this.type.contains('key')){this.code=event.which||event.keyCode;for(var name in Event.keys){if(Event.keys[name]==this.code){this.key=name;break}}if(this.type=='keydown'){var fKey=this.code-111;if(fKey>0&&fKey<13)this.key='f'+fKey}this.key=this.key||String.fromCharCode(this.code).toLowerCase()}else if(this.type.test(/(click|mouse|menu)/)){this.page={'x':event.pageX||event.clientX+document.documentElement.scrollLeft,'y':event.pageY||event.clientY+document.documentElement.scrollTop};this.client={'x':event.pageX?event.pageX-window.pageXOffset:event.clientX,'y':event.pageY?event.pageY-window.pageYOffset:event.clientY};this.rightClick=(event.which==3)||(event.button==2);switch(this.type){case'mouseover':this.relatedTarget=event.relatedTarget||event.fromElement;break;case'mouseout':this.relatedTarget=event.relatedTarget||event.toElement}this.fixRelatedTarget()}return this},stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){if(this.event.stopPropagation)this.event.stopPropagation();else this.event.cancelBubble=true;return this},preventDefault:function(){if(this.event.preventDefault)this.event.preventDefault();else this.event.returnValue=false;return this}});Event.fix={relatedTarget:function(){if(this.relatedTarget&&this.relatedTarget.nodeType==3)this.relatedTarget=this.relatedTarget.parentNode},relatedTargetGecko:function(){try{Event.fix.relatedTarget.call(this)}catch(e){this.relatedTarget=this.target}}};Event.prototype.fixRelatedTarget=(window.gecko)?Event.fix.relatedTargetGecko:Event.fix.relatedTarget;Event.keys=new Abstract({'enter':13,'up':38,'down':40,'left':37,'right':39,'esc':27,'space':32,'backspace':8,'tab':9,'delete':46});Element.Methods.Events={addEvent:function(type,fn){this.$events=this.$events||{};this.$events[type]=this.$events[type]||{'keys':[],'values':[]};if(this.$events[type].keys.contains(fn))return this;this.$events[type].keys.push(fn);var realType=type;var custom=Element.Events[type];if(custom){if(custom.add)custom.add.call(this,fn);if(custom.map)fn=custom.map;if(custom.type)realType=custom.type}if(!this.addEventListener)fn=fn.create({'bind':this,'event':true});this.$events[type].values.push(fn);return(Element.NativeEvents.contains(realType))?this.addListener(realType,fn):this},removeEvent:function(type,fn){if(!this.$events||!this.$events[type])return this;var pos=this.$events[type].keys.indexOf(fn);if(pos==-1)return this;var key=this.$events[type].keys.splice(pos,1)[0];var value=this.$events[type].values.splice(pos,1)[0];var custom=Element.Events[type];if(custom){if(custom.remove)custom.remove.call(this,fn);if(custom.type)type=custom.type}return(Element.NativeEvents.contains(type))?this.removeListener(type,value):this},addEvents:function(source){return Element.setMany(this,'addEvent',source)},removeEvents:function(type){if(!this.$events)return this;if(!type){for(var evType in this.$events)this.removeEvents(evType);this.$events=null}else if(this.$events[type]){this.$events[type].keys.each(function(fn){this.removeEvent(type,fn)},this);this.$events[type]=null}return this},fireEvent:function(type,args,delay){if(this.$events&&this.$events[type]){this.$events[type].keys.each(function(fn){fn.create({'bind':this,'delay':delay,'arguments':args})()},this)}return this},cloneEvents:function(from,type){if(!from.$events)return this;if(!type){for(var evType in from.$events)this.cloneEvents(from,evType)}else if(from.$events[type]){from.$events[type].keys.each(function(fn){this.addEvent(type,fn)},this)}return this}};window.extend(Element.Methods.Events);document.extend(Element.Methods.Events);Element.extend(Element.Methods.Events);Element.Events=new Abstract({'mouseenter':{type:'mouseover',map:function(event){event=new Event(event);if(event.relatedTarget!=this&&!this.hasChild(event.relatedTarget))this.fireEvent('mouseenter',event)}},'mouseleave':{type:'mouseout',map:function(event){event=new Event(event);if(event.relatedTarget!=this&&!this.hasChild(event.relatedTarget))this.fireEvent('mouseleave',event)}},'mousewheel':{type:(window.gecko)?'DOMMouseScroll':'mousewheel'}});Element.NativeEvents=['click','dblclick','mouseup','mousedown','mousewheel','DOMMouseScroll','mouseover','mouseout','mousemove','keydown','keypress','keyup','load','unload','beforeunload','resize','move','focus','blur','change','submit','reset','select','error','abort','contextmenu','scroll'];Function.extend({bindWithEvent:function(bind,args){return this.create({'bind':bind,'arguments':args,'event':Event})}});Elements.extend({filterByTag:function(tag){return new Elements(this.filter(function(el){return(Element.getTag(el)==tag)}))},filterByClass:function(className,nocash){var elements=this.filter(function(el){return(el.className&&el.className.contains(className,' '))});return(nocash)?elements:new Elements(elements)},filterById:function(id,nocash){var elements=this.filter(function(el){return(el.id==id)});return(nocash)?elements:new Elements(elements)},filterByAttribute:function(name,operator,value,nocash){var elements=this.filter(function(el){var current=Element.getProperty(el,name);if(!current)return false;if(!operator)return true;switch(operator){case'=':return(current==value);case'*=':return(current.contains(value));case'^=':return(current.substr(0,value.length)==value);case'$=':return(current.substr(current.length-value.length)==value);case'!=':return(current!=value);case'~=':return current.contains(value,' ')}return false});return(nocash)?elements:new Elements(elements)}});function $E(selector,filter){return($(filter)||document).getElement(selector)};function $ES(selector,filter){return($(filter)||document).getElementsBySelector(selector)};$$.shared={'regexp':/^(\w*|\*)(?:#([\w-]+)|\.([\w-]+))?(?:\[(\w+)(?:([!*^$]?=)["']?([^"'\]]*)["']?)?])?$/,'xpath':{getParam:function(items,context,param,i){var temp=[context.namespaceURI?'xhtml:':'',param[1]];if(param[2])temp.push('[@id="',param[2],'"]');if(param[3])temp.push('[contains(concat(" ", @class, " "), " ',param[3],' ")]');if(param[4]){if(param[5]&&param[6]){switch(param[5]){case'*=':temp.push('[contains(@',param[4],', "',param[6],'")]');break;case'^=':temp.push('[starts-with(@',param[4],', "',param[6],'")]');break;case'$=':temp.push('[substring(@',param[4],', string-length(@',param[4],') - ',param[6].length,' + 1) = "',param[6],'"]');break;case'=':temp.push('[@',param[4],'="',param[6],'"]');break;case'!=':temp.push('[@',param[4],'!="',param[6],'"]')}}else{temp.push('[@',param[4],']')}}items.push(temp.join(''));return items},getItems:function(items,context,nocash){var elements=[];var xpath=document.evaluate('.//'+items.join('//'),context,$$.shared.resolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,j=xpath.snapshotLength;i<j;i++)elements.push(xpath.snapshotItem(i));return(nocash)?elements:new Elements(elements.map($))}},'normal':{getParam:function(items,context,param,i){if(i==0){if(param[2]){var el=context.getElementById(param[2]);if(!el||((param[1]!='*')&&(Element.getTag(el)!=param[1])))return false;items=[el]}else{items=$A(context.getElementsByTagName(param[1]))}}else{items=$$.shared.getElementsByTagName(items,param[1]);if(param[2])items=Elements.filterById(items,param[2],true)}if(param[3])items=Elements.filterByClass(items,param[3],true);if(param[4])items=Elements.filterByAttribute(items,param[4],param[5],param[6],true);return items},getItems:function(items,context,nocash){return(nocash)?items:$$.unique(items)}},resolver:function(prefix){return(prefix=='xhtml')?'http://www.w3.org/1999/xhtml':false},getElementsByTagName:function(context,tagName){var found=[];for(var i=0,j=context.length;i<j;i++)found.extend(context[i].getElementsByTagName(tagName));return found}};$$.shared.method=(window.xpath)?'xpath':'normal';Element.Methods.Dom={getElements:function(selector,nocash){var items=[];selector=selector.trim().split(' ');for(var i=0,j=selector.length;i<j;i++){var sel=selector[i];var param=sel.match($$.shared.regexp);if(!param)break;param[1]=param[1]||'*';var temp=$$.shared[$$.shared.method].getParam(items,this,param,i);if(!temp)break;items=temp}return $$.shared[$$.shared.method].getItems(items,this,nocash)},getElement:function(selector){return $(this.getElements(selector,true)[0]||false)},getElementsBySelector:function(selector,nocash){var elements=[];selector=selector.split(',');for(var i=0,j=selector.length;i<j;i++)elements=elements.concat(this.getElements(selector[i],true));return(nocash)?elements:$$.unique(elements)}};Element.extend({getElementById:function(id){var el=document.getElementById(id);if(!el)return false;for(var parent=el.parentNode;parent!=this;parent=parent.parentNode){if(!parent)return false}return el},getElementsByClassName:function(className){return this.getElements('.'+className)}});document.extend(Element.Methods.Dom);Element.extend(Element.Methods.Dom);Element.extend({getValue:function(){switch(this.getTag()){case'select':var values=[];$each(this.options,function(option){if(option.selected)values.push($pick(option.value,option.text))});return(this.multiple)?values:values[0];case'input':if(!(this.checked&&['checkbox','radio'].contains(this.type))&&!['hidden','text','password'].contains(this.type))break;case'textarea':return this.value}return false},getFormElements:function(){return $$(this.getElementsByTagName('input'),this.getElementsByTagName('select'),this.getElementsByTagName('textarea'))},toQueryString:function(){var queryString=[];this.getFormElements().each(function(el){var name=el.name;var value=el.getValue();if(value===false||!name||el.disabled)return;var qs=function(val){queryString.push(name+'='+encodeURIComponent(val))};if($type(value)=='array')value.each(qs);else qs(value)});return queryString.join('&')}});Element.extend({scrollTo:function(x,y){this.scrollLeft=x;this.scrollTop=y},getSize:function(){return{'scroll':{'x':this.scrollLeft,'y':this.scrollTop},'size':{'x':this.offsetWidth,'y':this.offsetHeight},'scrollSize':{'x':this.scrollWidth,'y':this.scrollHeight}}},getPosition:function(overflown){overflown=overflown||[];var el=this,left=0,top=0;do{left+=el.offsetLeft||0;top+=el.offsetTop||0;el=el.offsetParent}while(el);overflown.each(function(element){left-=element.scrollLeft||0;top-=element.scrollTop||0});return{'x':left,'y':top}},getTop:function(overflown){return this.getPosition(overflown).y},getLeft:function(overflown){return this.getPosition(overflown).x},getCoordinates:function(overflown){var position=this.getPosition(overflown);var obj={'width':this.offsetWidth,'height':this.offsetHeight,'left':position.x,'top':position.y};obj.right=obj.left+obj.width;obj.bottom=obj.top+obj.height;return obj}});Element.Events.domready={add:function(fn){if(window.loaded){fn.call(this);return}var domReady=function(){if(window.loaded)return;window.loaded=true;window.timer=$clear(window.timer);this.fireEvent('domready')}.bind(this);if(document.readyState&&window.webkit){window.timer=function(){if(['loaded','complete'].contains(document.readyState))domReady()}.periodical(50)}else if(document.readyState&&window.ie){if(!$('ie_ready')){var src=(window.location.protocol=='https:')?'://0':'javascript:void(0)';document.write('<script id="ie_ready" defer src="'+src+'"><\/script>');$('ie_ready').onreadystatechange=function(){if(this.readyState=='complete')domReady()}}}else{window.addListener("load",domReady);document.addListener("DOMContentLoaded",domReady)}}};window.onDomReady=function(fn){return this.addEvent('domready',fn)};window.extend({getWidth:function(){if(this.webkit419)return this.innerWidth;if(this.opera)return document.body.clientWidth;return document.documentElement.clientWidth},getHeight:function(){if(this.webkit419)return this.innerHeight;if(this.opera)return document.body.clientHeight;return document.documentElement.clientHeight},getScrollWidth:function(){if(this.ie)return Math.max(document.documentElement.offsetWidth,document.documentElement.scrollWidth);if(this.webkit)return document.body.scrollWidth;return document.documentElement.scrollWidth},getScrollHeight:function(){if(this.ie)return Math.max(document.documentElement.offsetHeight,document.documentElement.scrollHeight);if(this.webkit)return document.body.scrollHeight;return document.documentElement.scrollHeight},getScrollLeft:function(){return this.pageXOffset||document.documentElement.scrollLeft},getScrollTop:function(){return this.pageYOffset||document.documentElement.scrollTop},getSize:function(){return{'size':{'x':this.getWidth(),'y':this.getHeight()},'scrollSize':{'x':this.getScrollWidth(),'y':this.getScrollHeight()},'scroll':{'x':this.getScrollLeft(),'y':this.getScrollTop()}}},getPosition:function(){return{'x':0,'y':0}}});var Fx={};Fx.Base=new Class({options:{onStart:Class.empty,onComplete:Class.empty,onCancel:Class.empty,transition:function(p){return-(Math.cos(Math.PI*p)-1)/2},duration:500,unit:'px',wait:true,fps:50},initialize:function(options){this.element=this.element||null;this.setOptions(options);if(this.options.initialize)this.options.initialize.call(this)},step:function(){var time=$time();if(time<this.time+this.options.duration){this.delta=this.options.transition((time-this.time)/this.options.duration);this.setNow();this.increase()}else{this.stop(true);this.set(this.to);this.fireEvent('onComplete',this.element,10);this.callChain()}},set:function(to){this.now=to;this.increase();return this},setNow:function(){this.now=this.compute(this.from,this.to)},compute:function(from,to){return(to-from)*this.delta+from},start:function(from,to){if(!this.options.wait)this.stop();else if(this.timer)return this;this.from=from;this.to=to;this.change=this.to-this.from;this.time=$time();this.timer=this.step.periodical(Math.round(1000/this.options.fps),this);this.fireEvent('onStart',this.element);return this},stop:function(end){if(!this.timer)return this;this.timer=$clear(this.timer);if(!end)this.fireEvent('onCancel',this.element);return this},custom:function(from,to){return this.start(from,to)},clearTimer:function(end){return this.stop(end)}});Fx.Base.implement(new Chain,new Events,new Options);Fx.CSS={select:function(property,to){if(property.test(/color/i))return this.Color;var type=$type(to);if((type=='array')||(type=='string'&&to.contains(' ')))return this.Multi;return this.Single},parse:function(el,property,fromTo){if(!fromTo.push)fromTo=[fromTo];var from=fromTo[0],to=fromTo[1];if(!$chk(to)){to=from;from=el.getStyle(property)}var css=this.select(property,to);return{'from':css.parse(from),'to':css.parse(to),'css':css}}};Fx.CSS.Single={parse:function(value){return parseFloat(value)},getNow:function(from,to,fx){return fx.compute(from,to)},getValue:function(value,unit,property){if(unit=='px'&&property!='opacity')value=Math.round(value);return value+unit}};Fx.CSS.Multi={parse:function(value){return value.push?value:value.split(' ').map(function(v){return parseFloat(v)})},getNow:function(from,to,fx){var now=[];for(var i=0;i<from.length;i++)now[i]=fx.compute(from[i],to[i]);return now},getValue:function(value,unit,property){if(unit=='px'&&property!='opacity')value=value.map(Math.round);return value.join(unit+' ')+unit}};Fx.CSS.Color={parse:function(value){return value.push?value:value.hexToRgb(true)},getNow:function(from,to,fx){var now=[];for(var i=0;i<from.length;i++)now[i]=Math.round(fx.compute(from[i],to[i]));return now},getValue:function(value){return'rgb('+value.join(',')+')'}};Fx.Style=Fx.Base.extend({initialize:function(el,property,options){this.element=$(el);this.property=property;this.parent(options)},hide:function(){return this.set(0)},setNow:function(){this.now=this.css.getNow(this.from,this.to,this)},set:function(to){this.css=Fx.CSS.select(this.property,to);return this.parent(this.css.parse(to))},start:function(from,to){if(this.timer&&this.options.wait)return this;var parsed=Fx.CSS.parse(this.element,this.property,[from,to]);this.css=parsed.css;return this.parent(parsed.from,parsed.to)},increase:function(){this.element.setStyle(this.property,this.css.getValue(this.now,this.options.unit,this.property))}});Element.extend({effect:function(property,options){return new Fx.Style(this,property,options)}});Fx.Styles=Fx.Base.extend({initialize:function(el,options){this.element=$(el);this.parent(options)},setNow:function(){for(var p in this.from)this.now[p]=this.css[p].getNow(this.from[p],this.to[p],this)},set:function(to){var parsed={};this.css={};for(var p in to){this.css[p]=Fx.CSS.select(p,to[p]);parsed[p]=this.css[p].parse(to[p])}return this.parent(parsed)},start:function(obj){if(this.timer&&this.options.wait)return this;this.now={};this.css={};var from={},to={};for(var p in obj){var parsed=Fx.CSS.parse(this.element,p,obj[p]);from[p]=parsed.from;to[p]=parsed.to;this.css[p]=parsed.css}return this.parent(from,to)},increase:function(){for(var p in this.now)this.element.setStyle(p,this.css[p].getValue(this.now[p],this.options.unit,p))}});Element.extend({effects:function(options){return new Fx.Styles(this,options)}});Fx.Elements=Fx.Base.extend({initialize:function(elements,options){this.elements=$$(elements);this.parent(options)},setNow:function(){for(var i in this.from){var iFrom=this.from[i],iTo=this.to[i],iCss=this.css[i],iNow=this.now[i]={};for(var p in iFrom)iNow[p]=iCss[p].getNow(iFrom[p],iTo[p],this)}},set:function(to){var parsed={};this.css={};for(var i in to){var iTo=to[i],iCss=this.css[i]={},iParsed=parsed[i]={};for(var p in iTo){iCss[p]=Fx.CSS.select(p,iTo[p]);iParsed[p]=iCss[p].parse(iTo[p])}}return this.parent(parsed)},start:function(obj){if(this.timer&&this.options.wait)return this;this.now={};this.css={};var from={},to={};for(var i in obj){var iProps=obj[i],iFrom=from[i]={},iTo=to[i]={},iCss=this.css[i]={};for(var p in iProps){var parsed=Fx.CSS.parse(this.elements[i],p,iProps[p]);iFrom[p]=parsed.from;iTo[p]=parsed.to;iCss[p]=parsed.css}}return this.parent(from,to)},increase:function(){for(var i in this.now){var iNow=this.now[i],iCss=this.css[i];for(var p in iNow)this.elements[i].setStyle(p,iCss[p].getValue(iNow[p],this.options.unit,p))}}});Fx.Scroll=Fx.Base.extend({options:{overflown:[],offset:{'x':0,'y':0},wheelStops:true},initialize:function(element,options){this.now=[];this.element=$(element);this.bound={'stop':this.stop.bind(this,false)};this.parent(options);if(this.options.wheelStops){this.addEvent('onStart',function(){document.addEvent('mousewheel',this.bound.stop)}.bind(this));this.addEvent('onComplete',function(){document.removeEvent('mousewheel',this.bound.stop)}.bind(this))}},setNow:function(){for(var i=0;i<2;i++)this.now[i]=this.compute(this.from[i],this.to[i])},scrollTo:function(x,y){if(this.timer&&this.options.wait)return this;var el=this.element.getSize();var values={'x':x,'y':y};for(var z in el.size){var max=el.scrollSize[z]-el.size[z];if($chk(values[z]))values[z]=($type(values[z])=='number')?values[z].limit(0,max):max;else values[z]=el.scroll[z];values[z]+=this.options.offset[z]}return this.start([el.scroll.x,el.scroll.y],[values.x,values.y])},toTop:function(){return this.scrollTo(false,0)},toBottom:function(){return this.scrollTo(false,'full')},toLeft:function(){return this.scrollTo(0,false)},toRight:function(){return this.scrollTo('full',false)},toElement:function(el){var parent=this.element.getPosition(this.options.overflown);var target=$(el).getPosition(this.options.overflown);return this.scrollTo(target.x-parent.x,target.y-parent.y)},increase:function(){this.element.scrollTo(this.now[0],this.now[1])}});Fx.Slide=Fx.Base.extend({options:{mode:'vertical'},initialize:function(el,options){this.element=$(el);this.wrapper=new Element('div',{'styles':$extend(this.element.getStyles('margin'),{'overflow':'hidden'})}).injectAfter(this.element).adopt(this.element);this.element.setStyle('margin',0);this.setOptions(options);this.now=[];this.parent(this.options);this.open=true;this.addEvent('onComplete',function(){this.open=(this.now[0]===0)});if(window.webkit419)this.addEvent('onComplete',function(){if(this.open)this.element.remove().inject(this.wrapper)})},setNow:function(){for(var i=0;i<2;i++)this.now[i]=this.compute(this.from[i],this.to[i])},vertical:function(){this.margin='margin-top';this.layout='height';this.offset=this.element.offsetHeight},horizontal:function(){this.margin='margin-left';this.layout='width';this.offset=this.element.offsetWidth},slideIn:function(mode){this[mode||this.options.mode]();return this.start([this.element.getStyle(this.margin).toInt(),this.wrapper.getStyle(this.layout).toInt()],[0,this.offset])},slideOut:function(mode){this[mode||this.options.mode]();return this.start([this.element.getStyle(this.margin).toInt(),this.wrapper.getStyle(this.layout).toInt()],[-this.offset,0])},hide:function(mode){this[mode||this.options.mode]();this.open=false;return this.set([-this.offset,0])},show:function(mode){this[mode||this.options.mode]();this.open=true;return this.set([0,this.offset])},toggle:function(mode){if(this.wrapper.offsetHeight==0||this.wrapper.offsetWidth==0)return this.slideIn(mode);return this.slideOut(mode)},increase:function(){this.element.setStyle(this.margin,this.now[0]+this.options.unit);this.wrapper.setStyle(this.layout,this.now[1]+this.options.unit)}});Fx.Transition=function(transition,params){params=params||[];if($type(params)!='array')params=[params];return $extend(transition,{easeIn:function(pos){return transition(pos,params)},easeOut:function(pos){return 1-transition(1-pos,params)},easeInOut:function(pos){return(pos<=0.5)?transition(2*pos,params)/2:(2-transition(2*(1-pos),params))/2}})};Fx.Transitions=new Abstract({linear:function(p){return p}});Fx.Transitions.extend=function(transitions){for(var transition in transitions){Fx.Transitions[transition]=new Fx.Transition(transitions[transition]);Fx.Transitions.compat(transition)}};Fx.Transitions.compat=function(transition){['In','Out','InOut'].each(function(easeType){Fx.Transitions[transition.toLowerCase()+easeType]=Fx.Transitions[transition]['ease'+easeType]})};Fx.Transitions.extend({Pow:function(p,x){return Math.pow(p,x[0]||6)},Expo:function(p){return Math.pow(2,8*(p-1))},Circ:function(p){return 1-Math.sin(Math.acos(p))},Sine:function(p){return 1-Math.sin((1-p)*Math.PI/2)},Back:function(p,x){x=x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x)},Bounce:function(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=-Math.pow((11-6*a-11*p)/4,2)+b*b;break}}return value},Elastic:function(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x[0]||1)/3)}});['Quad','Cubic','Quart','Quint'].each(function(transition,i){Fx.Transitions[transition]=new Fx.Transition(function(p){return Math.pow(p,[i+2])});Fx.Transitions.compat(transition)});var Drag={};Drag.Base=new Class({options:{handle:false,unit:'px',onStart:Class.empty,onBeforeStart:Class.empty,onComplete:Class.empty,onSnap:Class.empty,onDrag:Class.empty,limit:false,modifiers:{x:'left',y:'top'},grid:false,snap:6},initialize:function(el,options){this.setOptions(options);this.element=$(el);this.handle=$(this.options.handle)||this.element;this.mouse={'now':{},'pos':{}};this.value={'start':{},'now':{}};this.bound={'start':this.start.bindWithEvent(this),'check':this.check.bindWithEvent(this),'drag':this.drag.bindWithEvent(this),'stop':this.stop.bind(this)};this.attach();if(this.options.initialize)this.options.initialize.call(this)},attach:function(){this.handle.addEvent('mousedown',this.bound.start);return this},detach:function(){this.handle.removeEvent('mousedown',this.bound.start);return this},start:function(event){this.fireEvent('onBeforeStart',this.element);this.mouse.start=event.page;var limit=this.options.limit;this.limit={'x':[],'y':[]};for(var z in this.options.modifiers){if(!this.options.modifiers[z])continue;this.value.now[z]=this.element.getStyle(this.options.modifiers[z]).toInt();this.mouse.pos[z]=event.page[z]-this.value.now[z];if(limit&&limit[z]){for(var i=0;i<2;i++){if($chk(limit[z][i]))this.limit[z][i]=($type(limit[z][i])=='function')?limit[z][i]():limit[z][i]}}}if($type(this.options.grid)=='number')this.options.grid={'x':this.options.grid,'y':this.options.grid};document.addListener('mousemove',this.bound.check);document.addListener('mouseup',this.bound.stop);this.fireEvent('onStart',this.element);event.stop()},check:function(event){var distance=Math.round(Math.sqrt(Math.pow(event.page.x-this.mouse.start.x,2)+Math.pow(event.page.y-this.mouse.start.y,2)));if(distance>this.options.snap){document.removeListener('mousemove',this.bound.check);document.addListener('mousemove',this.bound.drag);this.drag(event);this.fireEvent('onSnap',this.element)}event.stop()},drag:function(event){this.out=false;this.mouse.now=event.page;for(var z in this.options.modifiers){if(!this.options.modifiers[z])continue;this.value.now[z]=this.mouse.now[z]-this.mouse.pos[z];if(this.limit[z]){if($chk(this.limit[z][1])&&(this.value.now[z]>this.limit[z][1])){this.value.now[z]=this.limit[z][1];this.out=true}else if($chk(this.limit[z][0])&&(this.value.now[z]<this.limit[z][0])){this.value.now[z]=this.limit[z][0];this.out=true}}if(this.options.grid[z])this.value.now[z]-=(this.value.now[z]%this.options.grid[z]);this.element.setStyle(this.options.modifiers[z],this.value.now[z]+this.options.unit)}this.fireEvent('onDrag',this.element);event.stop()},stop:function(){document.removeListener('mousemove',this.bound.check);document.removeListener('mousemove',this.bound.drag);document.removeListener('mouseup',this.bound.stop);this.fireEvent('onComplete',this.element)}});Drag.Base.implement(new Events,new Options);Element.extend({makeResizable:function(options){return new Drag.Base(this,$merge({modifiers:{x:'width',y:'height'}},options))}});Drag.Move=Drag.Base.extend({options:{droppables:[],container:false,overflown:[]},initialize:function(el,options){this.setOptions(options);this.element=$(el);this.droppables=$$(this.options.droppables);this.container=$(this.options.container);this.position={'element':this.element.getStyle('position'),'container':false};if(this.container)this.position.container=this.container.getStyle('position');if(!['relative','absolute','fixed'].contains(this.position.element))this.position.element='absolute';var top=this.element.getStyle('top').toInt();var left=this.element.getStyle('left').toInt();if(this.position.element=='absolute'&&!['relative','absolute','fixed'].contains(this.position.container)){top=$chk(top)?top:this.element.getTop(this.options.overflown);left=$chk(left)?left:this.element.getLeft(this.options.overflown)}else{top=$chk(top)?top:0;left=$chk(left)?left:0}this.element.setStyles({'top':top,'left':left,'position':this.position.element});this.parent(this.element)},start:function(event){this.overed=null;if(this.container){var cont=this.container.getCoordinates();var el=this.element.getCoordinates();if(this.position.element=='absolute'&&!['relative','absolute','fixed'].contains(this.position.container)){this.options.limit={'x':[cont.left,cont.right-el.width],'y':[cont.top,cont.bottom-el.height]}}else{this.options.limit={'y':[0,cont.height-el.height],'x':[0,cont.width-el.width]}}}this.parent(event)},drag:function(event){this.parent(event);var overed=this.out?false:this.droppables.filter(this.checkAgainst,this).getLast();if(this.overed!=overed){if(this.overed)this.overed.fireEvent('leave',[this.element,this]);this.overed=overed?overed.fireEvent('over',[this.element,this]):null}return this},checkAgainst:function(el){el=el.getCoordinates(this.options.overflown);var now=this.mouse.now;return(now.x>el.left&&now.x<el.right&&now.y<el.bottom&&now.y>el.top)},stop:function(){if(this.overed&&!this.out)this.overed.fireEvent('drop',[this.element,this]);else this.element.fireEvent('emptydrop',this);this.parent();return this}});Element.extend({makeDraggable:function(options){return new Drag.Move(this,options)}});var XHR=new Class({options:{method:'post',async:true,onRequest:Class.empty,onSuccess:Class.empty,onFailure:Class.empty,urlEncoded:true,encoding:'utf-8',autoCancel:false,headers:{}},setTransport:function(){this.transport=(window.XMLHttpRequest)?new XMLHttpRequest():(window.ie?new ActiveXObject('Microsoft.XMLHTTP'):false);return this},initialize:function(options){this.setTransport().setOptions(options);this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.headers={};if(this.options.urlEncoded&&this.options.method=='post'){var encoding=(this.options.encoding)?'; charset='+this.options.encoding:'';this.setHeader('Content-type','application/x-www-form-urlencoded'+encoding)}if(this.options.initialize)this.options.initialize.call(this)},onStateChange:function(){if(this.transport.readyState!=4||!this.running)return;this.running=false;var status=0;try{status=this.transport.status}catch(e){};if(this.options.isSuccess.call(this,status))this.onSuccess();else this.onFailure();this.transport.onreadystatechange=Class.empty},isSuccess:function(status){return((status>=200)&&(status<300))},onSuccess:function(){this.response={'text':this.transport.responseText,'xml':this.transport.responseXML};this.fireEvent('onSuccess',[this.response.text,this.response.xml]);this.callChain()},onFailure:function(){this.fireEvent('onFailure',this.transport)},setHeader:function(name,value){this.headers[name]=value;return this},send:function(url,data){if(this.options.autoCancel)this.cancel();else if(this.running)return this;this.running=true;if(data&&this.options.method=='get'){url=url+(url.contains('?')?'&':'?')+data;data=null}this.transport.open(this.options.method.toUpperCase(),url,this.options.async);this.transport.onreadystatechange=this.onStateChange.bind(this);if((this.options.method=='post')&&this.transport.overrideMimeType)this.setHeader('Connection','close');$extend(this.headers,this.options.headers);for(var type in this.headers)try{this.transport.setRequestHeader(type,this.headers[type])}catch(e){};this.fireEvent('onRequest');this.transport.send($pick(data,null));return this},cancel:function(){if(!this.running)return this;this.running=false;this.transport.abort();this.transport.onreadystatechange=Class.empty;this.setTransport();this.fireEvent('onCancel');return this}});XHR.implement(new Chain,new Events,new Options);var Ajax=XHR.extend({options:{data:null,update:null,onComplete:Class.empty,evalScripts:false,evalResponse:false},initialize:function(url,options){this.addEvent('onSuccess',this.onComplete);this.setOptions(options);this.options.data=this.options.data||this.options.postBody;if(!['post','get'].contains(this.options.method)){this._method='_method='+this.options.method;this.options.method='post'}this.parent();this.setHeader('X-Requested-With','XMLHttpRequest');this.setHeader('Accept','text/javascript, text/html, application/xml, text/xml, */*');this.url=url},onComplete:function(){if(this.options.update)$(this.options.update).empty().setHTML(this.response.text);if(this.options.evalScripts||this.options.evalResponse)this.evalScripts();this.fireEvent('onComplete',[this.response.text,this.response.xml],20)},request:function(data){data=data||this.options.data;switch($type(data)){case'element':data=$(data).toQueryString();break;case'object':data=Object.toQueryString(data)}if(this._method)data=(data)?[this._method,data].join('&'):this._method;return this.send(this.url,data)},evalScripts:function(){var script,scripts;if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader('Content-type')))scripts=this.response.text;else{scripts=[];var regexp=/<script[^>]*>([\s\S]*?)<\/script>/gi;while((script=regexp.exec(this.response.text)))scripts.push(script[1]);scripts=scripts.join('\n')}if(scripts)(window.execScript)?window.execScript(scripts):window.setTimeout(scripts,0)},getHeader:function(name){try{return this.transport.getResponseHeader(name)}catch(e){};return null}});Object.toQueryString=function(source){var queryString=[];for(var property in source)queryString.push(encodeURIComponent(property)+'='+encodeURIComponent(source[property]));return queryString.join('&')};Element.extend({send:function(options){return new Ajax(this.getProperty('action'),$merge({data:this.toQueryString()},options,{method:'post'})).request()}});var Cookie=new Abstract({options:{domain:false,path:false,duration:false,secure:false},set:function(key,value,options){options=$merge(this.options,options);value=encodeURIComponent(value);if(options.domain)value+='; domain='+options.domain;if(options.path)value+='; path='+options.path;if(options.duration){var date=new Date();date.setTime(date.getTime()+options.duration*24*60*60*1000);value+='; expires='+date.toGMTString()}if(options.secure)value+='; secure';document.cookie=key+'='+value;return $extend(options,{'key':key,'value':value})},get:function(key){var value=document.cookie.match('(?:^|;)\\s*'+key.escapeRegExp()+'=([^;]*)');return value?decodeURIComponent(value[1]):false},remove:function(cookie,options){if($type(cookie)=='object')this.set(cookie.key,'',$merge(cookie,{duration:-1}));else this.set(cookie,'',$merge(options,{duration:-1}))}});var Json={toString:function(obj){switch($type(obj)){case'string':return'"'+obj.replace(/(["\\])/g,'\\$1')+'"';case'array':return'['+obj.map(Json.toString).join(',')+']';case'object':var string=[];for(var property in obj)string.push(Json.toString(property)+':'+Json.toString(obj[property]));return'{'+string.join(',')+'}';case'number':if(isFinite(obj))break;case false:return'null'}return String(obj)},evaluate:function(str,secure){return(($type(str)!='string')||(secure&&!str.test(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/)))?null:eval('('+str+')')}};Json.Remote=XHR.extend({initialize:function(url,options){this.url=url;this.addEvent('onSuccess',this.onComplete);this.parent(options);this.setHeader('X-Request','JSON')},send:function(obj){return this.parent(this.url,'json='+Json.toString(obj))},onComplete:function(){this.fireEvent('onComplete',[Json.evaluate(this.response.text,this.options.secure)])}});var Asset=new Abstract({javascript:function(source,properties){properties=$merge({'onload':Class.empty},properties);var script=new Element('script',{'src':source}).addEvents({'load':properties.onload,'readystatechange':function(){if(this.readyState=='complete')this.fireEvent('load')}});delete properties.onload;return script.setProperties(properties).inject(document.head)},css:function(source,properties){return new Element('link',$merge({'rel':'stylesheet','media':'screen','type':'text/css','href':source},properties)).inject(document.head)},image:function(source,properties){properties=$merge({'onload':Class.empty,'onabort':Class.empty,'onerror':Class.empty},properties);var image=new Image();image.src=source;var element=new Element('img',{'src':source});['load','abort','error'].each(function(type){var event=properties['on'+type];delete properties['on'+type];element.addEvent(type,function(){this.removeEvent(type,arguments.callee);event.call(this)})});if(image.width&&image.height)element.fireEvent('load',element,1);return element.setProperties(properties)},images:function(sources,options){options=$merge({onComplete:Class.empty,onProgress:Class.empty},options);if(!sources.push)sources=[sources];var images=[];var counter=0;sources.each(function(source){var img=new Asset.image(source,{'onload':function(){options.onProgress.call(this,counter);counter++;if(counter==sources.length)options.onComplete()}});images.push(img)});return new Elements(images)}});var Accordion=Fx.Elements.extend({options:{onActive:Class.empty,onBackground:Class.empty,display:0,show:false,height:true,width:false,opacity:true,fixedHeight:false,fixedWidth:false,wait:false,alwaysHide:false},initialize:function(){var options,togglers,elements,container;$each(arguments,function(argument,i){switch($type(argument)){case'object':options=argument;break;case'element':container=$(argument);break;default:var temp=$$(argument);if(!togglers)togglers=temp;else elements=temp}});this.togglers=togglers||[];this.elements=elements||[];this.container=$(container);this.setOptions(options);this.previous=-1;if(this.options.alwaysHide)this.options.wait=true;if($chk(this.options.show)){this.options.display=false;this.previous=this.options.show}if(this.options.start){this.options.display=false;this.options.show=false}this.effects={};if(this.options.opacity)this.effects.opacity='fullOpacity';if(this.options.width)this.effects.width=this.options.fixedWidth?'fullWidth':'offsetWidth';if(this.options.height)this.effects.height=this.options.fixedHeight?'fullHeight':'scrollHeight';for(var i=0,l=this.togglers.length;i<l;i++)this.addSection(this.togglers[i],this.elements[i]);this.elements.each(function(el,i){if(this.options.show===i){this.fireEvent('onActive',[this.togglers[i],el])}else{for(var fx in this.effects)el.setStyle(fx,0)}},this);this.parent(this.elements);if($chk(this.options.display))this.display(this.options.display)},addSection:function(toggler,element,pos){toggler=$(toggler);element=$(element);var test=this.togglers.contains(toggler);var len=this.togglers.length;this.togglers.include(toggler);this.elements.include(element);if(len&&(!test||pos)){pos=$pick(pos,len-1);toggler.injectBefore(this.togglers[pos]);element.injectAfter(toggler)}else if(this.container&&!test){toggler.inject(this.container);element.inject(this.container)}var idx=this.togglers.indexOf(toggler);toggler.addEvent('click',this.display.bind(this,idx));if(this.options.height)element.setStyles({'padding-top':0,'border-top':'none','padding-bottom':0,'border-bottom':'none'});if(this.options.width)element.setStyles({'padding-left':0,'border-left':'none','padding-right':0,'border-right':'none'});element.fullOpacity=1;if(this.options.fixedWidth)element.fullWidth=this.options.fixedWidth;if(this.options.fixedHeight)element.fullHeight=this.options.fixedHeight;element.setStyle('overflow','hidden');if(!test){for(var fx in this.effects)element.setStyle(fx,0)}return this},display:function(index){index=($type(index)=='element')?this.elements.indexOf(index):index;if((this.timer&&this.options.wait)||(index===this.previous&&!this.options.alwaysHide))return this;this.previous=index;var obj={};this.elements.each(function(el,i){obj[i]={};var hide=(i!=index)||(this.options.alwaysHide&&(el.offsetHeight>0));this.fireEvent(hide?'onBackground':'onActive',[this.togglers[i],el]);for(var fx in this.effects)obj[i][fx]=hide?0:el[this.effects[fx]]},this);return this.start(obj)},showThisHideOpen:function(index){return this.display(index)}});Fx.Accordion=Accordion;var Color=new Class({initialize:function(color,type){type=type||(color.push?'rgb':'hex');var rgb,hsb;switch(type){case'rgb':rgb=color;hsb=rgb.rgbToHsb();break;case'hsb':rgb=color.hsbToRgb();hsb=color;break;default:rgb=color.hexToRgb(true);hsb=rgb.rgbToHsb()}rgb.hsb=hsb;rgb.hex=rgb.rgbToHex();return $extend(rgb,Color.prototype)},mix:function(){var colors=$A(arguments);var alpha=($type(colors[colors.length-1])=='number')?colors.pop():50;var rgb=this.copy();colors.each(function(color){color=new Color(color);for(var i=0;i<3;i++)rgb[i]=Math.round((rgb[i]/100*(100-alpha))+(color[i]/100*alpha))});return new Color(rgb,'rgb')},invert:function(){return new Color(this.map(function(value){return 255-value}))},setHue:function(value){return new Color([value,this.hsb[1],this.hsb[2]],'hsb')},setSaturation:function(percent){return new Color([this.hsb[0],percent,this.hsb[2]],'hsb')},setBrightness:function(percent){return new Color([this.hsb[0],this.hsb[1],percent],'hsb')}});function $RGB(r,g,b){return new Color([r,g,b],'rgb')};function $HSB(h,s,b){return new Color([h,s,b],'hsb')};Array.extend({rgbToHsb:function(){var red=this[0],green=this[1],blue=this[2];var hue,saturation,brightness;var max=Math.max(red,green,blue),min=Math.min(red,green,blue);var delta=max-min;brightness=max/255;saturation=(max!=0)?delta/max:0;if(saturation==0){hue=0}else{var rr=(max-red)/delta;var gr=(max-green)/delta;var br=(max-blue)/delta;if(red==max)hue=br-gr;else if(green==max)hue=2+rr-br;else hue=4+gr-rr;hue/=6;if(hue<0)hue++}return[Math.round(hue*360),Math.round(saturation*100),Math.round(brightness*100)]},hsbToRgb:function(){var br=Math.round(this[2]/100*255);if(this[1]==0){return[br,br,br]}else{var hue=this[0]%360;var f=hue%60;var p=Math.round((this[2]*(100-this[1]))/10000*255);var q=Math.round((this[2]*(6000-this[1]*f))/600000*255);var t=Math.round((this[2]*(6000-this[1]*(60-f)))/600000*255);switch(Math.floor(hue/60)){case 0:return[br,t,p];case 1:return[q,br,p];case 2:return[p,br,t];case 3:return[p,q,br];case 4:return[t,p,br];case 5:return[br,p,q]}}return false}});var Group=new Class({initialize:function(){this.instances=$A(arguments);this.events={};this.checker={}},addEvent:function(type,fn){this.checker[type]=this.checker[type]||{};this.events[type]=this.events[type]||[];if(this.events[type].contains(fn))return false;else this.events[type].push(fn);this.instances.each(function(instance,i){instance.addEvent(type,this.check.bind(this,[type,instance,i]))},this);return this},check:function(type,instance,i){this.checker[type][i]=true;var every=this.instances.every(function(current,j){return this.checker[type][j]||false},this);if(!every)return;this.checker[type]={};this.events[type].each(function(event){event.call(this,this.instances,instance)},this)}});var Hash=new Class({length:0,initialize:function(object){this.obj=object||{};this.setLength()},get:function(key){return(this.hasKey(key))?this.obj[key]:null},hasKey:function(key){return(key in this.obj)},set:function(key,value){if(!this.hasKey(key))this.length++;this.obj[key]=value;return this},setLength:function(){this.length=0;for(var p in this.obj)this.length++;return this},remove:function(key){if(this.hasKey(key)){delete this.obj[key];this.length--}return this},each:function(fn,bind){$each(this.obj,fn,bind)},extend:function(obj){$extend(this.obj,obj);return this.setLength()},merge:function(){this.obj=$merge.apply(null,[this.obj].extend(arguments));return this.setLength()},empty:function(){this.obj={};this.length=0;return this},keys:function(){var keys=[];for(var property in this.obj)keys.push(property);return keys},values:function(){var values=[];for(var property in this.obj)values.push(this.obj[property]);return values}});function $H(obj){return new Hash(obj)};Hash.Cookie=Hash.extend({initialize:function(name,options){this.name=name;this.options=$extend({'autoSave':true},options||{});this.load()},save:function(){if(this.length==0){Cookie.remove(this.name,this.options);return true}var str=Json.toString(this.obj);if(str.length>4096)return false;Cookie.set(this.name,str,this.options);return true},load:function(){this.obj=Json.evaluate(Cookie.get(this.name),true)||{};this.setLength()}});Hash.Cookie.Methods={};['extend','set','merge','empty','remove'].each(function(method){Hash.Cookie.Methods[method]=function(){Hash.prototype[method].apply(this,arguments);if(this.options.autoSave)this.save();return this}});Hash.Cookie.implement(Hash.Cookie.Methods);var Scroller=new Class({options:{area:20,velocity:1,onChange:function(x,y){this.element.scrollTo(x,y)}},initialize:function(element,options){this.setOptions(options);this.element=$(element);this.mousemover=([window,document].contains(element))?$(document.body):this.element},start:function(){this.coord=this.getCoords.bindWithEvent(this);this.mousemover.addListener('mousemove',this.coord)},stop:function(){this.mousemover.removeListener('mousemove',this.coord);this.timer=$clear(this.timer)},getCoords:function(event){this.page=(this.element==window)?event.client:event.page;if(!this.timer)this.timer=this.scroll.periodical(50,this)},scroll:function(){var el=this.element.getSize();var pos=this.element.getPosition();var change={'x':0,'y':0};for(var z in this.page){if(this.page[z]<(this.options.area+pos[z])&&el.scroll[z]!=0)change[z]=(this.page[z]-this.options.area-pos[z])*this.options.velocity;else if(this.page[z]+this.options.area>(el.size[z]+pos[z])&&el.scroll[z]+el.size[z]!=el.scrollSize[z])change[z]=(this.page[z]-el.size[z]+this.options.area-pos[z])*this.options.velocity}if(change.y||change.x)this.fireEvent('onChange',[el.scroll.x+change.x,el.scroll.y+change.y])}});Scroller.implement(new Events,new Options);var Slider=new Class({options:{onChange:Class.empty,onComplete:Class.empty,onTick:function(pos){this.knob.setStyle(this.p,pos)},mode:'horizontal',steps:100,offset:0},initialize:function(el,knob,options){this.element=$(el);this.knob=$(knob);this.setOptions(options);this.previousChange=-1;this.previousEnd=-1;this.step=-1;this.element.addEvent('mousedown',this.clickedElement.bindWithEvent(this));var mod,offset;switch(this.options.mode){case'horizontal':this.z='x';this.p='left';mod={'x':'left','y':false};offset='offsetWidth';break;case'vertical':this.z='y';this.p='top';mod={'x':false,'y':'top'};offset='offsetHeight'}this.max=this.element[offset]-this.knob[offset]+(this.options.offset*2);this.half=this.knob[offset]/2;this.getPos=this.element['get'+this.p.capitalize()].bind(this.element);this.knob.setStyle('position','relative').setStyle(this.p,-this.options.offset);var lim={};lim[this.z]=[-this.options.offset,this.max-this.options.offset];this.drag=new Drag.Base(this.knob,{limit:lim,modifiers:mod,snap:0,onStart:function(){this.draggedKnob()}.bind(this),onDrag:function(){this.draggedKnob()}.bind(this),onComplete:function(){this.draggedKnob();this.end()}.bind(this)});if(this.options.initialize)this.options.initialize.call(this)},set:function(step){this.step=step.limit(0,this.options.steps);this.checkStep();this.end();this.fireEvent('onTick',this.toPosition(this.step));return this},clickedElement:function(event){var position=event.page[this.z]-this.getPos()-this.half;position=position.limit(-this.options.offset,this.max-this.options.offset);this.step=this.toStep(position);this.checkStep();this.end();this.fireEvent('onTick',position)},draggedKnob:function(){this.step=this.toStep(this.drag.value.now[this.z]);this.checkStep()},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent('onChange',this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent('onComplete',this.step+'')}},toStep:function(position){return Math.round((position+this.options.offset)/this.max*this.options.steps)},toPosition:function(step){return this.max*step/this.options.steps}});Slider.implement(new Events);Slider.implement(new Options);var SmoothScroll=Fx.Scroll.extend({initialize:function(options){this.parent(window,options);this.links=(this.options.links)?$$(this.options.links):$$(document.links);var location=window.location.href.match(/^[^#]*/)[0]+'#';this.links.each(function(link){if(link.href.indexOf(location)!=0)return;var anchor=link.href.substr(location.length);if(anchor&&$(anchor))this.useLink(link,anchor)},this);if(!window.webkit419)this.addEvent('onComplete',function(){window.location.hash=this.anchor})},useLink:function(link,anchor){link.addEvent('click',function(event){this.anchor=anchor;this.toElement(anchor);event.stop()}.bindWithEvent(this))}});var Sortables=new Class({options:{handles:false,onStart:Class.empty,onComplete:Class.empty,ghost:true,snap:3,onDragStart:function(element,ghost){ghost.setStyle('opacity',0.7);element.setStyle('opacity',0.7)},onDragComplete:function(element,ghost){element.setStyle('opacity',1);ghost.remove();this.trash.remove()}},initialize:function(list,options){this.setOptions(options);this.list=$(list);this.elements=this.list.getChildren();this.handles=(this.options.handles)?$$(this.options.handles):this.elements;this.bound={'start':[],'moveGhost':this.moveGhost.bindWithEvent(this)};for(var i=0,l=this.handles.length;i<l;i++){this.bound.start[i]=this.start.bindWithEvent(this,this.elements[i])}this.attach();if(this.options.initialize)this.options.initialize.call(this);this.bound.move=this.move.bindWithEvent(this);this.bound.end=this.end.bind(this)},attach:function(){this.handles.each(function(handle,i){handle.addEvent('mousedown',this.bound.start[i])},this)},detach:function(){this.handles.each(function(handle,i){handle.removeEvent('mousedown',this.bound.start[i])},this)},start:function(event,el){this.active=el;this.coordinates=this.list.getCoordinates();if(this.options.ghost){var position=el.getPosition();this.offset=event.page.y-position.y;this.trash=new Element('div').inject(document.body);this.ghost=el.clone().inject(this.trash).setStyles({'position':'absolute','left':position.x,'top':event.page.y-this.offset});document.addListener('mousemove',this.bound.moveGhost);this.fireEvent('onDragStart',[el,this.ghost])}document.addListener('mousemove',this.bound.move);document.addListener('mouseup',this.bound.end);this.fireEvent('onStart',el);event.stop()},moveGhost:function(event){var value=event.page.y-this.offset;value=value.limit(this.coordinates.top,this.coordinates.bottom-this.ghost.offsetHeight);this.ghost.setStyle('top',value);event.stop()},move:function(event){var now=event.page.y;this.previous=this.previous||now;var up=((this.previous-now)>0);var prev=this.active.getPrevious();var next=this.active.getNext();if(prev&&up&&now<prev.getCoordinates().bottom)this.active.injectBefore(prev);if(next&&!up&&now>next.getCoordinates().top)this.active.injectAfter(next);this.previous=now},serialize:function(converter){return this.list.getChildren().map(converter||function(el){return this.elements.indexOf(el)},this)},end:function(){this.previous=null;document.removeListener('mousemove',this.bound.move);document.removeListener('mouseup',this.bound.end);if(this.options.ghost){document.removeListener('mousemove',this.bound.moveGhost);this.fireEvent('onDragComplete',[this.active,this.ghost])}this.fireEvent('onComplete',this.active)}});Sortables.implement(new Events,new Options);var Tips=new Class({options:{onShow:function(tip){tip.setStyle('visibility','visible')},onHide:function(tip){tip.setStyle('visibility','hidden')},maxTitleChars:30,showDelay:100,hideDelay:100,className:'tool',offsets:{'x':16,'y':16},fixed:false},initialize:function(elements,options){this.setOptions(options);this.toolTip=new Element('div',{'class':this.options.className+'-tip','styles':{'position':'absolute','top':'0','left':'0','visibility':'hidden'}}).inject(document.body);this.wrapper=new Element('div').inject(this.toolTip);$$(elements).each(this.build,this);if(this.options.initialize)this.options.initialize.call(this)},build:function(el){el.$tmp.myTitle=(el.href&&el.getTag()=='a')?el.href.replace('http://',''):(el.rel||false);if(el.title){var dual=el.title.split('::');if(dual.length>1){el.$tmp.myTitle=dual[0].trim();el.$tmp.myText=dual[1].trim()}else{el.$tmp.myText=el.title}el.removeAttribute('title')}else{el.$tmp.myText=false}if(el.$tmp.myTitle&&el.$tmp.myTitle.length>this.options.maxTitleChars)el.$tmp.myTitle=el.$tmp.myTitle.substr(0,this.options.maxTitleChars-1)+"&hellip;";el.addEvent('mouseenter',function(event){this.start(el);if(!this.options.fixed)this.locate(event);else this.position(el)}.bind(this));if(!this.options.fixed)el.addEvent('mousemove',this.locate.bindWithEvent(this));var end=this.end.bind(this);el.addEvent('mouseleave',end);el.addEvent('trash',end)},start:function(el){this.wrapper.empty();if(el.$tmp.myTitle){this.title=new Element('span').inject(new Element('div',{'class':this.options.className+'-title'}).inject(this.wrapper)).setHTML(el.$tmp.myTitle)}if(el.$tmp.myText){this.text=new Element('span').inject(new Element('div',{'class':this.options.className+'-text'}).inject(this.wrapper)).setHTML(el.$tmp.myText)}$clear(this.timer);this.timer=this.show.delay(this.options.showDelay,this)},end:function(event){$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this)},position:function(element){var pos=element.getPosition();this.toolTip.setStyles({'left':pos.x+this.options.offsets.x,'top':pos.y+this.options.offsets.y})},locate:function(event){var win={'x':window.getWidth(),'y':window.getHeight()};var scroll={'x':window.getScrollLeft(),'y':window.getScrollTop()};var tip={'x':this.toolTip.offsetWidth,'y':this.toolTip.offsetHeight};var prop={'x':'left','y':'top'};for(var z in prop){var pos=event.page[z]+this.options.offsets[z];if((pos+tip[z]-scroll[z])>win[z])pos=event.page[z]-this.options.offsets[z]-tip[z];this.toolTip.setStyle(prop[z],pos)}},show:function(){if(this.options.timeout)this.timer=this.hide.delay(this.options.timeout,this);this.fireEvent('onShow',[this.toolTip])},hide:function(){this.fireEvent('onHide',[this.toolTip])}});Tips.implement(new Events,new Options);String.extend({stripTags:function(){return this.replace(/<\/?[^>]+>/gi,'')},stripScripts:function(){return this.replace(/<script[^>]*?>.*?<\/script>/img,'')},evalScripts:function(){var scripts=this.match(/<script[^>]*?>.*?<\/script>/g);if(scripts)scripts.each(function(script){eval(script.replace(/^<script[^>]*?>/,'').replace(/<\/script>$/,''))})},replaceAll:function(searchValue,replaceValue,regExOptions){return this.replace(new RegExp(searchValue,$pick(regExOptions,'gi')),replaceValue)},urlEncode:function(){return(this.test('%'))?this:escape(this)},parseQuery:function(){var vars=this.split(/[&;]/);var rs={};if(vars.length)vars.each(function(val){var keys=val.split('=');if(keys.length&&keys.length==2)rs[encodeURIComponent(keys[0])]=encodeURIComponent(keys[1])});return rs},tidy:function(){var txt=this.toString();$each({"[\xa0\u2002\u2003\u2009]":" ","\xb7":"*","[\u2018\u2019]":"'","[\u201c\u201d]":'"',"\u2026":"...","\u2013":"-","\u2014":"--"},function(value,key){txt=txt.replace(new RegExp(key,'g'),value)});return txt}});window.extend({isLoaded:window.loaded,getHost:function(url){url=$pick(url,window.location.href);var host=url;if(url.test('http://')){url=url.substring(url.indexOf('http://')+7,url.length);if(url.test(':'))url=url.substring(0,url.indexOf(":"));if(url.test('/'))return url.substring(0,url.indexOf('/'));return url}return false},getQueryStringValue:function(key,url){try{return window.getQueryStringValues(url)[key]}catch(e){return null}},getQueryStringValues:function(url){var qs=$pick(url,$pick(window.location.search,'')).split('?')[1];if(qs)return qs.parseQuery();return{}},getPort:function(url){url=$pick(url,window.location.href);var re=new RegExp(':([0-9]{4})');var m=re.exec(url);if(m==null)return false;else{var port=false;m.each(function(val){if($chk(parseInt(val)))port=val})}return port},qs:{}});window.qs=window.getQueryStringValues();window.popup=new Class({options:{width:500,height:300,x:50,y:50,toolbar:0,location:0,directories:0,status:0,scrollbars:'auto',resizable:1,name:'popup',onBlock:Class.empty},initialize:function(url,options){this.url=url||false;this.setOptions(options);if(this.url)this.openWin();return this},openWin:function(url){url=url||this.url;var options='toolbar='+this.options.toolbar+',location='+this.options.location+',directories='+this.options.directories+',status='+this.options.status+',scrollbars='+this.options.scrollbars+',resizable='+this.options.resizable+',width='+this.options.width+',height='+this.options.height+',top='+this.options.y+',left='+this.options.x;this.popupWindow=window.open(url,this.options.name,options);this.focus.delay(100,this);return this.popupWindow},focus:function(){if(this.popupWindow)this.popupWindow.focus();else if(this.focusTries<10)this.focus.delay(100,this);else{this.blocked=true;this.fireEvent('onBlock')}return this},focusTries:0,blocked:null,close:function(){this.popupWindow.close()}});window.popup.implement(new Options);window.popup.implement(new Events);var legacyPopup=window.popup.extend({setOptions:function(){this.parent();this.options=Object.extend({width:516,height:350},this.options)}});function openPop(url){return new legacyPopup(url)}var GetValue=window.getQueryStringValue;Element.extend({isVisible:function(){return this.getStyle('display')!='none'},toggle:function(){return this[this.isVisible()?'hide':'show']()},hide:function(){this.originalDisplay=this.getStyle('display');this.setStyle('display','none');return this},show:function(display){this.originalDisplay=(this.originalDisplay=="none")?'block':this.originalDisplay;this.setStyle('display',(display||this.originalDisplay||'block'));return this},tidy:function(){try{if(this.getValue().tidy())this.value=this.getValue().tidy()}catch(e){dbug.log('element.tidy error: %o',e)}},findParent:function(collection){return $$(collection).filter(function(el){return el.hasChild(this)},this)[0]},fxOpacityOk:function(){if(!window.ie6)return true;var isColor=false;try{if(new Color(this.getStyle('backgroundColor')))isColor=true}catch(e){}return isColor}});Element.visible=Element.isVisible;if(!Element.empty){Element.extend({empty:function(){return this.setHTML('')}})}var $S=$$;Element.extend({getDimensions:function(options){options=$merge({computeSize:false},options);var dim={};function getSize(el,options){if(options.computeSize)dim=el.getComputedSize(options);else{dim.width=el.getSize().size.x;dim.height=el.getSize().size.y}return dim}try{dim=getSize(this,options)}catch(e){}if(this.getStyle('display')=='none'){var before={};['visibility','display','position'].each(function(style){before[style]=this.style[style]||''},this);this.setStyles({visibility:'hidden',display:'block',position:'absolute'});dim=getSize(this,options);this.setStyles(before)}return $merge(dim,{x:dim.width,y:dim.height})},getComputedSize:function(options){options=$merge({styles:['padding','border'],plains:{height:['top','bottom'],width:['left','right']},mode:'both'},options);var size={width:0,height:0};switch(options.mode){case'vertical':delete size.width;delete options.plains.width;break;case'horizontal':delete size.height;delete options.plains.height;break}var getStyles=[];$each(options.plains,function(plain,key){plain.each(function(edge){options.styles.each(function(style){getStyles.push((style=="border")?style+'-'+edge+'-'+'width':style+'-'+edge)})})});var styles=this.getStyles.apply(this,getStyles);var subtracted=[];$each(options.plains,function(plain,key){size['total'+key.capitalize()]=0;size['computed'+key.capitalize()]=0;plain.each(function(edge){size['computed'+edge.capitalize()]=0;getStyles.each(function(style,i){if(style.test(edge)){styles[style]=styles[style].toInt();if(isNaN(styles[style]))styles[style]=0;size['total'+key.capitalize()]=size['total'+key.capitalize()]+styles[style];size['computed'+edge.capitalize()]=size['computed'+edge.capitalize()]+styles[style]}if(style.test(edge)&&key!=style&&(style.test('border')||style.test('padding'))&&!subtracted.test(style)){subtracted.push(style);size['computed'+key.capitalize()]=size['computed'+key.capitalize()]-styles[style]}})})});if($chk(size.width)){size.width=size.width+this.offsetWidth+size.computedWidth;size.totalWidth=size.width+size.totalWidth;delete size.computedWidth}if($chk(size.height)){size.height=size.height+this.offsetHeight+size.computedHeight;size.totalHeight=size.height+size.totalHeight;delete size.computedHeight}return $merge(styles,size)}});Element.extend({getTextInRange:function(start,end){return this.getValue().substring(start,end)},getSelectedText:function(){if(window.ie)return document.selection.createRange().text;return this.getValue().substring(this.getSelectionStart(),this.getSelectionEnd())},getSelectionStart:function(){if(window.ie){this.focus();var range=document.selection.createRange();var tmp=range.duplicate();tmp.moveToElementText(this);tmp.setEndPoint('EndToEnd',range);return tmp.text.length-range.text.length}return this.selectionStart},getSelectionEnd:function(){if(window.ie){this.focus();var range=document.selection.createRange();var tmp=range.duplicate();tmp.moveToElementText(this);tmp.setEndPoint('EndToEnd',range);return this.getSelectionStart()+range.text.length}return this.selectionEnd},getSelectedRange:function(){return{start:this.getSelectionStart(),end:this.getSelectionEnd()}},setCaretPosition:function(pos){if(pos=='end')pos=this.getValue().length;this.selectRange(pos,pos);return this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(start,end){this.focus();if(window.ie){var range=this.createTextRange();range.collapse(true);range.moveStart('character',start);range.moveEnd('character',end-start);range.select();return this}this.setSelectionRange(start,end);return this},insertAtCursor:function(value,select){var start=this.getSelectionStart();var end=this.getSelectionEnd();this.value=this.getValue().substring(0,start)+value+this.getValue().substring(end,this.getValue().length);if($pick(select,true))this.selectRange(start,start+value.length);else this.setCaretPosition(start+value.length);return this},insertAroundCursor:function(options,select){options=$merge({before:'',defaultMiddle:'SOMETHING HERE',after:''},options);value=this.getSelectedText()||options.defaultMiddle;var start=this.getSelectionStart();var end=this.getSelectionEnd();if(start==end){var text=this.getValue();this.value=text.substring(0,start)+options.before+value+options.after+text.substring(end,text.length);this.selectRange(start+options.before.length,end+options.before.length+value.length);text=null}else{text=this.getValue().substring(start,end);this.value=this.getValue().substring(0,start)+options.before+text+options.after+this.getValue().substring(end,this.getValue().length);var selStart=start+options.before.length;if($pick(select,true))this.selectRange(selStart,selStart+text.length);else this.setCaretPosition(selStart+text.length)}return this}});window.extend({supportsPositionFixed:function(){if(!window.loaded)return null;var test=new Element('div').setStyles({position:'fixed',top:'0px',right:'0px'}).injectInside(document.body);var supported=(test.offsetTop===0);test.remove();return supported}});Element.extend({pin:function(enable){var p=this.getPosition();if(enable!==false){if(!this.pinned){var pos={top:(p.y-window.getScrollTop())+'px',left:(p.x-window.getScrollLeft())+'px'};if(window.supportsPositionFixed()){this.setStyle('position','fixed').setStyles(pos)}else{this.setStyles({position:'absolute',top:p.y+'px',left:p.x+'px'});window.addEvent('scroll',function(){if(this.pinned){var to={top:(pos.top.toInt()+window.getScrollTop())+'px',left:(pos.left.toInt()+window.getScrollLeft())+'px'};this.setStyles(to)}}.bind(this))}this.pinned=true}}else{this.pinned=false;var reposition=(window.supportsPositionFixed())?{top:(p.y+window.getScrollTop())+'px',left:(p.x+window.getScrollLeft())+'px'}:{top:(p.y)+'px',left:(p.x)+'px'};this.setStyles($merge(reposition,{position:'absolute'}))}return this},unpin:function(){return this.pin(false)},togglepin:function(){this.pin(!this.pinned)}});Element.extend({setPosition:function(options){options=$merge({relativeTo:document.body,position:{x:'center',y:'center'},edge:false,offset:{x:0,y:0},returnPos:false,relFixedPosition:false,ignoreMargins:false,overflown:[]},options);var parentOffset={x:0,y:0};var parentPositioned=false;if(this.getParent()!=document.body){var parent=this.getParent();while(parent!=document.body&&parent.getStyle('position')=="static"){parent=parent.getParent()}if(parent!=document.body){parentOffset=parent.getPosition();parentPositioned=true}options.offset.x=options.offset.x-parentOffset.x;options.offset.y=options.offset.y-parentOffset.y}function fixValue(option){if($type(option)!="string")return option;option=option.toLowerCase();var val={};if(option.test('left'))val.x='left';else if(option.test('right'))val.x='right';else val.x='center';if(option.test('upper')||option.test('top'))val.y='top';else if(option.test('bottom'))val.y='bottom';else val.y='center';return val};options.edge=fixValue(options.edge);options.position=fixValue(options.position);if(!options.edge){if(options.position.x=='center'&&options.position.y=='center')options.edge={x:'center',y:'center'};else options.edge={x:'left',y:'top'}}this.setStyle('position','absolute');var rel=$(options.relativeTo)||document.body;if(window.opera){var top=(rel==document.body)?window.getScrollTop():rel.getTop();var left=(rel==document.body)?window.getScrollLeft():rel.getLeft()}else{var top=(rel==document.body)?window.getScrollTop():rel.getTop(options.overflown);var left=(rel==document.body)?window.getScrollLeft():rel.getLeft(options.overflown)}if(top<0)top=0;if(left<0)left=0;var dim=this.getDimensions({computeSize:true,styles:['padding','border','margin']});if(options.ignoreMargins){options.offset.x+=((options.edge&&options.edge.x=="right")?dim['margin-right']:-dim['margin-left']);options.offset.y+=((options.edge&&options.edge.y=="bottom")?dim['margin-bottom']:-dim['margin-top'])}var pos={};var prefY=options.offset.y.toInt();var prefX=options.offset.x.toInt();switch(options.position.x){case'left':pos.x=left+prefX;break;case'right':pos.x=left+prefX+rel.offsetWidth;break;default:pos.x=left+(((rel==document.body)?window.getWidth():rel.offsetWidth)/2)+prefX;break};switch(options.position.y){case'top':pos.y=top+prefY;break;case'bottom':pos.y=top+prefY+rel.offsetHeight;break;default:pos.y=top+(((rel==document.body)?window.getHeight():rel.offsetHeight)/2)+prefY;break};if(options.edge){var edgeOffset={};switch(options.edge.x){case'left':edgeOffset.x=0;break;case'right':edgeOffset.x=-dim.x-dim.computedRight-dim.computedLeft;break;default:edgeOffset.x=-(dim.x/2);break};switch(options.edge.y){case'top':edgeOffset.y=0;break;case'bottom':edgeOffset.y=-dim.y-dim.computedTop-dim.computedBottom;break;default:edgeOffset.y=-(dim.y/2);break};pos.x=pos.x+edgeOffset.x;pos.y=pos.y+edgeOffset.y}pos={left:((pos.x>=0||parentPositioned)?pos.x:0).toInt()+'px',top:((pos.y>=0||parentPositioned)?pos.y:0).toInt()+'px'};if(rel.getStyle('position')=="fixed"||options.relFixedPosition){pos.top=pos.top.toInt()+window.getScrollTop()+'px';pos.left=pos.left.toInt()+window.getScrollLeft()+'px'}if(options.returnPos)return pos;if(options.smoothMove)new Fx.SmoothMove(this,options).start();else this.setStyles(pos);return this}});Fx.Marquee=Fx.Styles.extend({options:{mode:'horizontal',message:'',revert:true,delay:5000,cssClass:'msg',showEffect:{opacity:1},hideEffect:{opacity:0},revertEffect:{opacity:[0,1]},currentMessage:null,onRevert:Class.empty,onMessage:Class.empty},initialize:function(container,options){container=$(container);var msg=this.options.currentMessage||(container.getChildren().length==1)?container.getFirst():'';var wrapper=new Element('div',{styles:{position:'relative'},'class':'fxMarqueeWrapper'}).injectInside(container);this.parent(wrapper,options);this.current=this.wrapMessage(msg)},wrapMessage:function(msg){if($(msg)&&$(msg).hasClass('fxMarquee')){var wrapper=$(msg)}else{var wrapper=new Element('span',{'class':'fxMarquee',styles:{position:'relative'}});if($(msg))wrapper.adopt($(msg));else if($type(msg)=="string")wrapper.setHTML(msg)}return wrapper.injectInside(this.element)},announce:function(options){this.setOptions(options).showMessage();return this},showMessage:function(reverting){(function(){var chain=this.chains?this.chains.copy():[];this.clearChain();this.element=$(this.element);this.current=$(this.current);this.message=$(this.message);this.start(this.options.hideEffect).chain(function(){if(reverting){this.message.hide();if(this.current)this.current.show()}else{if(this.message)this.message.remove();this.message=this.wrapMessage(this.options.message);if(this.current)this.current.hide()}this.start((reverting)?this.options.revertEffect:this.options.showEffect).chain(function(){this.chains.merge(chain);this.fireEvent((reverting)?'onRevert':'onMessage');if(!reverting&&this.options.revert)this.showMessage(true);else this.callChain.delay(this.options.delay,this)}.bind(this))}.bind(this))}).delay((reverting)?this.options.delay:10,this);return this}});Fx.SmoothShow=Fx.Styles.extend({options:{styles:['padding','border','margin'],transitionOpacity:true,mode:'vertical',heightOverride:null,widthOverride:null},fixStyle:function(style,name){if(!$type(style)=="number")return style;var fix=['margin','padding','width','height'].some(function(st){return name.test(st,'i')});return(fix)?style+'px':style},hide:function(){try{if(!this.hiding&&!this.showing){if(this.element.getStyle('display')!='none'){this.hiding=true;this.showing=false;this.hidden=true;var startStyles=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});if(this.element.fxOpacityOk()&&this.options.transitionOpacity)startStyles.opacity=1;var zero={};$each(startStyles,function(style,name){zero[name]=this.fixStyle(0,name)},this);this.chain(function(){if(this.hidden){this.hiding=false;$each(startStyles,function(style,name){startStyles[name]=this.fixStyle(style,name)},this);this.element.setStyles(startStyles).setStyle('display','none')}this.callChain()}.bind(this));this.start(zero)}else{this.callChain.delay(10,this);this.fireEvent('onComplete',this.element)}}}catch(e){this.element.hide();this.callChain.delay(10,this);this.fireEvent('onComplete',this.element)}return this},show:function(){try{if(!this.showing&&!this.hiding){if(this.element.getStyle('display')=="none"||this.element.getStyle('visiblity')=="hidden"||this.element.getStyle('opacity')==0){this.showing=true;this.hiding=false;this.hidden=false;var before=this.element.getStyles('visibility','display','position');this.element.setStyles({visibility:'hidden',display:'block',position:'absolute'});if(this.element.fxOpacityOk()&&this.options.transitionOpacity)this.element.setStyle('opacity',0);var startStyles=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});this.element.setStyles(before);$each(startStyles,function(style,name){startStyles[name]=this.fixStyle(style,name)},this);if($chk(this.options.heightOverride))startStyles['height']=this.options.heightOverride.toInt()+'px';if($chk(this.options.widthOverride))startStyles['width']=this.options.widthOverride.toInt()+'px';if(this.element.fxOpacityOk()&&this.options.transitionOpacity)startStyles.opacity=1;var zero={height:'0px',display:'block'};$each(startStyles,function(style,name){zero[name]=this.fixStyle(0,name)},this);this.element.setStyles(zero);this.start(startStyles);this.chain(function(){if(!this.hidden)this.showing=false;this.callChain()}.bind(this))}else{this.callChain();this.fireEvent('onComplete',this.element)}}}catch(e){this.element.setStyles({display:'block',visiblity:'visible',opacity:1});this.callChain.delay(10,this);this.fireEvent('onComplete',this.element)}return this},toggle:function(){try{if(this.element.getStyle('display')=="none"||this.element.getStyle('visiblity')=="hidden"||this.element.getStyle('opacity')==0){this.show()}else{this.hide()}}catch(e){this.show()}return this}});Fx.SmoothShow.implement(new Options);Fx.SmoothShow.implement(new Events);Element.extend({smoothShow:function(options){if(arguments[1]){options.heightOverride=arguments[1]}return new Fx.SmoothShow(this,options).show()},smoothHide:function(options){if(arguments[1]){options.heightOverride=arguments[1]}return new Fx.SmoothShow(this,options).hide()}});Fx.SmoothMove=Fx.Styles.extend({options:{relativeTo:document.body,position:'center',edge:false,offset:{x:0,y:0}},start:function(destination){return this.parent(this.element.setPosition($merge(this.options,destination,{returnPos:true})))}});Element.extend({smoothMove:function(options){return new Fx.SmoothMove(this,options).start()}});Fx.Sort=Fx.Elements.extend({options:{mode:'vertical'},initialize:function(elements,options){this.parent(elements,options);this.elements.each(function(el){if(el.getStyle('position')=='static')el.setStyle('position','relative')});this.setDefaultOrder()},setDefaultOrder:function(){this.currentOrder=this.elements.map(function(el,index){return index})},sort:function(newOrder){if($type(newOrder)!='array')return false;var top=0;var left=0;var zero={};var vert=this.options.mode=="vertical";var current=this.elements.map(function(el,index){var size=el.getComputedSize({styles:['border','padding','margin']});var val;if(vert){val={top:top,margin:size['margin-top'],height:size.totalHeight};top+=val.height-size['margin-top']}else{val={left:left,margin:size['margin-left'],width:size.totalWidth};left+=val.width}var plain=vert?'top':'left';zero[index]={};var start=el.getStyle(plain).toInt();zero[index][plain]=($chk(start))?start:0;return val},this);this.set(zero);newOrder=newOrder.map(function(i){return i.toInt()});if(newOrder.length!=this.elements.length){this.currentOrder.each(function(index){if(!newOrder.contains(index))newOrder.push(index)});if(newOrder.length>this.elements.length){newOrder.splice(this.elements.length-1,newOrder.length-this.elements.length)}}var top=0;var left=0;var margin=0;var next={};newOrder.each(function(item,index){var newPos={};if(vert){newPos.top=top-current[item].top-margin;top+=current[item].height}else{newPos.left=left-current[item].left;left+=current[item].width}margin=margin+current[item].margin;next[item]=newPos},this);var mapped={};newOrder.sort().each(function(index){mapped[index]=next[index]});this.start(mapped);this.currentOrder=newOrder;return this},rearrangeDOM:function(newOrder){newOrder=newOrder||this.currentOrder;var parent=this.elements[0].getParent();var rearranged=[];this.elements.setStyle('opacity',0);newOrder.each(function(index){rearranged.push(this.elements[index].injectInside(parent).setStyles({top:0,left:0}))},this);this.elements.setStyle('opacity',1);this.elements=rearranged;this.setDefaultOrder();return this},getDefaultOrder:function(){return this.elements.map(function(el,index){return index})},forward:function(){return this.sort(this.getDefaultOrder())},backward:function(){return this.sort(this.getDefaultOrder().reverse())},reverse:function(){return this.sort(this.currentOrder.reverse())},sortByElements:function(elements){return this.sort(elements.map(function(el){return this.elements.indexOf(el)}))},swap:function(one,two){if($type(one)=='element'){one=this.elements.indexOf(one);two=this.elements.indexOf(two)}var indexOne=this.currentOrder.indexOf(one);var indexTwo=this.currentOrder.indexOf(two);var newOrder=this.currentOrder.copy();newOrder[indexOne]=two;newOrder[indexTwo]=one;this.sort(newOrder)}});var RandomValueCookieMaker=new Class({options:{cookieName:false,limit:10,days:999,domain:false},initialize:function(options){this.setOptions(options);if(this.options.cookieName)this.verify();else{dbug.log('you must specify a cookie name.');return}},verify:function(){this.val=Cookie.get(this.options.cookieName);if(!$chk(parseInt(this.val))){this.val=this.makeRand();this.saveVal()}},saveVal:function(val){this.val=$pick(val,this.val);if(this.options.domain)Cookie.set(this.options.cookieName,this.val,{duration:this.options.days,domain:this.options.domain});else Cookie.set(this.options.cookieName,this.val,this.options.days)},makeSeed:function(){return((new Date().getTime()*9301+49297)%233280)/(233280.0)},makeRand:function(){return Math.ceil(this.makeSeed()*this.options.limit)}});RandomValueCookieMaker.implement(new Options);var randomValueCookieMaker=RandomValueCookieMaker;var simpleTemplateParser={STP:{},parseTemplate:function(template,object,regexOptions,wrappers){var STP=this.STP;STP.template=template;STP.object=object;STP.regexOptions=$pick(regexOptions,'ig');STP.wrappers=$pick(wrappers,{before:'%',after:'%'});return STP.result=this.runParser(STP.object,STP.template,STP.regexOptions)},runParser:function(object,string,regexOptions){for(value in object){switch($type(object[value])){case'string':string=this.tmplSubst(value,object[value],string,regexOptions);break;case'number':string=this.tmplSubst(value,object[value],string,regexOptions);break;case'object':string=this.runParser(object[value]);break;case'array':string=this.tmplSubst(value,object[value].toString(),string,regexOptions);break}}return string},tmplSubst:function(key,value,string,regexOptions){return string.replace(new RegExp(this.STP.wrappers.before+key+this.STP.wrappers.after,'gi'),value)}};function fixPNG(el){try{if(window.ie6){el=$(el);if(!el)return el;if(el.getTag()=="img"&&el.getProperty('src').test(".png")){var vis=el.isVisible();try{dim=el.getSize()}catch(e){}if(!vis){var before={};['visibility','display','position'].each(function(style){before[style]=this.style[style]||''},this);this.setStyles({visibility:'hidden',display:'block',position:'absolute'});dim=el.getSize();this.setStyles(before);el.hide()}var replacement=new Element('span',{id:(el.id)?el.id:'','class':(el.className)?el.className:'',title:(el.title)?el.title:(el.alt)?el.alt:'',styles:{display:vis?'inline-block':'none',width:dim.size.x+'px',height:dim.size.y+'px',filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+el.src+"', sizingMethod='scale');"},src:el.src});if(el.style.cssText){try{var styles={};var s=el.style.cssText.split(';');s.each(function(style){var n=style.split(':');styles[n[0]]=n[1]});replacement.setStyle(styles)}catch(e){dbug.log('fixPNG1: ',e)}}if(replacement.cloneEvents)replacement.cloneEvents(el);el.replaceWith(replacement)}else if(el.getTag()!="img"){var imgURL=el.getStyle('background-image');if(imgURL.test(/\((.+)\)/)){el.setStyles({background:'',filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+imgURL.match(/\((.+)\)/)[1]+"')"})}}}}catch(e){dbug.log('fixPNG2: ',e)}};if(window.ie6)window.addEvent('domready',function(){$$('img.fixPNG').each(fixPNG)});var IframeShim=new Class({options:{element:false,name:'',className:'iframeShim',display:false,name:'',zindex:false,margin:0,offset:{x:0,y:0},browsers:(window.ie6||(window.gecko&&navigator.userAgent.test('mac','i')))},initialize:function(options){this.setOptions(options);if(this.options.offset&&this.options.offset.top)this.options.offset.y=this.options.offset.top;if(this.options.offset&&this.options.offset.left)this.options.offset.x=this.options.offset.left;this.element=$(this.options.element);if(!this.element)return;else this.makeShim();return},makeShim:function(){this.shim=new Element('iframe');this.id=(this.options.name||new Date().getTime())+"_shim";if(this.element.getStyle('z-Index').toInt()<1||isNaN(this.element.getStyle('z-Index').toInt()))this.element.setStyle('z-Index',5);var z=this.element.getStyle('z-Index')-1;if($chk(this.options.zindex)&&this.element.getStyle('z-Index').toInt()>this.options.zindex)z=this.options.zindex;this.shim.setStyles({'position':'absolute','zIndex':z,'border':'none','filter':'progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)'}).setProperties({'src':'javascript:void(0);','frameborder':'0','scrolling':'no','id':this.id}).addClass(this.options.className);var inject=function(){this.shim.injectInside(document.body);if(this.options.display)this.show();else this.hide();this.fireEvent('onInject')};if(this.options.browsers){if(window.ie&&!IframeShim.ready){window.addEvent('load',inject.bind(this))}else{inject.bind(this)()}}},position:function(shim){if(!this.options.browsers||!IframeShim.ready)return;var wasVis=this.element.getStyle('display')!='none';if(!wasVis)this.element.setStyle('display','block');var size=this.element.getSize().size;var pos=this.element.getPosition();if(!wasVis)this.element.setStyle('display','none');if($type(this.options.margin)){size.x=size.x-(this.options.margin*2);size.y=size.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}this.shim.setStyles({'width':size.x+'px','height':size.y+'px'}).setPosition({relativeTo:this.element,offset:this.options.offset})},hide:function(){if(!this.options.browsers)return;this.shim.setStyle('display','none')},show:function(){if(!this.options.browsers)return;this.shim.setStyle('display','block');this.position()},remove:function(){if(!this.options.browsers)return;this.shim.remove()}});IframeShim.implement(new Options);IframeShim.implement(new Events);var iframeShim=IframeShim;window.addEvent('load',function(){IframeShim.ready=true});var InputValidator=new Class({initialize:function(className,options){this.setOptions({errorMsg:'Validation failed.',test:function(field){return true}},options);this.className=className},test:function(field){if($(field))return this.options.test($(field),this.getProps(field));else return false},getError:function(field){var err=this.options.errorMsg;if($type(err)=="function")err=err($(field),this.getProps(field));return err},getProps:function(field){if($(field)&&$(field).getProperty('validatorProps')){try{return Json.evaluate($(field).getProperty('validatorProps'))}catch(e){return{}}}else{return{}}}});InputValidator.implement(new Options);var FormValidator=new Class({options:{fieldSelectors:"input, select, textarea",useTitles:false,evaluateOnSubmit:true,evaluateFieldsOnBlur:true,evaluateFieldsOnChange:true,serial:true,warningPrefix:"Warning: ",errorPrefix:"Error: ",onFormValidate:function(isValid,form){},onElementValidate:function(isValid,field){}},initialize:function(form,options){this.setOptions(options);try{this.form=$(form);if(this.options.evaluateOnSubmit)this.form.addEvent('submit',this.onSubmit.bind(this));if(this.options.evaluateFieldsOnBlur)this.watchFields()}catch(e){}},getFields:function(){return this.fields=this.form.getElementsBySelector(this.options.fieldSelectors)},watchFields:function(){try{this.getFields().each(function(el){el.addEvent('blur',this.validateField.pass([el,false],this));if(this.options.evaluateFieldsOnChange)el.addEvent('change',this.validateField.pass([el,true],this))},this)}catch(e){}},onSubmit:function(event){if(!this.validate(event))new Event(event).stop();else{this.stop();this.reset()}},reset:function(){this.getFields().each(this.resetField,this)},validate:function(event){var result=this.getFields().map(function(field){return this.validateField(field,true)},this);result=result.every(function(val){return val});this.fireEvent('onFormValidate',[result,this.form,event]);return result},validateField:function(field,force){if(this.paused)return true;field=$(field);var result=true;var failed=this.form.getElement('.validation-failed');var warned=this.form.getElement('.warning');if(field&&(!failed||force||field==failed||(failed&&!this.options.serial))){var validators=field.className.split(" ").some(function(cn){return this.getValidator(cn)},this);result=field.className.split(" ").map(function(className){return this.test(className,field)},this);result=result.every(function(val){return val});if(validators&&!field.hasClass('warnOnly')){if(result)field.addClass('validation-passed').removeClass('validation-failed');else field.addClass('validation-failed').removeClass('validation-passed')}if(!warned||force||(warned&&!this.options.serial)){var warnings=field.className.split(" ").some(function(cn){if(cn.test('^warn-')||field.hasClass('warnOnly'))return this.getValidator(cn.replace(/^warn-/,""));return null},this);field.removeClass('warning');var warnResult=field.className.split(" ").map(function(cn){if(cn.test('^warn-')||field.hasClass('warnOnly'))return this.test(cn.replace(/^warn-/,""),field,true);return null},this)}}return result},getPropName:function(className){return'__advice'+className},test:function(className,field,warn){if(field.hasClass('ignoreValidation'))return true;warn=$pick(warn,false);if(field.hasClass('warnOnly'))warn=true;field=$(field);var isValid=true;if(field){var validator=this.getValidator(className);if(validator&&this.isVisible(field)){isValid=validator.test(field);if(!isValid&&validator.getError(field)){if(warn)field.addClass('warning');var advice=this.makeAdvice(className,field,validator.getError(field),warn);this.insertAdvice(advice,field);this.showAdvice(className,field)}else this.hideAdvice(className,field);this.fireEvent('onElementValidate',[isValid,field])}}if(warn)return true;return isValid},showAdvice:function(className,field){var advice=this.getAdvice(className,field);if(advice&&!field[this.getPropName(className)]&&(advice.getStyle('display')=="none"||advice.getStyle('visiblity')=="hidden"||advice.getStyle('opacity')==0)){field[this.getPropName(className)]=true;if(advice.smoothShow)advice.smoothShow();else advice.setStyle('display','block')}},hideAdvice:function(className,field){var advice=this.getAdvice(className,field);if(advice&&field[this.getPropName(className)]){field[this.getPropName(className)]=false;if(advice.smoothHide)advice.smoothHide();else advice.setStyle('display','none')}},isVisible:function(field){while(field.tagName!='BODY'){if($(field).getStyle('display')=="none")return false;field=field.getParent()}return true},getAdvice:function(className,field){return $('advice-'+className+'-'+this.getFieldId(field))},makeAdvice:function(className,field,error,warn){var errorMsg=(warn)?this.options.warningPrefix:this.options.errorPrefix;errorMsg+=(this.options.useTitles)?$pick(field.title,error):error;var advice=this.getAdvice(className,field);if(!advice){var cssClass=(warn)?'warning-advice':'validation-advice';advice=new Element('div').addClass(cssClass).setProperty('id','advice-'+className+'-'+this.getFieldId(field)).setStyle('display','none').appendText(errorMsg)}else{advice.setHTML(errorMsg)}return advice},insertAdvice:function(advice,field){switch(field.type.toLowerCase()){case'radio':var p=$(field.parentNode);if(p){p.adopt(advice);break}default:advice.injectAfter($(field))}},getFieldId:function(field){return field.id?field.id:field.id="input_"+field.name},resetField:function(field){field=$(field);if(field){var cn=field.className.split(" ");cn.each(function(className){if(className.test('^warn-'))className=className.replace(/^warn-/,"");var prop=this.getPropName(className);if(field[prop])this.hideAdvice(className,field);field.removeClass('validation-failed');field.removeClass('warning');field.removeClass('validation-passed')},this)}},stop:function(){this.paused=true},start:function(){this.paused=false},ignoreField:function(field,warn){field=$(field);if(field){this.enforceField(field);if(warn)field.addClass('warnOnly');else field.addClass('ignoreValidation')}},enforceField:function(field){field=$(field);if(field){field.removeClass('warnOnly');field.removeClass('ignoreValidation')}}});FormValidator.implement(new Options);FormValidator.implement(new Events);FormValidator.adders={validators:{},add:function(className,options){this.validators[className]=new InputValidator(className,options);if(!this.initialize){this.implement({validators:this.validators})}},addAllThese:function(validators){$A(validators).each(function(validator){this.add(validator[0],validator[1])},this)},getValidator:function(className){return this.validators[className]}};Object.extend(FormValidator,FormValidator.adders);FormValidator.implement(FormValidator.adders);FormValidator.add('IsEmpty',{errorMsg:false,test:function(element){if(element.type=="select-one"||element.type=="select")return!(element.selectedIndex>=0&&element.options[element.selectedIndex].value!="");else return((element.getValue()==null)||(element.getValue().length==0))}});FormValidator.addAllThese([['required',{errorMsg:function(element){return'This field is required.'},test:function(element){return!FormValidator.getValidator('IsEmpty').test(element)}}],['minLength',{errorMsg:function(element,props){if($type(props.minLength))return'Please enter at least '+props.minLength+' characters (you entered '+element.getValue().length+' characters).';else return''},test:function(element,props){if($type(props.minLength))return(element.getValue().length>=$pick(props.minLength,0));else return true}}],['maxLength',{errorMsg:function(element,props){if($type(props.maxLength))return'Please enter no more than '+props.maxLength+' characters (you entered '+element.getValue().length+' characters).';else return''},test:function(element,props){return(element.getValue().length<=$pick(props.maxLength,10000))}}],['validate-number',{errorMsg:'Please enter a valid number in this field.',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||!/[^\d+$]/.test(element.getValue())}}],['validate-digits',{errorMsg:'Please use numbers only in this field. Please avoid spaces or other characters such as dots or commas.',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||(/[^a-zA-Z]/.test(element.getValue())&&/[\d]/.test(element.getValue()))}}],['validate-alpha',{errorMsg:'Please use letters only (a-z) in this field.',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||/^[a-zA-Z]+$/.test(element.getValue())}}],['validate-alphanum',{errorMsg:'Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed.',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||!/\W/.test(element.getValue())}}],['validate-date',{errorMsg:'Please use this date format: mm/dd/yyyy. For example 03/17/2006 for the 17th of March, 2006.',test:function(element){if(FormValidator.getValidator('IsEmpty').test(element))return true;var regex=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!regex.test(element.getValue()))return false;var d=new Date(element.getValue().replace(regex,'$1/$2/$3'));return(parseInt(RegExp.$1,10)==(1+d.getMonth()))&&(parseInt(RegExp.$2,10)==d.getDate())&&(parseInt(RegExp.$3,10)==d.getFullYear())}}],['validate-email',{errorMsg:'Please enter a valid email address. For example fred@domain.com .',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(element.getValue())}}],['validate-url',{errorMsg:'Please enter a valid URL.',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||/^(http|https|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(element.getValue())}}],['validate-date-au',{errorMsg:'Please use this date format: dd/mm/yyyy. For example 17/03/2006 for the 17th of March, 2006.',test:function(element){if(FormValidator.getValidator('IsEmpty').test(element))return true;var regex=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!regex.test(element.getValue()))return false;var d=new Date(element.getValue().replace(regex,'$2/$1/$3'));return(parseInt(RegExp.$2,10)==(1+d.getMonth()))&&(parseInt(RegExp.$1,10)==d.getDate())&&(parseInt(RegExp.$3,10)==d.getFullYear())}}],['validate-currency-dollar',{errorMsg:'Please enter a valid $ amount. For example $100.00 .',test:function(element){return FormValidator.getValidator('IsEmpty').test(element)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(element.getValue())}}],['validate-one-required',{errorMsg:'Please enter something for at least one of the above options.',test:function(element){var p=element.parentNode;var options=p.getElements('input');return $A(options).some(function(el){return el.getValue()})}}]]);var IconMenu=new Class({options:{container:document,images:".iconImgs",captions:".iconCaptions",removeLinks:false,clearLinks:false,useAxis:'x',onFocus:Class.empty,onFocusDelay:0,initialFocusDelay:250,onBlur:Class.empty,onEmpty:Class.empty,onBlurDelay:0,onRemoveItem:Class.empty,onRemoveItems:Class.empty,length:'auto',iconPadding:1,scrollFxOptions:{duration:1800,transition:Fx.Transitions.Cubic.easeInOut},onScroll:Class.empty,onPageForward:Class.empty,onPageBack:Class.empty,backScrollButtons:'#scrollLeft',forwardScrollButtons:'#scrollRight',onSelect:function(index,img){if(!this.borderFx[img.getProperty('id')])this.borderFx[img.getProperty('id')]=img.effects({duration:800});this.borderFx[img.getProperty('id')].start({'border-top-color':'#00A0C6','border-left-color':'#00A0C6','border-right-color':'#00A0C6','border-bottom-color':'#00A0C6'})},onDeSelect:function(index,img){if(!this.borderFx[img.getProperty('id')])this.borderFx[img.getProperty('id')]=img.effects({duration:800});this.borderFx[img.getProperty('id')].start({'border-top-color':'#555','border-left-color':'#555','border-right-color':'#555','border-bottom-color':'#555'})}},initialize:function(options){this.setOptions(options);this.container=$(this.options.container);this.imgs=[];this.captions=[];this.selected=[];var captions=($type(this.options.captions)=="string")?this.container.getElements(this.options.captions):this.options.captions;var imgs=($type(this.options.images)=="string")?this.container.getElements(this.options.images):this.options.images;imgs.each(function(img,index){this.addItem(img,captions[index],null)},this);this.fireEvent('onItemsAdded',this.imgs,50);this.side=(this.options.useAxis=='x')?'left':'top';this.container.setStyle(this.side,this.container.getStyle(this.side).toInt()||0);this.onFocusDelay=this.options.initialFocusDelay;this.setupEvents()},scrollTo:function(index,useFx){useFx=$pick(useFx,true);var currentRange=this.calculateRange();if(index==currentRange.start)return;var newRange=this.calculateRange(index);if(!newRange.elements.length)return;if(this.container.getStyle('position')=='static')this.container.setStyle('position','relative');if(!this.scrollerFx)this.scrollerFx=this.container.effect(this.side,$merge(this.options.scrollFxOptions,{wait:false}));if(useFx){this.scrollerFx.start(-newRange.elements[0].offset).chain(function(){this.fireEvent('onScroll',[index,newRange])}.bind(this))}else{this.scrollerFx.set(-newRange.elements[0].offset);this.fireEvent('onScroll',[index,newRange])}this.currentOffset=index},pageForward:function(howMany){var range=this.calculateRange();this.scrollTo(($type(howMany)=="number")?range.start+howMany:range.end)},pageBack:function(howMany){this.scrollTo(($type(howMany)=="number")?this.currentOffset-howMany:this.calculateRange(this.currentOffset,true).start)},addItem:function(img,caption,where){where=($defined(where))?where:this.imgs.length;if(this.imgs.contains(img))this.removeItems([img],true);this.imgs.splice(where,0,$(img));this.captions.splice(where,0,$(caption));var src=img.getProperty('src');if(!img.getProperty('id'))img.setProperty('id',src.substring(src.lastIndexOf('/')+1,src.lastIndexOf('.')));if(img.getProperty("src").test("$png")&&window.ie&&!img.hasClass('fixPNG'))fixPNG(img);this.setupIconEvents(img,caption);this.fireEvent('onAdd',[img,caption])},removeItems:function(imgs,useFx){var range=this.calculateRange();if(!imgs.length)return;imgs=imgs.copy();useFx=$pick(useFx,true);var fadeItems=[];var effect={width:0,'border-width':0};var fadeEffects={};var itemsToQuietlyRemove={before:[],after:[]};var indexes=[];imgs.each(function(image){var index=this.imgs.indexOf(image);if(index>=range.end){itemsToQuietlyRemove.after.push(image.getParent())}else if(index<range.start){itemsToQuietlyRemove.before.push(image.getParent())}else{fadeItems.push(image.getParent());fadeEffects[fadeItems.length-1]=$merge(effect)}this.selected.remove(image);indexes.push(index)},this);this.captions=this.captions.filter(function(caption,index){return!indexes.contains(index)});this.imgs=this.imgs.filter(function(img,index){return!indexes.contains(index)});var removed=[];if(itemsToQuietlyRemove.before.length){var scrollTo=this.imgs.indexOf(range.elements[0].image);itemsToQuietlyRemove.before.each(function(el){this.fireEvent('onRemoveItem',[el]);var img=el.getElement('img');removed.push(img.id);try{el.remove()}catch(e){dbug.log('before: error removing element %o, %o',el,e)}},this);this.scrollTo(scrollTo,false)}itemsToQuietlyRemove.after.each(function(el){this.fireEvent('onRemoveItem',[el]);removed.push(el.getElement('img').id);try{el.remove()}catch(e){dbug.log('after: error removing element %o, %o',el,e)}});function clean(range,additionalItems){var items=[];fadeItems.each(function(el){this.fireEvent('onRemoveItem',[el]);items.push(el.getElement('img').id);try{el.remove()}catch(e){dbug.log('fade: error removing element %o, %o',el,e)}},this);items.merge(additionalItems);this.fireEvent('onRemoveItems',[items]);range=this.calculateRange();if(range.elements==0&&range.start>0)this.pageBack();if(!this.imgs.length)this.fireEvent('onEmpty')}if(useFx)new Fx.Elements(fadeItems).start(fadeEffects).chain(clean.bind(this,[range,removed]));else clean.apply(this,[range,removed])},removeSelected:function(useFx){this.removeItems(this.selected,useFx)},empty:function(suppressEvent){var effect={};var items=[];this.imgs.each(function(img,index){items.push(img.getParent());effect[index]={opacity:0}});new Fx.Elements(items).start(effect).chain(function(){this.removeItems(this.imgs,false);if(!suppressEvent)this.fireEvent('onEmpty')}.bind(this))},selectItem:function(index,select){if(!this.borderFx)this.borderFx={};var img=this.imgs[index];var imgId=img.getProperty('id');if($defined(select)){if(select)img.addClass('selected');else img.removeClass('selected')}else{img.toggleClass('selected')}if(img.hasClass('selected')){this.selected.push(img);this.fireEvent('onSelect',[index,img])}else{this.selected.remove(img);this.fireEvent('onDeSelect',[index,img])}},getDefaultWidth:function(){if($type(this.options.length)=="number")return this.options.length;var container=$(this.options.length);if(!container)container=this.container.getParent();return container.getSize().size[this.options.useAxis]},getIconPositions:function(){var offsets=[];var cumulative=0;var prev;this.imgs.each(function(img,index){var parent=img.getParent();cumulative+=(prev)?img.offsetLeft-prev.offsetLeft:0;prev=img;offsets.push({image:img,size:parent.getSize().size[this.options.useAxis],offset:cumulative,container:parent})},this);return offsets},calculateRange:function(index,fromEnd){if(!this.imgs.length)return{start:0,end:0,elements:[]};index=$pick(index,this.currentOffset||0);if(index<0)index=0;var length=this.getDefaultWidth();var positions=this.getIconPositions();var referencePoint;if(positions[index]){referencePoint=positions[index].offset}else{var lastIcon=this.imgs.getLast().getParent();var coords=lastIcon.getCoordinates();referencePoint=coords.width+coords.left-lastIcon.getParent().getPosition().x}var range=positions.filter(function(position,i){if(fromEnd)return i<index&&position.offset<referencePoint&&position.offset>=referencePoint-length;else return i>=index&&position.offset+position.size<length+positions[index].offset});return(fromEnd)?{start:index-range.length,end:index,elements:range}:{start:index,end:range.length+index,elements:range}},inRange:function(index){var range=this.calculateRange();return index<range.end&&index>=range.start},setupEvents:function(){$(this.options.container).addEvents({"mouseleave":function(){if(this.inFocus)this.inFocus=null;this.imgOut(null,true)}.bind(this)});$$(this.options.backScrollButtons).each(function(el){el.addEvent('click',this.pageBack.bind(this))},this);$$(this.options.forwardScrollButtons).each(function(el){el.addEvent('click',this.pageForward.bind(this))},this);$$(this.options.clearLinks).each(function(el){el.addEvent('click',this.empty.bind(this))},this);$$(this.options.removeLinks).each(function(el){el.addEvent('click',this.removeSelected.bind(this))},this)},imgOver:function(img){this.inFocus=img;$clear(this.overTimeout);this.overTimeout=(function(){this.onFocusDelay=this.options.onFocusDelay;if(this.inFocus==img)this.fireEvent("onFocus",[img,this.imgs.indexOf(img)])}).delay(this.onFocusDelay,this)},imgOut:function(img,force){if(!$defined(img)&&force)img=this.prevFocus||this.imgs[0];if(this.inFocus==img&&img){this.inFocus=null;$clear(this.outTimeout);this.outTimeout=(function(){this.prevFocus=img;if(this.inFocus!=img||(img==null&&force))this.fireEvent("onBlur",[img,this.imgs.indexOf(img)]);if(!this.inFocus)this.onFocusDelay=this.options.initialFocusDelay}).delay(this.options.onBlurDelay,this)}},setupIconEvents:function(img,caption){img.addEvents({click:function(e){e=new Event(e);if(e.control){this.selectItem(this.imgs.indexOf(img));e.stop()}}.bind(this)});img.getParent().addEvents({mouseover:this.imgOver.bind(this,img),mouseout:this.imgOut.bind(this,img)})}});IconMenu.implement(new Events);IconMenu.implement(new Options);var Modalizer=new Class({defaultModalStyle:{display:'block',position:'fixed',top:'0px',left:'0px','z-index':5000,'background-color':'#333',opacity:0.8},setModalOptions:function(options){this.modalOptions=$merge({width:(window.getScrollWidth()+300)+'px',height:(window.getScrollHeight()+300)+'px',elementsToHide:'select',onModalHide:Class.empty,onModalShow:Class.empty,hideOnClick:true,modalStyle:{},updateOnResize:true},this.modalOptions,options||{})},resize:function(){if($('modalOverlay')){$('modalOverlay').setStyles({width:(window.getScrollWidth()+300)+'px',height:(window.getScrollHeight()+300)+'px'})}},setModalStyle:function(styleObject){this.modalOptions.modalStyle=styleObject;this.modalStyle=$merge(this.defaultModalStyle,{width:this.modalOptions.width,height:this.modalOptions.height},styleObject);if($('modalOverlay'))$('modalOverlay').setStyles(this.modalStyle);return(this.modalStyle)},modalShow:function(options){this.setModalOptions(options||{});var overlay=null;if($('modalOverlay'))overlay=$('modalOverlay');if(!overlay)overlay=new Element('div').setProperty('id','modalOverlay').injectInside(document.body);overlay.setStyles(this.setModalStyle(this.modalOptions.modalStyle));if(window.ie6)overlay.setStyle('position','absolute');$('modalOverlay').removeEvents('click').addEvent('click',function(){this.modalHide(this.modalOptions.hideOnClick)}.bind(this));this.bound=this.bound||{};if(!this.bound.resize&&this.modalOptions.updateOnResize){this.bound.resize=this.resize.bind(this);window.addEvent('resize',this.bound.resize)}this.modalOptions.onModalShow();this.togglePopThroughElements(0);overlay.setStyle('display','block');return this},modalHide:function(override){if(override===false)return false;this.togglePopThroughElements(1);this.modalOptions.onModalHide();if($('modalOverlay'))$('modalOverlay').setStyle('display','none');if(this.modalOptions.updateOnResize){this.bound=this.bound||{};if(!this.bound.resize)this.bound.resize=this.resize.bind(this);window.removeEvent('resize',this.bound.resize)}return this},togglePopThroughElements:function(opacity){if((window.ie6||(window.gecko&&navigator.userAgent.test('mac','i')))){$$(this.modalOptions.elementsToHide).each(function(sel){sel.setStyle('opacity',opacity)})}}});var modalizer=Modalizer;var ObjectBrowser=new Class({options:{onLeafClick:Class.empty,onBranchClick:function(data){this.showLevel(data.path?data.path+'.'+data.key:data.key,data.nodePath)},initPath:'',buildOnInit:true,data:{},excludeKeys:[],includeKeys:[]},initialize:function(container,options){this.container=$(container);this.setOptions(options);this.data=$H(this.options.data);this.levels={};this.elements={};if(this.options.buildOnInit)this.showLevel(this.options.initPath,this.container)},getMemberByPath:function(path,parent){if(path===""||path=="top")return this.data.obj;var member=this.data.obj;var steps=path.split(".");if(parent)steps.pop();steps.each(function(p){if(p==="")return;if(member[p])member=member[p];else if($chk(Number(p))&&member[Number(p)])member=member[Number(p)];else member=this.data.obj},this);return(member==this.data)?false:member},replaceMemberByPath:function(path,value){if(path===""||path=="top")return this.data=$H(value);var parentObj=this.getMemberByPath(path,true);parentObj[path.split(".").pop()]=value;return this.data},getPathByNode:function(el){var elements=$H(this.elements);return elements.keys()[elements.values.indexOf(el)]},validLevel:function(key){return(!this.options.excludeKeys.contains(key)&&(!this.options.includeKeys.length||this.options.includeKeys.contains(key)))},buildLevel:function(path){if(path.test(".$"))path=path.substring(0,path.length);var level=this.getMemberByPath(path);if(this.levels[path])return this.levels[path];var section=new Element('ul');switch($type(level)){case"function":this.buildNode(level,"function()",section,path,true);break;case"string":case"number":this.buildNode(level,null,section,path,true);break;case"array":level.each(function(node,index){this.buildNode(node,index,section,path,["string","function"].contains($type(node)))}.bind(this));break;default:$H(level).each(function(value,key){var db=false;if(key=="element_dimensions")db=true;if(db)dbug.log(key);if(this.validLevel(key)){if(db)dbug.log('is valid level');var isLeaf;if($type(value)=="object"){isLeaf=false;$each(value,function(v,k){if(this.validLevel(k)){if(db)dbug.log('not a leaf!');isLeaf=false}else{isLeaf=true}},this);if(isLeaf)value=false}if(db)dbug.log(value,key,section,path,$chk(isLeaf)?isLeaf:null);this.buildNode(value,key,section,path,$chk(isLeaf)?isLeaf:null)}},this)}this.levels[path]=section;return section},getParentFromPath:function(path){return this.elements[(path||"top")+'NODE']},showLevel:function(path,target,method){target=target||path;if(!this.elements[path])this.elements[path]=this.buildLevel(path)[method||"injectInside"](this.elements[target]||this.container);else this.elements[path].toggle();this.elements[path].getParent().toggleClass('collapsed')},buildNode:function(value,key,section,path,leaf){if(key===""||value==="")leaf=true;if(!this.validLevel(key))return null;var nodePath=(path?path+'.'+key:key)+'NODE';var lnk=this.buildLink((leaf)?value||key:$chk(key)?key:value,leaf);var li=new Element('li').addClass((leaf)?'leaf':'branch collapsed').adopt(lnk).injectInside(section);lnk.addEvent('click',function(e){new Event(e).stopPropagation();if(leaf){this.fireEvent('onLeafClick',{li:li,key:key,value:value,path:path,nodePath:nodePath,event:e})}else{this.fireEvent('onBranchClick',{li:li,key:key,value:value,path:path,nodePath:nodePath,event:e})}}.bind(this));this.elements[nodePath]=li;return li},buildLink:function(key){if($type(key)=="function"){key=key.toString();key=key.substring(0,key.indexOf("{")+1)+"..."}return new Element('a',{href:"javascript: void(0);"}).setHTML(key)}});ObjectBrowser.implement(new Options,new Events);function stickyWinHTML(caption,body,options){options=$merge({width:'300px',css:"div.DefaultStickyWin div.body{font-family:verdana; font-size:11px; line-height: 13px;}"+"div.DefaultStickyWin div.top_ul{background:url(%baseHref%full.png) top left no-repeat; height:30px; width:15px; float:left}"+"div.DefaultStickyWin div.top_ur{position:relative; left:0px !important; left:-4px; background:url(%baseHref%full.png) top right !important; height:30px; margin:0px 0px 0px 15px !important; margin-right:-4px; padding:0px}"+"div.DefaultStickyWin h1.caption{margin:0px 5px 0px 0px; overflow: hidden; padding:0; font-weight:bold; color:#555; font-size:14px; position:relative; top:8px; left:5px; float: left; height: 22px;}"+"div.DefaultStickyWin div.middle, div.DefaultStickyWin div.closeBody {background:url(%baseHref%body.png) top left repeat-y; margin:0px 20px 0px 0px !important;	margin-bottom: -3px; position: relative;	top: 0px !important; top: -3px;}"+"div.DefaultStickyWin div.body{background:url(%baseHref%body.png) top right repeat-y; padding:8px 30px 8px 0px; margin-left:5px; position:relative; right:-20px}"+"div.DefaultStickyWin div.bottom{clear:both}"+"div.DefaultStickyWin div.bottom_ll{background:url(%baseHref%full.png) bottom left no-repeat; width:15px; height:15px; float:left}"+"div.DefaultStickyWin div.bottom_lr{background:url(%baseHref%full.png) bottom right; position:relative; left:0px !important; left:-4px; margin:0px 0px 0px 15px !important; margin-right:-4px; height:15px}"+"div.DefaultStickyWin div.closeButtons{text-align: center; background:url(%baseHref%body.png) top right repeat-y; padding: 0px 30px 8px 0px; margin-left:5px; position:relative; right:-20px}"+"div.DefaultStickyWin a.button:hover{background:url(%baseHref%big_button_over.gif) repeat-x}"+"div.DefaultStickyWin a.button {background:url(%baseHref%big_button.gif) repeat-x; margin: 2px 8px 2px 8px; padding: 2px 12px; cursor:pointer; border: 1px solid #999 !important; text-decoration:none; color: #000 !important;}"+"div.DefaultStickyWin div.closeButton{width:13px; height:13px; background:url(%baseHref%closebtn.gif) no-repeat; position: absolute; right: 0px; margin:10px 15px 0px 0px !important; cursor:pointer}",cssClass:'',baseHref:'http://www.cnet.com/html/rb/assets/global/stickyWinHTML/',buttons:[]},options);if(options.confirmTxt)options.buttons.push({text:options.confirmTxt,onClick:options.onConfirm||Class.empty});if(options.closeTxt)options.buttons.push({text:options.closeTxt,onClick:options.onClose||Class.empty});window.addEvent('domready',function(){try{if(!$('defaultStickyWinStyle')){var css=simpleTemplateParser.parseTemplate(options.css,options);if(window.ie)css=css.replace(new RegExp('png','gi'),'gif');var styler=new Element('style').setProperty('id','defaultStickyWinStyle').injectInside($$('head')[0]);if(!styler.setText.attempt(css,styler))styler.appendText(css)}}catch(e){dbug.log('error: %s',e)}}.bind(this));caption=$pick(caption,'%caption%');body=$pick(body,'%body');var container=new Element('div').setStyle('width',options.width).addClass('DefaultStickyWin');if(options.cssClass)container.addClass(options.cssClass);var h1Caption=new Element('h1').addClass('caption').setStyle('width',(options.width.toInt()-60)+'px');if($(caption))h1Caption.adopt(caption);else h1Caption.setHTML(caption);var bodyDiv=new Element('div').addClass('body');if($(body))bodyDiv.adopt(body);else bodyDiv.setHTML(body);container.adopt(new Element('div').addClass('top').adopt(new Element('div').addClass('top_ul')).adopt(new Element('div').addClass('top_ur').adopt(new Element('div').addClass('closeButton').addClass('closeSticky')).adopt(h1Caption)));container.adopt(new Element('div').addClass('middle').adopt(bodyDiv));if(options.buttons.length>0){var closeButtons=new Element('div').addClass('closeButtons');options.buttons.each(function(button){if(button.properties&&button.properties.className){button.properties['class']=button.properties.className;delete button.properties.className}var properties=$merge({'class':'closeSticky'},button.properties);new Element('a').addEvent('click',button.onClick||Class.empty).appendText(button.text).injectInside(closeButtons).setProperties(properties).addClass('button')});container.adopt(new Element('div').addClass('closeBody').adopt(closeButtons))}container.adopt(new Element('div').addClass('bottom').adopt(new Element('div').addClass('bottom_ll')).adopt(new Element('div').addClass('bottom_lr')));return container};var StickyWin=new Class({options:{onDisplay:Class.empty,onClose:Class.empty,closeClassName:'closeSticky',pinClassName:'pinSticky',content:'',zIndex:10000,className:'',edge:false,position:'center',offset:{x:0,y:0},relativeTo:document.body,width:false,height:false,timeout:-1,allowMultipleByClass:false,allowMultiple:true,showNow:true,useIframeShim:true,iframeShimSelector:''},css:'.SWclearfix:after {content: "."; display: block; height: 0; clear: both; visibility: hidden;}'+'.SWclearfix {display: inline-table;}'+'* html .SWclearfix {height: 1%;}'+'.SWclearfix {display: block;}',initialize:function(options){this.setOptions(options);this.id=this.options.id||'StickyWin_'+new Date().getTime();this.makeWindow();if(this.options.content)this.setContent(this.options.content);if(this.options.showNow)this.show();window.addEvent('domready',function(){try{if(!$('StickyWinClearfix')){var style=new Element('style').setProperty('id','StickyWinClearfix').injectInside($$('head')[0]);if(!style.setText.attempt(this.css,style))style.appendText(this.css)}}catch(e){dbug.log('error: %s',e)}}.bind(this))},makeWindow:function(){this.destroyOthers();if(!$(this.id)){this.win=new Element('div').setProperty('id',this.id).addClass(this.options.className).addClass('StickyWinInstance').addClass('SWclearfix').setStyles({'display':'none','position':'absolute','zIndex':this.options.zIndex}).injectInside(document.body)}else this.win=$(this.id);if(this.options.width&&$type(this.options.width.toInt())=="number")this.win.setStyle('width',this.options.width.toInt()+'px');if(this.options.height&&$type(this.options.height.toInt())=="number")this.win.setStyle('height',this.options.height.toInt()+'px');return this},show:function(){this.fireEvent('onDisplay');if(!this.positioned)this.position();this.showWin();if(this.options.useIframeShim)this.showIframeShim();this.visible=true;return this},showWin:function(){this.win.setStyle('display','block')},hide:function(){this.fireEvent('onClose');this.hideWin();if(this.options.useIframeShim)this.hideIframeShim();this.visible=false;return this},hideWin:function(){this.win.setStyle('display','none')},destroyOthers:function(){if(!this.options.allowMultipleByClass||!this.options.allowMultiple){$$('div.StickyWinInstance').each(function(sw){if(!this.options.allowMultiple||(!this.options.allowMultipleByClass&&sw.hasClass(this.options.className)))sw.remove()},this)}},setContent:function(html){if(this.win.getChildren().length>0)this.win.empty();if($type(html)=="string")this.win.setHTML(html);else if($(html))this.win.adopt(html);this.win.getElements('.'+this.options.closeClassName).each(function(el){el.addEvent('click',this.hide.bind(this))},this);this.win.getElements('.'+this.options.pinClassName).each(function(el){el.addEvent('click',this.togglepin.bind(this))},this);return this},position:function(){this.positioned=true;this.win.setPosition({relativeTo:this.options.relativeTo,position:this.options.position,offset:this.options.offset,edge:this.options.edge});if(this.shim)this.shim.position();return this},pin:function(pin){if(!this.win.pin){dbug.log('you must include element.pin.js!');return false}this.pinned=$pick(pin,true);return this.win.pin(pin)},unpin:function(){this.pin(false)},togglepin:function(){this.pin(!this.pinned)},makeIframeShim:function(){if(!this.shim){this.shim=new IframeShim({element:(this.options.iframeShimSelector)?this.win.getElement(this.options.iframeShimSelector):$('StickyWinOverlay')||this.win,display:false,name:'StickyWinShim'})}},showIframeShim:function(){if(this.options.useIframeShim){this.makeIframeShim();this.shim.show()}},hideIframeShim:function(){if(this.options.useIframeShim)this.shim.hide()},destroy:function(){this.win.remove();if(this.options.useIframeShim)this.shim.remove();if($('StickyWinOverlay'))$('StickyWinOverlay').remove()}});StickyWin.implement(new Options);StickyWin.implement(new Events);var stickyWin=StickyWin;var StickyWinFx=StickyWin.extend({options:{fade:true,fadeDuration:150,fadeTransition:Fx.Transitions.sineInOut,draggable:false,dragOptions:{},dragHandleSelector:'h1.caption',resizable:false,resizeOptions:{},resizeHandleSelector:''},setContent:function(html){this.parent(html);if(this.options.draggable)this.makeDraggable();if(this.options.resizable)this.makeResizable();return this},hideWin:function(){if(this.options.fade)this.fade(0);else this.win.hide()},showWin:function(){if(this.options.fade)this.fade(1);else this.win.show()},fade:function(to){if(!this.fadeFx){this.win.setStyles({opacity:0,display:'block'});this.fadeFx=this.win.effect('opacity',{duration:this.options.fadeDuration,transition:this.options.fadeTransition})}if(to>0)this.win.setStyle('display','block');this.fadeFx.clearChain();this.fadeFx.start(to).chain(function(){if(to==0)this.win.setStyle('display','none')}.bind(this));return this},makeDraggable:function(){dbug.log('you must include Drag.js, cannot make draggable')},makeResizable:function(){dbug.log('you must include Drag.js, cannot make resizable')}});if(typeof Drag!="undefined"){StickyWinFx.implement({makeDraggable:function(){var toggled=this.toggleVisible(true);if(this.options.useIframeShim){this.makeIframeShim();var dragComplete=this.options.dragOptions.onComplete||Class.empty;this.options.dragOptions.onComplete=function(){dragComplete();this.shim.position()}.bind(this)}if(this.options.dragHandleSelector){var handle=this.win.getElement(this.options.dragHandleSelector);if(handle){handle.setStyle('cursor','move');this.options.dragOptions.handle=handle}}this.win.makeDraggable(this.options.dragOptions);if(toggled)this.toggleVisible(false)},makeResizable:function(){var toggled=this.toggleVisible(true);if(this.options.useIframeShim){this.makeIframeShim();var resizeComplete=this.options.resizeOptions.onComplete||Class.empty;this.options.resizeOptions.onComplete=function(){resizeComplete();this.shim.position()}.bind(this)}if(this.options.resizeHandleSelector){var handle=this.win.getElement(this.options.resizeHandleSelector);if(handle)this.options.resizeOptions.handle=this.win.getElement(this.options.resizeHandleSelector)}this.win.makeResizable(this.options.resizeOptions);if(toggled)this.toggleVisible(false)},toggleVisible:function(show){if(!this.visible&&window.khtml&&$pick(show,true)){this.win.setStyles({display:'block',opacity:0});return true}else if(!$pick(show,false)){this.win.setStyles({display:'none',opacity:1});return false}return false}})}var modalWinBase={initialize:function(options){options=options||{};this.setModalOptions($merge(options.modalOptions||{},{onModalHide:function(){this.hide(false)}.bind(this)}));this.parent(options)},show:function(showModal){if($pick(showModal,true))this.modalShow();this.parent()},hide:function(hideModal){if($pick(hideModal,true))this.modalHide();this.parent()}};var StickyWinModal=StickyWin.extend(modalWinBase);StickyWinModal.implement(new Modalizer);var StickyWinFxModal=(typeof StickyWinFx!="undefined")?StickyWinFx.extend(modalWinBase):Class.empty;try{StickyWinFxModal.implement(new Modalizer())}catch(e){}var SWA={options:{url:'',showNow:false,XHRoptions:{method:'get'},wrapWithStickyWinDefaultHTML:false,caption:'',stickyWinHTMLOptions:{},handleResponse:function(response){if(this.options.wrapWithStickyWinDefaultHTML)response=stickyWinHTML(this.options.caption,response,this.options.stickyWinHTMLOptions);this.setContent(response);this.show()}},initialize:function(options){this.parent(options);this.createXHR()},createXHR:function(){var opt=$merge(this.options.XHRoptions,{onSuccess:this.options.handleResponse.bind(this)});this.XHR=new XHR(opt)},update:function(url){this.XHR.send(url||this.options.url);return this}};try{StickyWin.Ajax=StickyWin.extend(SWA)}catch(e){}try{StickyWinFx.Ajax=StickyWinFx.extend(SWA)}catch(e){}try{StickyWinModal.Ajax=StickyWinModal.extend(SWA)}catch(e){}try{StickyWinFxModal.Ajax=StickyWinFxModal.extend(SWA)}catch(e){}var simpleErrorPopup=function(msghdr,msg,baseHref){baseHref=baseHref||"http://www.cnet.com/html/rb/assets/global/simple.error.popup";msg='<p class="errorMsg SWclearfix">'+'<img src="'+baseHref+'/simple.error.popup/icon_problems_sm.gif"'+' class="bang clearfix" style="float: left; width: 30px; height: 30px; margin: 3px 5px 5px 0px;">'+msg+'</p>';var body=stickyWinHTML(msghdr,msg,{width:'250px'});return new StickyWinModal({modalOptions:{modalStyle:{zIndex:11000}},zIndex:110001,content:body,position:'center'})};var DatePicker=new Class({options:{baseHref:'http://www.cnet.com/html/rb/assets/global/',defaultCss:'div.calendarHolder{width:210px; height:182px; padding-left:8px; padding-top:1px; '+'background:url(%baseHref%/datePicker/calendar.back.png) no-repeat} '+'* html div.calendarHolder {background:url(%baseHref%/datePicker/calendar.back.gif) no-repeat}'+'table.datePicker * {font-size:11px; line-height:16px;} '+'table.datePicker{margin:6px 0px 0px 0px; width:190px; padding:0px 5px 0px 5px} '+'table.datePicker td{cursor:pointer; text-align:center} '+'table.datePicker img.closebtn{margin-top:2px} '+'tr.dateNav{height:22px; margin-top:8px} '+'tr.dayNames td{color:#666; font-weight:bold; border-bottom:1px solid #ddd} '+'table.datePicker tr.dayRow td:hover{background:#ccc} '+'td.today{color:#bb0904} '+'td.otherMonthDate{border:1px solid #fff; color:#666; background:#f3f3f3} '+'td.selectedDate{border:1px solid #20397b; background:#dcddef}',fullDay:86400000,calendarId:false,stickyWinOptions:{position:"bottomLeft",offset:{x:10,y:10},fadeDuration:400},draggable:true,dragOptions:{},showOnInputFocus:true,useDefaultCss:true,hideCalendarOnPick:true,onPick:Class.empty,onShow:Class.empty,onHide:Class.empty},initialize:function(input,options){this.options.months=["January","February","March","April","May","June","July","August","September","October","November","December"];this.options.days=["Su","Mo","Tu","We","Th","Fr","Sa"];this.options.additionalShowLinks=[];var StickyWinToUse=(typeof StickyWinFx=="undefined")?StickyWin:StickyWinFx;this.setOptions({stickyWinToUse:StickyWinToUse},options);if(!this.options.calendarId)this.options.calendarId="popupCalendar"+new Date().getTime();this.input=$(input);if(this.options.useDefaultCss)this.writeCss();this.setUpObservers();this.getCalendar()},setUpObservers:function(){if(this.options.showOnInputFocus)this.input.addEvent('focus',this.show.bind(this));try{this.input.addEvent('blur',this.updateInput.bind(this))}catch(e){}this.options.additionalShowLinks.each(function(lnk){$(lnk).addEvent('click',this.show.bind(this))},this)},writeCss:function(css){css=$pick(css,this.options.defaultCss).replace("%baseHref%",this.options.baseHref,"g");window.addEvent('domready',function(){try{if(!$('datePickerStyle')){var style=new Element('style').setProperty('id','datePickerStyle').injectInside($$('head')[0]);if(!style.setText.attempt(css,style))style.appendText(css)}}catch(e){dbug.log('error: %s',e)}})},updateInput:function(date){if(!$type(date)=="string"||(date&&!date.getTime))date=this.input.getValue();var dateStr=this.formatDate(this.validDate(date));if($type(dateStr)=="string"){this.input.value=dateStr;return dateStr}return date},validDate:function(val){val=$pick(val,this.input.getValue());val=val.replace(/^\s+|\s+$/g,"");var asDate=Date.parse(val);if(isNaN(asDate))asDate=Date.parse(val.replace(/[^\w\s]/g,"/"));if(isNaN(asDate))asDate=Date.parse(val.replace(/[^\w\s]/g,"/")+"/"+new Date().getFullYear());if(!isNaN(asDate)){var newDate=new Date(asDate);if(newDate.getFullYear()<2000&&val.indexOf(newDate.getFullYear())<0){newDate.setFullYear(newDate.getFullYear()+100)}return newDate}else return asDate},formatDate:function(date){try{var fd=((date.getUTCMonth()<9)?"0":"")+(date.getUTCMonth()+1)+"/";fd+=((date.getUTCDate()<10)?"0":"")+date.getUTCDate()+"/";fd+=date.getUTCFullYear();return fd}catch(e){return date}},zeroHourGMT:function(date){date.setTime(date.getTime()-date.getTime()%86400000);return date},getCalendar:function(){if(!this.calendar){var cal=new Element("table").setProperties({'id':this.options.calendarId,'border':'0','cellpadding':'0','cellspacing':'0'});cal.addClass('datePicker');$(cal.insertRow(0).insertCell(0)).appendText("x");for(var c=0;c<6;c++)$(cal.rows[0]).adopt(cal.rows[0].cells[0].cloneNode(true));for(var r=0;r<7;r++)$(cal.rows[0].parentNode).adopt(cal.rows[0].cloneNode(true));$(cal.rows[1]).addClass('dayNames');for(var r=2;r<8;r++)$(cal.rows[r]).addClass('dayRow');for(var d=0;d<7;d++)cal.rows[1].cells[d].firstChild.data=this.options.days[d];for(var t=6;t>3;t--)cal.rows[0].deleteCell(t);$(cal.rows[0]).addClass('dateNav');if(!window.ie6)cal.rows[0].cells[0].firstChild.data=String.fromCharCode(9668);else cal.rows[0].cells[0].firstChild.data="<";cal.rows[0].cells[1].colSpan=4;if(!window.ie6)cal.rows[0].cells[2].firstChild.data=String.fromCharCode(9658);else cal.rows[0].cells[2].firstChild.data=">";cal.rows[0].cells[3].firstChild.data=String.fromCharCode(215);$(cal.rows[0].cells[3].empty()).adopt(this.getCloseImg());cal.addEvent('click',this.clickCalendar.bind(this));this.calendar=cal;this.container=new Element('div').adopt(cal).addClass('calendarHolder');this.options.stickyWinOptions.content=this.container;this.options.stickyWinOptions.showNow=false;this.options.stickyWinOptions.relativeTo=this.input;this.stickyWin=new this.options.stickyWinToUse(this.options.stickyWinOptions);if(this.options.draggable){try{this.stickyWin.win.makeDraggable(Object.extend(this.options.dragOptions,{handle:cal.rows[0].cells[1],onDrag:function(){if(this.stickyWin.shim)this.stickyWin.shim.show.bind(this.stickyWin)}.bind(this)}));cal.rows[0].cells[1].setStyle('cursor','move')}catch(e){}}}return this.calendar},getCloseImg:function(url){url=url||this.options.baseHref+"/simple.error.popup/closebtn.gif";var closer=new Element("img").setProperty('src',url);closer.addEvents({'mouseover':function(){closer.src=closer.src.replace('.gif','_over.gif')},'mouseout':function(){closer.src=closer.src.replace('_over.gif','.gif')},'click':this.hide.bind(this)}).setStyles({width:'13px',height:'13px'}).addClass('closebtn');return closer},hide:function(){this.stickyWin.hide();this.fireEvent('onHide')},show:function(){this.today=this.zeroHourGMT(new Date());this.inputDate=new Date(this.updateInput());this.refDate=isNaN(this.inputDate)?this.today:this.zeroHourGMT(new Date(this.inputDate));this.getCalendar();this.fillCalendar(this.refDate);this.stickyWin.show();this.fireEvent('onShow')},clickCalendar:function(e){e=new Event(e);if(!e.target.firstChild||!e.target.firstChild.data)return;var val=e.target.firstChild.data;if(val.charCodeAt(0)>9600||val=="<"||val==">"){var newRef=this.calendar.rows[2].cells[0].refDate-this.options.fullDay;if(val.charCodeAt(0)!=9668&&val!="<")newRef=this.calendar.rows[7].cells[6].refDate+this.options.fullDay;this.fillCalendar(new Date(newRef));return}if(e.target.refDate){var newDate=new Date(e.target.refDate);this.input.value=this.formatDate(newDate);this.input.fireEvent("change");this.input.fireEvent("blur");this.fireEvent('onPick');if(this.options.hideCalendarOnPick)this.hide()}},fillCalendar:function(forDate){var startDate=new Date(forDate.getTime());startDate.setUTCDate(1);startDate.setTime(startDate.getTime()-(this.options.fullDay*startDate.getUTCDay()));this.calendar.rows[0].cells[1].firstChild.data=this.options.months[forDate.getUTCMonth()]+" "+forDate.getUTCFullYear();var atDate=startDate;this.calendar.getElements('td').each(function(el){el.removeClass('selectedDate').removeClass('otherMonthDate').removeClass('today')});for(var w=2;w<8;w++)for(var d=0;d<7;d++){var td=this.calendar.rows[w].cells[d];td.firstChild.data=atDate.getUTCDate();td.refDate=atDate.getTime();if(atDate.getTime()==this.today.getTime())td.addClass('today');if(atDate.getTime()==this.refDate.getTime())td.addClass('selectedDate');if(atDate.getUTCMonth()!=forDate.getUTCMonth())td.addClass('otherMonthDate');atDate.setTime(atDate.getTime()+this.options.fullDay)}}});DatePicker.implement(new Options);DatePicker.implement(new Events);var TagMaker=new Class({options:{name:"Tag Builder",output:'',picklets:{},help:{},example:{},'class':{},selectLists:{},width:400,maxHeight:500,showResult:true,clearOnPrompt:true,baseHref:"http://www.cnet.com/html/rb/assets/global/tips/",css:"table.trinket {	width: 98%;	margin: 0px auto;	font-size: 10px; }					table.trinket td {	vertical-align: top;	padding: 4px;}					table.trinket td a.button {	position: relative;	top: -2px;}					table.trinket td.example {	font-size: 9px;	color: #666;	text-align: right;	border-bottom: 1px solid #ddd;						padding-bottom: 6px;}					table.trinket div.validation-advice {	background-color: #a36565;	font-weight: bold;	color: #fff;	padding: 4px;						margin-top: 3px;}					table.trinket input.text {width: 100%;}					.tagMakerTipElement { 	cursor: help; }					.tagMaker-tip {	color: #fff;	width: 172px;	z-index: 13000; }					.tagMaker-title {	font-weight: bold;	font-size: 11px;	margin: 0;	padding: 8px 8px 4px;							background: url(%baseHref%/bubble.png) top left;}					.tagMaker-text { font-size: 11px; 	padding: 4px 8px 8px; 							background: url(%baseHref%/bubble.png) bottom right; }",onPrompt:Class.empty,onChoose:Class.empty},initialize:function(options){this.setOptions(options);this.buttons=[{text:'Copy',onClick:this.copyToClipboard.bind(this),properties:{'class':'closeSticky tip',title:'Copy::Copy the html to your OS clipboard (like hitting Ctrl+C)'}},{text:'Paste',onClick:function(){if(this.validator.validate())this.insert()}.bind(this),properties:{'class':'tip',title:'Paste::Insert the html into the field you are editing'}},{text:'Close',properties:{'class':'closeSticky tip',title:'Close::Close this popup'}}];this.writeCss()},writeCss:function(){window.addEvent('domready',function(){try{if(!$('defaultTagBuilderStyle')){var css=this.options.css.replace("%baseHref%",this.options.baseHref,"g");var styler=new Element('style').setProperty('id','defaultTagBuilderStyle').injectInside($$('head')[0]);if(!styler.setText.attempt(css,styler))styler.appendText(css)}}catch(e){dbug.log('error: %s',e)}}.bind(this))},prompt:function(target){this.target=$(target);var content=this.getContent();if(this.options.clearOnPrompt)this.clear();if(content){var relativeTo=(document.compatMode=="BackCompat"&&this.target)?this.target:document.body;if(!this.win)this.win=new StickyWinFx({content:content,draggable:true,relativeTo:relativeTo,onClose:function(){$$('.tagMaker-tip').hide()}});if(!this.win.visible)this.win.show()}var innerText=this.getInnerTextInput();this.range=target.getSelectedRange();if(innerText)innerText.value=target.getTextInRange(this.range.start,this.range.end)||"";this.fireEvent('onPrompt')},clear:function(){this.body.getElements('input').each(function(input){input.value=''})},getKeys:function(text){return text.split('%').filter(function(inputKey,index){return index%2})},getInnerTextInput:function(){return this.body.getElement('input[name=Inner-Text]')},getContent:function(){var opt=this.options;if(!this.form){this.form=new Element('form');var table=new HtmlTable({properties:{'class':'trinket'}});this.getKeys(opt.output).each(function(inputKey){if(this.options.selectLists[inputKey]){var input=new Element('select').setProperties({name:inputKey.replaceAll(' ','-')}).addEvent('change',this.createOutput.bind(this));this.options.selectLists[inputKey].each(function(opt){var option=new Element('option').injectInside(input);if(opt.selected)option.selected=true;option.value=opt.value;option.text=opt.key},this);table.push([inputKey,input])}else{var input=new Element('input').setProperties({type:'text',name:inputKey.replaceAll(' ','-'),title:inputKey+'::'+opt.help[inputKey],'class':'text tip '+((opt['class'])?opt['class'][inputKey]||'':'')}).addEvent('keyup',this.createOutput.bind(this)).addEvent('focus',function(){this.select()});if(opt.picklets[inputKey]){var a=new Element('a').addClass('button').setHTML('choose');var div=new Element('div').adopt(input.setStyle('width','160px')).adopt(a);var picklets=($type(opt.picklets[inputKey])=="array")?opt.picklets[inputKey]:[opt.picklets[inputKey]];new ProductPicker(input,picklets,{showOnFocus:false,additionalShowLinks:[a],onPick:function(input,data,picker){try{var ltInput=this.getInnerTextInput();if(ltInput&&!ltInput.value){try{ltInput.value=picker.currentPicklet.options.listItemName(data)}catch(e){dbug.log('set value error: ',e)}}var val=input.value;if(inputKey=="Full Path"&&val.indexOf('http://')==0)input.value=val.substring(val.indexOf('/',7),val.length);this.createOutput()}catch(e){dbug.log(e)}}.bind(this)});table.push([inputKey,div])}else table.push([inputKey,input])}if(this.options.example[inputKey])table.push([{content:'eg. '+this.options.example[inputKey],properties:{colspan:2,'class':'example'}}])},this);this.resultInput=new Element('input').setProperties({type:'text',title:'HTML::This is the resulting tag html.','class':'text result tip'}).addEvent('focus',function(){this.select()});table.push(['HTML',this.resultInput]).tr.setStyle('display',this.options.showResult?'':'none');this.form=table.table;this.body=new Element('div').adopt(this.form).setStyles({overflow:'auto',maxHeight:this.options.maxHeight});this.validator=new FormValidator(this.form);this.validator.insertAdvice=function(advice,field){var p=$(field.parentNode);if(p)p.adopt(advice)}}if(!this.content){this.content=stickyWinHTML(this.options.name,this.body,{buttons:this.buttons,width:this.options.width.toInt()+'px'});new Tips(this.content.getElements('.tip'),{showDelay:700,maxTitleChars:50,maxOpacity:.9,className:'tagMaker'})}return this.content},createOutput:function(){var inputs=this.form.getElementsBySelector('input, select');var html=this.options.output;inputs.each(function(input){if(!input.hasClass('result')){html=html.replaceAll('%'+input.getProperty('name').replaceAll('-',' ').toLowerCase()+'%',input.getValue(),'i')}});return this.resultInput.value=html},copyToClipboard:function(){var inputs=this.form.getElements('input');var result=inputs[inputs.length-1];result.select();Clipboard.copy(result);$$('.tagMaker-tip').hide();this.win.hide();this.fireEvent('onChoose')},insert:function(){if(!this.target){simpleErrorPopup('Cannot Paste','This tag builder was not launched with a target input specified; you\'ll have to copy the tag yourself. Sorry!');return}var value=(this.target)?this.target.value:this.target;var output=this.body.getElement("input.result");var currentScrollPos;if(this.target.scrollTop||this.target.scrollLeft){currentScrollPos={scrollTop:this.target.scrollTop,scrollLeft:this.target.scrollLeft}}this.target.value=value.substring(0,this.range.start)+output.value+value.substring((this.range.end-this.range.start)+this.range.start,value.length);if(currentScrollPos){this.target.scrollTop=currentScrollPos.scrollTop;this.target.scrollLeft=currentScrollPos.scrollLeft}this.target.selectRange(this.range.start,output.value.length+this.range.start);this.fireEvent('onChoose');$$('.tagMaker-tip').hide();this.win.hide();return}});TagMaker.implement(new Options,new Events);TagMaker.image=TagMaker.extend({options:{name:"Image Builder",output:'<img src="%Full Url%" width="%Width%" height="%Height%" alt="%Alt Text%" style="%Alignment%"/>',help:{'Full Url':'Enter the external URL (http://...) to the image','Width':'Enter the width in pixels.','Height':'Enter the height in pixels.','Alt Text':'Enter the alternate text for the image.','Alignment':'Choose how to float the image.'},example:{'Full Url':'http://i.i.com.com/cnwk.1d/i/hdft/redball.gif'},'class':{'Full Url':'validate-url required','Width':'validate-digits required','Height':'validate-digits required','Alt Text':'required'},selectLists:{Alignment:[{key:'left',value:'float: left'},{key:'right',value:'float: right'},{key:'none',value:'float: none',selected:true},{key:'center',value:'margin-left: auto; margin-right: auto;'}]},showResult:false}});var TMPicklets=[];if(typeof CNETProductPicker_ReviewPath!="undefined")TMPicklets.push(CNETProductPicker_ReviewPath);if(typeof CNETProductPicker_PricePath!="undefined")TMPicklets.push(CNETProductPicker_PricePath);if(typeof NewsStoryPicker_Path!="undefined")TMPicklets.push(NewsStoryPicker_Path);TagMaker.anchor=TagMaker.extend({options:{name:"Anchor Builder",output:'<a href="%Full Url%">%Inner Text%</a>',picklets:{'Full Url':(TMPicklets.length)?TMPicklets:false},help:{'Full Url':'Enter the external URL (http://...)','Inner Text':'Enter the text for the link body'},example:{'Full Url':'http://www.microsoft.com','Inner Text':'Microsoft'},'class':{'Full Url':'validate-url'}}});TagMaker.cnetVideo=TagMaker.extend({options:{name:"CNET Video Embed Tag",output:'<cnet:video ssaVideoId="%Video Id%" float="%Alignment%"/>',help:{'Video Id':'The id of the video to embed'},'class':{'Video Id':'validate-digits required'},selectLists:{Alignment:[{key:'left',value:'left'},{key:'right',value:'right'},{key:'none',value:'',selected:true}]}}});var PopupDetail=new Class({visible:false,observed:false,hasData:false,options:{observer:false,observerAction:'mouseenter',closeOnMouseOut:true,linkPopup:false,data:{},templateOptions:{},useAjax:false,ajaxOptions:{method:'get'},ajaxLink:false,ajaxCache:{},delayOn:100,delayOff:100,stickyWinOptions:{},stickyWinToUse:StickyWinFx,showNow:false,htmlResponse:false},initialize:function(html,options){this.setOptions(options);this.html=($(html))?$(html).innerHTML:html||'';if(this.options.showNow)this.show.delay(this.options.delayOn,this);this.setUpObservers()},setUpObservers:function(){var opt=this.options;if($(opt.observer)&&opt.observerAction){$(opt.observer).addEvent(opt.observerAction,function(){this.observed=true;this.show.delay(opt.delayOn,this)}.bind(this));if((opt.observerAction=="mouseenter"||opt.observerAction=="mouseover")&&this.options.closeOnMouseOut){$(opt.observer).addEvent("mouseleave",function(){this.observed=false;this.hide.delay(opt.delayOff,this)}.bind(this))}}return this},makePopup:function(){if(!this.stickyWin){var opt=this.options;if(opt.htmlResponse)this.content=this.data;else this.content=this.parseTemplate(this.html,opt.data);this.stickyWin=new opt.stickyWinToUse($merge(opt.stickyWinOptions,{relativeTo:opt.observer||document.body,showNow:false,content:this.content,allowMultipleByClass:true}));if($(opt.linkPopup)||$type(opt.linkPopup)=='string'){this.stickyWin.win.setStyle('cursor','pointer').addEvent('click',function(){window.location.href=($type(url)=='string')?url:url.src})}this.stickyWin.win.addEvent('mouseenter',function(){this.observed=true}.bind(this));this.stickyWin.win.addEvent('mouseleave',function(){this.observed=false;if(opt.closeOnMouseOut)this.hide.delay(opt.delayOff,this)}.bind(this))}return this},getContent:function(){try{new Ajax((this.options.ajaxLink||this.options.observer.href),$merge(this.options.ajaxOptions,{onComplete:this.show.bind(this)})).request()}catch(e){dbug.log('ajax error on PopupDetail: %s',e)}},show:function(data){var opt=this.options;if(data)this.data=data;if(this.observed&&!this.visible){if(opt.useAjax&&!this.data){var cachedVal=opt.ajaxCache[this.options.ajaxLink]||opt.ajaxCache[this.options.observer.href];if(cachedVal)return this.show(cachedVal);this.cursorStyle=$(opt.observer).getStyle('cursor');$(opt.observer).setStyle('cursor','wait');this.getContent();return false}else{if(this.cursorStyle)$(opt.observer).setStyle('cursor',this.cursorStyle);if(opt.useAjax&&!opt.htmlResponse)opt.data=Json.evaluate(this.data);this.makePopup();this.stickyWin.show();this.visible=true;return this}}return this},hide:function(){if(!this.observed){if(this.stickyWin)this.stickyWin.hide();this.visible=false}return this}});PopupDetail.implement(simpleTemplateParser);PopupDetail.implement(new Options);var popupDetail=PopupDetail;var PopupDetailCollection=new Class({options:{details:[],observers:[],links:[],ajaxLinks:[],useCache:true,template:'',popupDetailOptions:{}},initialize:function(options){this.popupDetailObjs=[];this.cache={};this.setOptions(options);var ln=this.options.ajaxLinks.length;if(ln<=0)ln=this.options.details.length;if(this.options.observers.length!=ln)dbug.log("warning: observers and details are out of sync.");this.makePopupDetails()},makePopupDetails:function(){this.popupDetailObjs=this.options.observers.map(function(observer,index){var opt=this.options.popupDetailOptions;var pd=new PopupDetail(this.options.template,$merge(opt,{data:$pick(this.options.details[index],{}),observer:this.options.observers[index],linkItem:$pick(this.options.links[index],$pick(opt.linkItem,false)),ajaxLink:$pick(this.options.ajaxLinks[index],false),ajaxCache:(this.options.useCache)?this.cache:{}}));return pd},this)}});PopupDetailCollection.implement(new Options);var popupDetails=new Class({initialize:function(options){var pdcOptions=Object.extend(options,{popupDetailOptions:{stickyWinOptions:{position:$pick(options.observeCorner,'upperLeft'),offset:{x:options.offsetx||0,y:options.offsety||0},useIframeShim:(options.iframeShimSelector)?true:false}},delayOn:$pick(options.effectDelayOn,0),delayOff:$pick(options.effectDelayOff,0)});var pdc=new popupDetailCollection(pdcOptions);return pdc}});var popDetailsList=popupDetails;var CNETcarousel=new Class({initialize:function(container,options){this.container=$(container);if(!this.container.hasClass('hasCarousel')){this.container.addClass('hasCarousel');this.slides=[];this.buttons=[];this.setOptions({onRotate:Class.empty,onStop:Class.empty,onAutoPlay:Class.empty,onShowSlide:Class.empty,slidesSelector:".slide",buttonsSelector:".button",slideInterval:4000,transitionDuration:700,startIndex:0,buttonOnClass:"selected",buttonOffClass:"off",rotateAction:"none",rotateActionDuration:100,autoplay:true},options);this.slides=$(container).getElements(this.options.slidesSelector);this.buttons=$(container).getElements(this.options.buttonsSelector);this.createFx();this.showSlide(this.options.startIndex);if(this.options.autoplay)this.autoplay();if(this.options.rotateAction!='none')this.setupAction(this.options.rotateAction);return this}else return false},setupAction:function(action){this.buttons.each(function(el,idx){$(el).addEvent(action,function(){this.slideFx.setOptions(this.slideFx.options,{duration:this.options.rotateActionDuration});if(this.currentSlide!=idx)this.showSlide(idx);this.stop()}.bind(this))},this)},createFx:function(){this.slideFx=new Fx.Elements(this.slides,{duration:this.options.transitionDuration});this.slides.each(function(slide){slide.setStyle('opacity',0)})},showSlide:function(slideIndex){var action={};this.slides.each(function(slide,index){if(index==slideIndex&&index!=this.currentSlide){$(this.buttons[index]).removeClass(this.options.buttonOffClass).addClass(this.options.buttonOnClass);action[index.toString()]={'opacity':[1]}}else{$(this.buttons[index]).removeClass(this.options.buttonOnClass).addClass(this.options.buttonOffClass);action[index.toString()]={'opacity':[0]}}},this);this.fireEvent('onShowSlide',slideIndex);this.currentSlide=slideIndex;this.slideFx.start(action)},autoplay:function(){this.createFx();this.slideshowInt=this.rotate.periodical(this.options.slideInterval,this);this.fireEvent('onAutoPlay')},stop:function(){clearInterval(this.slideshowInt);this.fireEvent('onStop')},rotate:function(){current=this.currentSlide;next=(current+1>=this.slides.length)?0:current+1;this.showSlide(next);this.fireEvent('onRotate')},show:function(){$(this.options.carouselContainer).setStyle('visibility','visible');if(!$(this.options.carouselContainer).isVisible())$(this.options.carouselContainer).setStyle('display','block')},hide:function(){$(this.options.carouselContainer).setStyle('visibility','hidden')}});CNETcarousel.implement(new Options);CNETcarousel.implement(new Events);var CNETcarouselWithButtons=CNETcarousel.extend({initialize:function(el,options){this.parent(el,$merge({bubbleButtonBGImgSelector:'.bbg',buttonOnGifSrc:'http://i.i.com.com/cnwk.1d/i/fd/c/green_button.gif',buttonOffGifSrc:'http://i.i.com.com/cnwk.1d/i/fd/c/gray_button.gif'},options))},showSlide:function(slideIndex){this.buttons.each(function(button,index){$(button).getElement(this.options.bubbleButtonBGImgSelector).src=(index==slideIndex)?this.options.buttonOnGifSrc:this.options.buttonOffGifSrc},this);this.parent(slideIndex)}});var carousel=null;window.addEvent('domready',function(){if($('Carousel')){carousel=new CNETcarouselWithButtons($('Carousel'),{buttonsSelector:'.bubble',rotateAction:'mouseover'})}});var MultipleOpenAccordion=Fx.Elements.extend({options:{openAll:true,allowMultipleOpen:true,firstElementsOpen:[0],start:'open-first',fixedHeight:false,fixedWidth:false,alwaysHide:true,wait:false,onActive:Class.empty,onBackground:Class.empty,height:true,opacity:true,width:false},initialize:function(togglers,elements,options){this.parent(elements,options);this.setOptions(options);this.previousClick=null;this.elementsVisible=[];togglers.each(function(tog,i){$(tog).addEvent('click',function(){this.toggleSection(i)}.bind(this))},this);this.togglers=togglers;this.h={};this.w={};this.o={};this.now=[];this.elements.each(function(el,i){el=$(el);this.now[i]={};el.setStyle('overflow','hidden');if(!(this.options.openAll&&this.options.allowMultipleOpen))el.setStyle('height',0)},this);if(!this.options.openAll||!this.options.allowMultipleOpen){switch(this.options.start){case'first-open':this.showSection(this.options.firstElementsOpen[0]);break;case'open-first':this.toggleSection(this.options.firstElementsOpen[0]);break}}if(this.options.openAll&&this.options.allowMultipleOpen)this.showAll();else if(this.options.allowMultipleOpen)this.openSections(this.options.firstElementsOpen)},hideThis:function(i){this.elementsVisible[i]=false;if(this.options.height)this.h={'height':[this.elements[i].offsetHeight,0]};if(this.options.width)this.w={'width':[this.elements[i].offsetWidth,0]};if(this.options.opacity)this.o={'opacity':[this.now[i]['opacity']||1,0]};this.fireEvent("onBackground",[this.togglers[i],this.elements[i]])},showThis:function(i){this.elementsVisible[i]=true;if(this.options.height)this.h={'height':[this.elements[i].offsetHeight,this.options.fixedHeight||this.elements[i].scrollHeight]};if(this.options.width)this.w={'width':[this.elements[i].offsetWidth,this.options.fixedWidth||this.elements[i].scrollWidth]};if(this.options.opacity)this.o={'opacity':[this.now[i]['opacity']||0,1]};this.fireEvent("onActive",[this.togglers[i],this.elements[i]])},toggleSection:function(iToToggle){if(iToToggle!=this.previousClick||this.options.alwaysHide||this.options.allowMultipleOpen){this.previousClick=iToToggle;var objObjs={};var err=false;this.elements.each(function(el,i){var update=false;this.now[i]=this.now[i]||{};if(i==iToToggle){if(this.elementsVisible[i]&&(this.options.allowMultipleOpen||this.options.alwaysHide)){if(!(this.options.wait&&this.timer)){update=true;this.hideThis(i)}else{this.previousClick=null;err=true}}else if(!this.elementsVisible[i]){if(!(this.options.wait&&this.timer)){update=true;this.showThis(i)}else{this.previousClick=null;err=true}}}else if(this.elementsVisible[i]&&!this.options.allowMultipleOpen){if(!(this.options.wait&&this.timer)){update=true;this.hideThis(i)}else{this.previousClick=null;err=true}}if(update)objObjs[i]=$merge(this.h,$merge(this.o,this.w))},this);if(err)return false;return this.custom(objObjs)}return false},showSection:function(i,useFx){if($pick(useFx,false)){if(!this.elementsVisible[i])this.toggleSection(i)}else{this.setSectionStyle(i,$(this.elements[i]).scrollWidth,$(this.elements[i]).scrollHeight,1);this.elementsVisible[i]=true;this.fireEvent("onActive",[this.togglers[i],this.elements[i]])}},hideSection:function(i,useFx){if($pick(useFx,false)){if(this.elementsVisible[i])this.toggleSection(i)}else{this.setSectionStyle(i,0,0,0);this.elementsVisible[i]=false;this.fireEvent("onBackground",[this.togglers[i],this.elements[i]])}},setSectionStyle:function(i,w,h,o){if(this.options.opacity)$(this.elements[i]).setOpacity(o);if(this.options.height)$(this.elements[i]).setStyle('height',h+'px');if(this.options.width)$(this.elements[i]).setStyle('width',w+'px')},showAll:function(){if(this.options.allowMultipleOpen){this.elements.each(function(el,idx){this.showSection(idx,false)},this)}},hideAll:function(){if(this.options.allowMultipleOpen){this.elements.each(function(el,idx){this.hideSection(idx,false)},this)}},openSections:function(sections){if(this.options.allowMultipleOpen){this.elements.each(function(el,idx){if(sections.test(idx))this.showSection(idx,false);else this.hideSection(idx,false)},this)}}});MultipleOpenAccordion.implement(new Options);MultipleOpenAccordion.implement(new Events);var MooScroller=new Class({options:{maxThumbSize:10,mode:'vertical',width:0,scrollSteps:10,wheel:true,scrollLinks:{forward:'scrollForward',back:'scrollBack'},onScroll:Class.empty,onPage:Class.empty},initialize:function(content,knob,options){this.setOptions(options);this.horz=(this.options.mode=="horizontal");this.content=$(content).setStyle('overflow','hidden');this.knob=$(knob);this.track=this.knob.getParent();this.setPositions();if(this.horz&&this.options.width){this.wrapper=new Element('div');this.content.getChildren().each(function(child){this.wrapper.adopt(child)});this.wrapper.injectInside(this.content).setStyle('width',this.options.width)}this.bound={'start':this.start.bind(this),'end':this.end.bind(this),'drag':this.drag.bind(this),'wheel':this.wheel.bind(this),'page':this.page.bind(this)};this.position={};this.mouse={};this.update();this.attach();var clearScroll=function(){$clear(this.scrolling)}.bind(this);['forward','back'].each(function(direction){var lnk=$(this.options.scrollLinks[direction]);if(lnk){lnk.addEvents({mousedown:function(){this.scrolling=this[direction].periodical(50,this)}.bind(this),mouseup:clearScroll.bind(this),click:clearScroll.bind(this)})}},this);this.knob.addEvent('click',clearScroll.bind(this));window.addEvent('domready',function(){try{$(document.body).addEvent('mouseup',clearScroll.bind(this))}catch(e){}}.bind(this))},setPositions:function(){[this.track,this.knob].each(function(el){if(el.getStyle('position')=='static')el.setStyle('position','relative')})},update:function(){var plain=this.horz?'Width':'Height';this.contentSize=this.content['offset'+plain];this.contentScrollSize=this.content['scroll'+plain];this.trackSize=this.track['offset'+plain];this.contentRatio=this.contentSize/this.contentScrollSize;this.knobSize=(this.trackSize*this.contentRatio).limit(this.options.maxThumbSize,this.trackSize);this.scrollRatio=this.contentScrollSize/this.trackSize;this.knob.setStyle(plain.toLowerCase(),this.knobSize+'px');this.updateThumbFromContentScroll();this.updateContentFromThumbPosition()},updateContentFromThumbPosition:function(){this.content[this.horz?'scrollLeft':'scrollTop']=this.position.now*this.scrollRatio},updateThumbFromContentScroll:function(){this.position.now=(this.content[this.horz?'scrollLeft':'scrollTop']/this.scrollRatio).limit(0,(this.trackSize-this.knobSize));this.knob.setStyle(this.horz?'left':'top',this.position.now+'px')},attach:function(){this.knob.addEvent('mousedown',this.bound.start);if(this.options.scrollSteps)this.content.addEvent('mousewheel',this.bound.wheel);this.track.addEvent('mouseup',this.bound.page)},wheel:function(event){event=new Event(event);this.scroll(-(event.wheel*this.options.scrollSteps));this.updateThumbFromContentScroll();event.stop()},scroll:function(steps){steps=steps||this.options.scrollSteps;this.content[this.horz?'scrollLeft':'scrollTop']+=steps;this.updateThumbFromContentScroll()},forward:function(steps){this.scroll(steps)},back:function(steps){steps=steps||this.options.scrollSteps;this.scroll(-steps)},page:function(event){var axis=this.horz?'x':'y';event=new Event(event);var forward=(event.page[axis]>this.knob.getPosition()[axis]);this.scroll((forward?1:-1)*this.content['offset'+(this.horz?'Width':'Height')]);this.updateThumbFromContentScroll();this.fireEvent('onPage',forward);event.stop()},start:function(event){event=new Event(event);var axis=this.horz?'x':'y';this.mouse.start=event.page[axis];this.position.start=this.knob.getStyle(this.horz?'left':'top').toInt();document.addEvent('mousemove',this.bound.drag);document.addEvent('mouseup',this.bound.end);this.knob.addEvent('mouseup',this.bound.end);event.stop()},end:function(event){event=new Event(event);document.removeEvent('mousemove',this.bound.drag);document.removeEvent('mouseup',this.bound.end);this.knob.removeEvent('mouseup',this.bound.end);event.stop()},drag:function(event){event=new Event(event);var axis=this.horz?'x':'y';this.mouse.now=event.page[axis];this.position.now=(this.position.start+(this.mouse.now-this.mouse.start)).limit(0,(this.trackSize-this.knobSize));this.updateContentFromThumbPosition();this.updateThumbFromContentScroll();event.stop()}});MooScroller.implement(new Events);MooScroller.implement(new Options);function imgMouseOverEvents(outString,overString,selector){$$(selector).each(function(image){image=$(image);if($type(image.src)){if(image.src.indexOf(outString)>0){image.addEvent('mouseover',function(){image.src=image.src.replace(outString,overString)}).addEvent('mouseout',function(){image.src=image.src.replace(overString,outString)})}}})};window.addEvent('domready',function(){imgMouseOverEvents('_off','_over','img.autoMouseOverOff, input.autoMouseOverOff')});window.addEvent('domready',function(){imgMouseOverEvents('_off','_on','img.autoMouseOver, input.autoMouseOver')});function tabMouseOvers(cssOn,cssOff,selector,subselector,applyToBoth){$$(selector).each(function(el){el.applyToBoth=$pick(applyToBoth,false);if(applyToBoth&&subselector){el.getElementsBySelector(subselector).each(function(el){el.addClass(cssOff).removeClass(cssOn)})}el.addClass(cssOff).removeClass(cssOn);el.addEvent('mouseover',function(){this.addClass(cssOn).removeClass(cssOff);if(applyToBoth&&subselector){this.getElementsBySelector(subselector).each(function(subel){subel.addClass(cssOn).removeClass(cssOff)})}});el.addEvent('mouseout',function(){this.addClass(cssOff).removeClass(cssOn);if(applyToBoth&&subselector){$A(this.getElementsBySelector(subselector)).each(function(subel){subel.addClass(cssOff).removeClass(cssOn)})}})})};var TabSwapper=new Class({options:{selectedClass:'tabSelected',mouseoverClass:'tabOver',deselectedClass:'',rearrangeDOM:true,tabs:[],clickers:[],sections:[],initPanel:0,smooth:false,effectOptions:{duration:500},cookieName:null,cookieDays:999,onActive:Class.empty,onActiveAfterFx:Class.empty,onBackground:Class.empty},initialize:function(options){this.tabs=[];this.sections=[];this.clickers=[];options=this.compatability(options);this.setOptions(options);this.sectionOpacities=[];this.setup();if(this.options.cookieName&&this.recall())this.swap(this.recall().toInt());else this.swap(this.options.initPanel)},compatability:function(options){if(options.tabSelector){options.tabs=$$(options.tabSelector);options.sections=$$(options.sectionSelector);options.clickers=$$(options.clickSelector)}return options},setup:function(){var opt=this.options;sections=$$(opt.sections);tabs=$$(opt.tabs);clickers=$$(opt.clickers);tabs.each(function(tab,index){this.addTab(tab,sections[index],clickers[index],index)},this)},addTab:function(tab,section,clicker,index){tab=$(tab);clicker=$(clicker);section=$(section);if(this.tabs.indexOf(tab)>=0&&tab.getProperty('tabbered')&&this.tabs.indexOf(tab)!=index&&this.options.rearrangeDOM){this.moveTab(this.tabs.indexOf(tab),index);return}if(!$defined(index))index=this.tabs.length;if(index>0&&this.tabs[index-1]&&this.options.rearrangeDOM){tab.injectAfter(this.tabs[index-1]);section.injectAfter(this.sections[index-1])}this.tabs.splice(index,0,tab);this.sections.splice(index,0,section);clicker=clicker||tab;this.clickers.splice(index,0,clicker);tab.addEvent('mouseout',function(){tab.removeClass(this.options.mouseoverClass)}.bind(this)).addEvent('mouseover',function(){tab.addClass(this.options.mouseoverClass)}.bind(this));clicker.addEvent('click',function(){this.swap(this.clickers.indexOf(clicker))}.bind(this));tab.setProperty('tabbered',true);this.hideSection(index);return},removeTab:function(index){var now=this.tabs[this.now];if(this.now==index){if(index>0)this.swap(index-1);else if(index<this.tabs.length)this.swap(index+1)}this.sections.splice(index,1);this.tabs.splice(index,1);this.clickers.splice(index,1);this.sectionOpacities.splice(index,1);this.now=this.tabs.indexOf(now)},moveTab:function(from,to){var tab=this.tabs[from];var clicker=this.clickers[from];var section=this.sections[from];var toTab=this.tabs[to];var toClicker=this.clickers[to];var toSection=this.sections[to];this.tabs.remove(tab).splice(to,0,tab);this.clickers.remove(clicker).splice(to,0,clicker);this.sections.remove(section).splice(to,0,section);tab.injectBefore(toTab);clicker.injectBefore(toClicker);section.injectBefore(toSection)},swap:function(swapIdx){this.sections.each(function(sect,idx){if(swapIdx==idx)this.showSection(idx);else this.hideSection(idx)},this);this.save(swapIdx)},save:function(index){if(this.options.cookieName)Cookie.set(this.options.cookieName,index,{duration:this.options.cookieDays})},recall:function(){return(this.options.cookieName)?$pick(Cookie.get(this.options.cookieName),false):false},hideSection:function(idx){this.sections[idx].setStyle('display','none');this.tabs[idx].removeClass(this.options.selectedClass).addClass(this.options.deselectedClass);this.fireEvent('onBackground',[idx,this.sections[idx],this.tabs[idx]])},showSection:function(idx){var sect=this.sections[idx];if(this.now!=idx){if(!this.sectionOpacities[idx])this.sectionOpacities[idx]=this.sections[idx].effect('opacity',this.options.effectOptions);sect.setStyles({display:'block',opacity:0});if(this.options.smooth&&(!window.ie6||(window.ie6&&sect.fxOpacityOk())))this.sectionOpacities[idx].start(0,1).chain(function(){this.fireEvent('onActiveAfterFx',[idx,this.sections[idx],this.tabs[idx]])}.bind(this));else if(sect.getStyle('opacity')<1){this.sectionOpacities[idx].set(1);this.fireEvent('onActiveAfterFx',[idx,this.sections[idx],this.tabs[idx]])}this.now=idx;this.fireEvent('onActive',[idx,this.sections[idx],this.tabs[idx]])}this.tabs[idx].addClass(this.options.selectedClass).removeClass(this.options.deselectedClass)}});TabSwapper.implement(new Options);TabSwapper.implement(new Events);var tabSwapper=TabSwapper;var SimpleSlideShow=new Class({options:{startIndex:0,slides:[],currentSlideClass:'currentSlide',currentIndexContainer:false,maxContainer:false,nextLink:false,prevLink:false,wrap:true,disabledLinkClass:'disabled',onNext:Class.empty,onPrev:Class.empty,onSlideClick:Class.empty,crossFadeOptions:{}},initialize:function(options){this.setOptions(options);this.slides=this.options.slides;this.makeSlides();this.setCounters();this.setUpNav();this.now=this.options.startIndex;if(this.slides.length>0)this.showSlide(this.now)},setCounters:function(){if($(this.options.currentIndexContainer))$(this.options.currentIndexContainer).setHTML(this.now+1);if($(this.options.maxContainer))$(this.options.maxContainer).setHTML(this.slides.length)},makeSlides:function(){this.slides.each(function(slide,index){if(index!=this.now)slide.setStyle('display','none');else slide.setStyle('display','block');this.makeSlide(slide)},this)},makeSlide:function(slide){slide.addEvent('click',function(){this.fireEvent('onSlideClick')}.bind(this))},setUpNav:function(){if($(this.options.nextLink))$(this.options.nextLink).addEvent('click',function(){this.cycleForward()}.bind(this));if($(this.options.prevLink))$(this.options.prevLink).addEvent('click',function(){this.cycleBack()}.bind(this))},cycleForward:function(){if($type(this.now)&&this.now<this.slides.length-1)this.showSlide(this.now+1);else if($type(this.now)&&this.options.wrap)this.showSlide(0);else this.showSlide(this.options.startIndex);this.fireEvent('onNext');if(this.now==this.slides.length&&!this.options.wrap&&$(this.options.nextLink))$(this.options.nextLink).addClass(this.options.disabledLinkClass);else if($(this.options.nextLink))$(this.options.nextLink).removeClass(this.options.disabledLinkClass)},cycleBack:function(){if(this.now>0){this.showSlide(this.now-1);this.fireEvent('onPrev')}else if(this.options.wrap&&this.slides.length>1){this.showSlide(this.slides.length-1);this.fireEvent('onPrev')}if(this.now==0&&!this.options.wrap&&$(this.options.prevSlide))$(this.options.prevSlide).addClass(this.options.disabledLinkClass);else if($(this.options.prevSlide))$(this.options.prevSlide).removeClass(this.options.disabledLinkClass)},showSlide:function(iToShow){var now=this.now;var s=this.slides[iToShow];function fadeIn(s,resetOpacity){s.setStyle('display','block');if(s.fxOpacityOk()){if(resetOpacity)s.setStyle('opacity',0);s.effect('opacity',this.options.crossFadeOptions).start(1)}};if(s){if($type(this.now)&&this.now!=iToShow){if(s.fxOpacityOk()){this.slides[this.now].effect('opacity',this.options.crossFadeOptions).start(0).chain(function(){this.slides[now].setStyle('display','none');s.addClass(this.options.currentSlideClass);fadeIn.bind(this,[s,true])()}.bind(this))}else{this.slides[this.now].setStyle('display','none');fadeIn.bind(this,s)()}}else fadeIn.bind(this,s)();this.now=iToShow;this.setCounters()}},slideClick:function(){this.fireEvent('onSlideClick',[this.slides[this.now],this.now])}});SimpleSlideShow.implement(new Events);SimpleSlideShow.implement(new Options);var SimpleImageSlideShow=SimpleSlideShow.extend({options:{imgUrls:[],imgClass:'screenshot',container:false},initialize:function(options){this.parent(options);this.options.imgUrls.each(function(url){this.addImg(url)},this);this.showSlide(this.options.startIndex)},addImg:function(url){if($(this.options.container)){var img=new Element('img').setProperties({'src':url,'id':this.options.imgClass+this.slides.length}).addClass(this.options.imgClass).setStyle('display','none').injectInside($(this.options.container)).addEvent('click',this.slideClick.bind(this));this.slides.push(img);this.makeSlide(img);this.setCounters()}}});var JsonP=new Class({options:{onComplete:Class.empty,callBackKey:"callback",queryString:"",data:{},timeout:5000,retries:0},initialize:function(url,options){this.setOptions(options);this.url=this.makeUrl(url).url;this.fired=false;this.scripts=[];this.requests=0;this.triesRemaining=[]},request:function(url,requestIndex){var u=this.makeUrl(url);if(!$chk(requestIndex)){requestIndex=this.requests;this.requests++}if(!$chk(this.triesRemaining[requestIndex]))this.triesRemaining[requestIndex]=this.options.retries;var remaining=this.triesRemaining[requestIndex];dbug.log('retrieving by json script method: %s',u.url);var dl=(window.ie)?50:0;(function(){var script=new Asset.javascript(u.url,{id:'jsonp_'+u.index+'_'+requestIndex});this.fired=true;this.addEvent('onComplete',function(){try{script.remove()}catch(e){}}.bind(this));if(remaining){(function(){this.triesRemaining[requestIndex]=remaining-1;if(script.getParent()&&remaining){dbug.log('removing script (%o) and retrying: try: %s, remaining: %s',requestIndex,remaining);script.remove();this.request(url,requestIndex)}}).delay(this.options.timeout,this)}}.bind(this)).delay(dl);return this},makeUrl:function(url){var index=(JsonP.requestors.contains(this))?JsonP.requestors.indexOf(this):JsonP.requestors.push(this)-1;if(url){var separator=(url.test('\\?'))?'&':'?';var jurl=url+separator+this.options.callBackKey+"=JsonP.requestors["+index+"].handleResults";if(this.options.queryString)jurl+="&"+this.options.queryString;jurl+="&"+Object.toQueryString(this.options.data)}else var jurl=this.url;return{url:jurl,index:index}},handleResults:function(data){dbug.log('jsonp received: ',data);this.fireEvent('onComplete',[data,this])}});JsonP.requestors=[];JsonP.implement(new Options);JsonP.implement(new Events);var Picklet=new Class({initialize:function(className,options){this.setOptions(options);this.className=className;this.getQuery=this.options.getQuery}});Picklet.implement(new Options);var ProductPicker=new Class({options:{onShow:Class.empty,onPick:Class.empty,title:'Product picker',showOnFocus:true,additionalShowLinks:[],stickyWinToUse:StickyWinFx,stickyWinOptions:{fadeDuration:200,draggable:true},moveIntoView:true,baseHref:'http://www.cnet.com/html/rb/assets/global/Picker'},initialize:function(input,picklets,options){this.setOptions(options);this.input=$(input);this.picklets=picklets;this.setUpObservers();this.writeCss()},writeCss:function(){var css="div.productPickerProductDiv div.results { overflow: 'auto'; width: 100%; margin-top: 4px }"+"div.productPickerProductDiv select { margin: 4px 0px 4px 0px}"+"div.pickerPreview div.sliderContent img {border: 1px solid #000}"+"div.pickerPreview div.sliderContent a {color: #0d63a0}";try{if(!$('pickerStyles')){var style=new Element('style').setProperty('id','pickerStyles').injectInside($$('head')[0]);if(!style.setText.attempt(css,style))style.appendText(css)}}catch(e){dbug.log('error: %s',e)}},getPickletList:function(){if(this.picklets.length>1){var selector=new Element('select').setStyle('width','399px');this.picklets.each(function(picklet,index){var opt=new Element('option').setProperty('value',index);opt.text=picklet.options.descriptiveName;selector.adopt(opt)},this);selector.addEvent('change',function(){this.showForm(this.picklets[selector.getValue()]);this.focusInput(true)}.bind(this));return selector}else return false},buildPicker:function(picklet){var contents=new Element('div');this.formBody=new Element('div');this.pickletList=this.getPickletList();if(this.pickletList)contents.adopt(this.pickletList);contents.adopt(this.formBody);var body=stickyWinHTML(this.options.title,contents,{width:'450px',closeTxt:'close'}).addClass('productPickerProductDiv');this.showForm();return body},showForm:function(picklet){this.form=this.makeSearchForm(picklet||this.picklets[0]);this.formBody.empty().adopt(this.form);this.results=new Element('div').addClass('results');this.formBody.adopt(this.results);this.sliderFx=null},makeSlider:function(){var png=(window.ie)?'gif':'png';this.slider=new Element('div').addClass('pickerPreview').setStyles({background:'url('+this.options.baseHref+'/slider.'+png+') top right no-repeat',display:'none',height:'250px',left:'439px',position:'absolute',top:'25px',width:'0px',overflow:'hidden'}).injectInside(this.swin.win).addEvent('mouseover',function(){this.previewHover=true}.bind(this)).addEvent('mouseout',function(){this.previewHover=false;(function(){if(!this.previewHover)this.hidePreview()}).delay(400,this)}.bind(this));this.sliderContent=new Element('div').injectInside(this.slider).setStyles({width:'130px',height:'200px',padding:'10px',margin:'10px 10px 0px 0px',overflow:'auto',cssFloat:'right'}).addClass('sliderContent')},makeSearchForm:function(picklet){this.currentPicklet=picklet;var formTable=new Element('table').setStyle('width','100%').setProperties({cellpadding:'0',cellspacing:'0'});var tBody=new Element('tbody').injectInside(formTable);var form=new Element('form').addEvent('submit',function(e){this.getResults(new Event(e).target,picklet)}.bind(this)).adopt(formTable).setProperty('action','javascript:void(0);');$each(picklet.options.inputs,function(val,name){tBody.adopt(this.getSearchInputTr(val,name))},this);return form},getSearchInputTr:function(val,name){try{var style=($type(val.style))?val.style:{};var input=(window.ie)?new Element('<'+val.tagName+' name="'+name+'" />'):new Element(val.tagName).setProperty('name',name);input.setStyles(style);if(val.type)input.setProperty('type',val.type);if(val.tip&&Tips){input.setProperty('title',val.tip);new Tips([input],{onShow:function(tip){this.shown=true;(function(){if(this.shown)$(tip).setStyles({display:'block',opacity:0}).effect('opacity',{duration:300}).start(0,.9)}).delay(500,this)},onHide:function(tip){tip.setStyle('visibility','hidden');this.shown=false}})}if(val.tagName=="select"){val.value.each(function(option,index){var opt=new Element('option').setProperty('value',option);opt.text=(val.optionNames&&val.optionNames[index])?$pick(val.optionNames[index],option):option;input.adopt(opt)})}else input.value=$pick(val.value,"");var holder=new Element('tr');var colspan=0;if(val.instructions)holder.adopt(new Element('td').setHTML(val.instructions));else colspan=2;var inputTD=new Element('td').adopt(input);if(colspan)inputTD.setProperty('colspan',colspan);holder.adopt(inputTD);return holder}catch(e){dbug.log(e);return false}},getResults:function(form,picklet){if(form.getTag()!="form")form=$$('form').filter(function(fm){return fm.hasChild(form)})[0];if(!form){dbug.log('error computing form');return null}var query=picklet.getQuery(unescape(form.toQueryString()).parseQuery());query.addEvent('onComplete',this.showResults.bind(this));query.request();return this},showResults:function(data){var empty=false;if(this.results.innerHTML==''){empty=true;this.results.setStyles({height:'0px',border:'1px solid #666',padding:'0px',overflow:'auto',opacity:0})}else this.results.empty();this.items=this.currentPicklet.options.resultsList(data);if(this.items&&this.items.length>0){this.items.each(function(item,index){var name=this.currentPicklet.options.listItemName(item);var value=this.currentPicklet.options.listItemValue(item);this.results.adopt(this.makeProductListEntry(name,value,index))},this)}else this.results.setHTML("Sorry, there don't seem to be any items for that search");this.results.effects().start({height:200,opacity:1});this.listStyles();this.getOnScreen.delay(500,this)},getOnScreen:function(){if(document.compatMode=="BackCompat")return;var s=this.swin.win.getCoordinates();if(s.top<window.getScrollTop()){this.swin.win.effect('top').start(window.getScrollTop()+50);return}if(s.top+s.height>window.getScrollTop()+window.getHeight()&&window.getHeight()>s.height){this.swin.win.effect('top').start(window.getScrollTop()+window.getHeight()-s.height-100);return}try{this.swin.shim.show.delay(500,this.swin.shim)}catch(e){}return},listStyles:function(){var defaultStyle={cursor:'pointer',borderBottom:'1px solid #ddd',padding:'2px 8px 2px 8px',backgroundColor:'#fff',color:'#000',fontWeight:'normal'};var hoverStyle={backgroundColor:'#fcfbd1',color:'#d56a00'};var selectedStyle=$merge(defaultStyle,{color:'#D00000',fontWeight:'bold',backgroundColor:'#eee'});this.results.getElements('div.productPickerProductDiv').each(function(p){var useStyle=(this.input.value.toInt()==p.getProperty('val').toInt())?selectedStyle:defaultStyle;p.setStyles(useStyle);if(!window.ie){p.addEvent('mouseover',function(){p.setStyles(hoverStyle)}.bind(this));p.addEvent('mouseout',function(){p.setStyles(useStyle)})}},this)},makeProductListEntry:function(name,value,index){var pDiv=new Element("div").addClass('productPickerProductDiv').adopt(new Element("div").setHTML(name)).setProperty('val',value);pDiv.addEvent('mouseenter',function(e){this.preview=true;this.sliderContent.setHTML("");var content=this.getPreview(index);if($type(content)=="string")this.sliderContent.setHTML(content);else if($(content))this.sliderContent.adopt(content);this.showPreview.delay(200,this)}.bind(this));pDiv.addEvent('mouseleave',function(e){this.preview=false;(function(){if(!this.previewHover)this.hidePreview()}).delay(400,this)}.bind(this));pDiv.addEvent('click',function(){this.currentPicklet.options.updateInput(this.input,this.items[index]);this.fireEvent('onPick',[this.input,this.items[index],this]);this.hide();this.listStyles.delay(200,this)}.bind(this));return pDiv},makeStickyWin:function(){if(document.compatMode=="BackCompat")this.options.stickyWinOptions.relativeTo=this.input;this.swin=new this.options.stickyWinToUse($merge(this.options.stickyWinOptions,{draggable:true,content:this.buildPicker()}))},focusInput:function(force){if((!this.focused||$pick(force,false))&&this.form.getElement('input')){this.focused=true;try{this.form.getElement('input').focus()}catch(e){}}},show:function(){if(!this.swin)this.makeStickyWin();if(!this.slider)this.makeSlider();if(!this.swin.visible)this.swin.show();this.focusInput()},hide:function(){$$('.tool-tip').hide();this.swin.hide();this.focused=false},setUpObservers:function(){try{if(this.options.showOnFocus)this.input.addEvent('focus',this.show.bind(this));if(this.options.additionalShowLinks.length>0){this.options.additionalShowLinks.each(function(lnk){$(lnk).addEvent('click',this.show.bind(this))},this)}}catch(e){dbug.log(e)}},showPreview:function(index){width=this.currentPicklet.options.previewWidth||150;this.sliderContent.setStyle('width',(width-30)+'px');if(!this.sliderFx)this.sliderFx=new Fx.Elements([this.slider,this.swin.win]);this.sliderFx.clearChain();$extend(this.sliderFx.options,{duration:1000,transition:Fx.Transitions.elasticOut});if(this.preview&&this.slider.getStyle('width').toInt()<width-5){this.slider.show('block');this.sliderFx.start({'0':{'width':width},'1':{'width':width+450}})}},hidePreview:function(){if(!this.preview){$extend(this.sliderFx.options,{duration:250,transition:Fx.Transitions.backIn});this.sliderFx.clearChain();this.sliderFx.start({'0':{'width':[this.slider.getStyle('width').toInt(),0]},'1':{'width':[this.swin.win.getStyle('width').toInt(),450]}}).chain(function(){this.slider.hide()}.bind(this))}},getPreview:function(index){return this.currentPicklet.options.previewHtml(this.items[index])}});ProductPicker.implement(new Options);ProductPicker.implement(new Events);$extend(ProductPicker,{picklets:[],add:function(picklet){if(!picklet.className){dbug.log('error: cannot add Picklet %o; missing className: %s',picklet,picklet.className);return}this.picklets[picklet.className]=picklet},addAllThese:function(picklets){picklets.each(function(picklet){this.add(picklet)},this)},getPicklet:function(className){return ProductPicker.picklets[className]||false}});var FormPickers=new Class({options:{inputs:'input',additionalShowLinkClass:'openPicker',pickletOptions:{}},initialize:function(form,options){this.setOptions(options);this.form=$(form);this.inputs=this.form.getElementsBySelector(this.options.inputs);this.setUpInputs()},setUpInputs:function(inputs){inputs=$pick(inputs,this.inputs);inputs.each(this.addPickers.bind(this))},addPickers:function(input){var picklets=[];input.className.split(" ").each(function(clss){if(ProductPicker.getPicklet(clss))picklets.push(ProductPicker.getPicklet(clss))},this);if(input.getNext()&&input.getNext().hasClass(this.options.additionalShowLinkClass))this.options.pickletOptions.additionalShowLinks=[input.getNext()];if(picklets.length>0)new ProductPicker(input,picklets,this.options.pickletOptions)}});FormPickers.implement(new Options);var CNETProductPickerBase={previewWidth:150,descriptiveName:'CNET Product Picker',url:'http://api.cnet.com/restApi/v1.0/techProductSearch',callBackKey:'callback',data:{partKey:'19926949750937665684988687810562',iod:'hlPrice',viewType:'json'},getQuery:function(data){$each(data,function(val,key){data[key]=unescape(val)});return new JsonP(this.options.url,{callBackKey:this.options.callBackKey,data:$merge(this.options.data,data)})},inputs:{query:{tagName:'input',type:'text',instructions:'',tip:'cnet product search::input a product name and hit &lt;enter&gt; to get results',value:'',style:{width:'100%'}}},previewHtml:function(data){var editors="";var html='<div class="dataId" style="color: #999; font-weight:bold; margin: 0px; padding: 0px;">id: '+data['@id']+'</div>'+'<div class="dataDetails" style="font-size: 10px;"><a href="'+data.ReviewURL.$+'"><img height="45" width="'+data.ImageURL[0]["@width"]+'" style="margin-left: 10px" src="'+data.ImageURL[1].$+'"/></a><br /><b><a href="'+data.ReviewURL.$+'">'+data.Name.$+'</a></b>';if(data.EditorsRating&&data.EditorsRating.$)html+="<br/>editors' rating: "+data.EditorsRating.$;html+="<div>";if(data.LowPrice&&data.LowPrice.$)html+="<span class='productPickerPrices'>"+data.LowPrice.$+"</span>";if(data.HighPrice&&data.HighPrice.$&&(data.LowPrice.$!=data.HighPrice.$))html+=" to <span class='productPickerPrices'>"+data.HighPrice.$+"</span>";html+="</div></div>";html+="<div>";if(data.Offers&&data.Offers['@numFound']>0)html+="resellers: "+data.Offers["@numFound"];html+="</div>";return html},resultsList:function(results){if(results.CNETResponse.TechProducts&&results.CNETResponse.TechProducts["@numFound"]>0){if(results.CNETResponse.TechProducts["@numFound"]>1)return results.CNETResponse.TechProducts.TechProduct;else return[results.CNETResponse.TechProducts.TechProduct]}return false},listItemName:function(data){return data.Name.$},listItemValue:function(data){return data['@id']},updateInput:function(input,data){input.value=data['@id'];input.fireEvent('change')}};var CNETProductPicker=new Picklet('CNETProductPicker',CNETProductPickerBase);ProductPicker.add(CNETProductPicker);var CNETProductPicker_ReviewPath=new Picklet('CNETProductPicker_ReviewPath',$merge(CNETProductPickerBase,{descriptiveName:'CNET Product Picker: Review URL',updateInput:function(input,data){var url=data.ReviewURL.$;if(url.indexOf("?")>=0)url=url.substring(0,url.indexOf("?"));input.value=url;input.fireEvent('change')}}));ProductPicker.add(CNETProductPicker_ReviewPath);var CNETProductPicker_PricePath=new Picklet('CNETProductPicker_ReviewPath',$merge(CNETProductPickerBase,{descriptiveName:'CNET Product Picker: Price URL',updateInput:function(input,data){var url=data.PriceURL.$;if(url.indexOf("?")>=0)url=url.substring(0,url.indexOf("?"));input.value=url;input.fireEvent('change')}}));ProductPicker.add(CNETProductPicker_PricePath);var Confirmer=new Class({options:{reposition:true,positionOptions:{relativeTo:false,position:'upperRight',offset:{x:-225,y:0},zIndex:9999},msg:'your changes have been saved',msgContainerSelector:'.body',delay:250,pause:500,effectOptions:{duration:500},prompterStyle:{padding:'2px 6px',border:'1px solid #9f0000',backgroundColor:'#f9d0d0',fontWeight:'bold',color:'#000',width:'210px'},onComplete:Class.empty},initialize:function(options){this.setOptions(options);this.options.positionOptions.relativeTo=this.options.positionOptions.relativeTo||document.body;this.prompter=($(this.options.msg))?$(this.options.msg):this.makePrompter(this.options.msg);if(this.options.reposition){this.prompter.setStyles({position:'absolute',display:'none',zIndex:this.options.positionOptions.zIndex});if(this.prompter.fxOpacityOk())this.prompter.setStyle('opacity',0)}else if(this.prompter.fxOpacityOk())this.prompter.setStyle('opacity',0);else this.prompter.setStyle('visibility','hidden');if(!this.prompter.getParent())window.addEvent('domready',function(){this.prompter.injectInside(document.body)}.bind(this));try{this.msgHolder=this.prompter.getElement(this.options.msgContainerSelector);if(!this.msgHolder)this.msgHolder=this.prompter}catch(e){dbug.log(e)}},makePrompter:function(msg){try{return new Element('div').setStyles(this.options.prompterStyle).appendText(msg)}catch(e){dbug.log(e);return prompter}},prompt:function(options){if(!this.paused)this.stop();var msg=(options)?options.msg:false;options=$merge(this.options,{saveAsDefault:false},options||{});if($(options.msg)&&msg)this.msgHolder.empty().adopt(options.msg);else if(!$(options.msg)&&options.msg)this.msgHolder.empty().appendText(options.msg);if(!this.paused){if(options.reposition)this.position(options.positionOptions);(function(){this.timer=this.fade(options.pause)}).delay(options.delay,this)}if(options.saveAsDefault)this.setOptions(options)},fade:function(pause){this.paused=true;pause=$pick(pause,this.options.pause);if(!this.fx&&this.prompter.fxOpacityOk()){this.fx=this.prompter.effect('opacity',this.options.effectOptions);this.fx.clearChain()}if(this.options.reposition)this.prompter.setStyle('display','block');if(this.prompter.fxOpacityOk()){this.prompter.setStyle('visibility','visible');this.fx.start(0,1).chain(function(){this.timer=(function(){this.fx.start(0).chain(function(){if(this.options.reposition)this.prompter.hide();this.paused=false}.bind(this))}).delay(pause,this)}.bind(this))}else{this.prompter.setStyle('visibility','visible');this.timer=(function(){this.prompter.setStyle('visibility','hidden');this.fireEvent('onComplete');this.paused=false}).delay(pause+this.options.effectOptions.duration,this)}},stop:function(){this.paused=false;$clear($pick(this.timer,false));if(this.fx)this.fx.set(0);if(this.options.reposition)this.prompter.hide()},position:function(positionOptions){this.prompter.setPosition($merge(this.options.positionOptions,positionOptions))}});Confirmer.implement(new Options);Confirmer.implement(new Events);var Clipboard={swfLocation:'http://www.cnet.com/html/rb/assets/global/clipboard/_clipboard.swf',copyFromElement:function(element){element=$(element);if(!element)return null;if(window.ie){try{window.addEvent('domready',function(){var range=element.createTextRange();if(range)range.execCommand('Copy')})}catch(e){dbug.log('cannot copy to clipboard: %s',o)}}else{var text=(element.getSelectedText)?element.getSelectedText():element.getValue();if(text)Clipboard.copy(text)}return element},copy:function(text){if(window.ie){window.addEvent('domready',function(){var cb=new Element('textarea',{styles:{display:'none'}}).injectInside(document.body);cb.setProperty('value',text).select();Clipboard.copyFromElement(cb);cb.remove()})}else{var swf=($('flashcopier'))?$('flashcopier'):new Element('div').setProperty('id','flashcopier').injectInside(document.body);swf.empty();swf.setHTML('<embed src="'+this.swfLocation+'" FlashVars="clipboard='+escape(text)+'" width="0" height="0" type="application/x-shockwave-flash"></embed>')}}};var HtmlTable=new Class({options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[]},initialize:function(options){this.setOptions(options);if(this.options.properties.className){this.options.properties['class']=this.options.properties.className;delete this.options.properties.className}this.table=new Element('table').setProperties(this.options.properties);this.tbody=new Element('tbody').injectInside(this.table);this.options.rows.each(this.push.bind(this))},push:function(row){var tr=new Element('tr').injectInside(this.tbody);var tds=row.map(function(tdata){var td=new Element('td').injectInside(tr);if(tdata.properties){if(tdata.properties.className){tdata.properties['class']=tdata.properties.className;delete tdata.properties.className}td.setProperties(tdata.properties)}function setContent(content){if($(content))td.adopt($(content));else td.setHTML(content)};if(tdata.content)setContent(tdata.content);else setContent(tdata);return td},this);return{tr:tr,tds:tds}}});HtmlTable.implement(new Options);var Autocompleter={};Autocompleter.Base=new Class({options:{minLength:1,useSelection:true,markQuery:true,inheritWidth:true,dropDownWidth:100,maxChoices:10,injectChoice:null,onSelect:Class.empty,onShow:Class.empty,onHide:Class.empty,customTarget:null,className:'autocompleter-choices',zIndex:42,observerOptions:{},fxOptions:{},multi:false,delimeter:', ',autotrim:true,allowDupes:false,baseHref:'http://www.cnet.com/html/rb/assets/global/autocompleter/'},initialize:function(el,options){this.setOptions(options);if(!$('AutocompleterCss'))window.addEvent('domready',function(){new Asset.css(this.options.baseHref+'Autocompleter.css',{id:'AutocompleterCss'})}.bind(this));this.element=$(el);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),$merge({delay:400},this.options.observerOptions));this.value=this.observer.value;this.queryValue=null;this.element.addEvent('blur',function(e){this.autoTrim.delay(50,this,e)}.bind(this));this.addEvent('onSelect',function(){this.element.focus();this.userChose=true;(function(){this.userChose=false}).delay(100,this)}.bind(this))},build:function(){if($(this.options.customTarget))this.choices=this.options.customTarget;else{this.choices=new Element('ul',{'class':this.options.className,'styles':{zIndex:this.options.zIndex}}).injectInside(document.body);this.fix=new OverlayFix(this.choices)}this.fx=this.choices.effect('opacity',$merge({wait:false,duration:200},this.options.fxOptions)).addEvent('onStart',function(){if(this.fx.now)return;this.choices.setStyle('display','');this.fix.show()}.bind(this)).addEvent('onComplete',function(){if(this.fx.now)return;this.choices.setStyle('display','none');this.fix.hide()}.bind(this)).set(0);this.element.setProperty('autocomplete','off').addEvent(window.ie?'keydown':'keypress',this.onCommand.bindWithEvent(this)).addEvent('mousedown',this.onCommand.bindWithEvent(this,[true])).addEvent('focus',this.toggleFocus.bind(this,[true])).addEvent('blur',this.toggleFocus.bind(this,[false])).addEvent('trash',this.destroy.bind(this))},autoTrim:function(e){if(this.userChose)return this.userChose=false;var del=this.options.delimeter;var val=this.element.getValue();if(this.options.autotrim&&val.test(del+"$")){e=new Event(e);this.observer.value=this.element.value=val.substring(0,val.length-del.length)}return this.observer.value},getQueryValue:function(value){value=$pick(value,this.observer.value);return(this.options.multi)?value.lastElement(this.options.delimeter).toString():value||''},destroy:function(){this.choices.remove()},toggleFocus:function(state){this.focussed=state;if(!state)this.hideChoices()},onCommand:function(e,mouse){var val=this.getQueryValue();if(mouse&&this.focussed)this.prefetch();if(e.key)switch(e.key){case'enter':if(this.selected&&this.visible){this.choiceSelect(this.selected);e.stop()}return;case'up':case'down':if(this.getQueryValue()!=(val||this.queryValue))this.prefetch();else if(this.queryValue===null)break;else if(!this.visible)this.showChoices();else{this.choiceOver((e.key=='up')?this.selected.getPrevious()||this.choices.getLast():this.selected.getNext()||this.choices.getFirst());this.setSelection()}e.stop();return;case'esc':case'tab':this.hideChoices();if(this.options.multi)this.element.value=this.element.getValue().trimLastElement();return}this.value=false},setSelection:function(){if(!this.options.useSelection)return;var del=this.options.delimeter;var qVal=this.getQueryValue(this.queryValue);var elVal=this.getQueryValue(this.element.getValue());var startLength;if(this.options.multi){var index=this.queryValue.lastIndexOf(del);var delLength=(index<0)?0:del.length;startLength=qVal.length+(index<0?0:index)+delLength}else startLength=qVal.length;if(elVal.indexOf(qVal)!=0)return;var insert=this.selected.inputValue.substr(startLength);if(window.ie){var sel=document.selection.createRange();sel.text=insert;sel.move("character",-insert.length);sel.findText(insert);sel.select()}else{var offset=(this.options.multi&&this.element.value.test(del))?this.element.getValue().length-elVal.length+qVal.length:this.queryValue.length;this.element.value=this.element.value.substring(0,offset)+insert;this.element.selectionStart=offset;this.element.selectionEnd=this.element.value.length}this.value=this.observer.value=this.element.value},hideChoices:function(){if(!this.visible)return;this.visible=this.value=false;this.observer.clear();this.fx.start(0);this.fireEvent('onHide',[this.element,this.choices])},showChoices:function(){if(this.visible||!this.choices.getFirst())return;this.visible=true;var pos=this.element.getCoordinates(this.options.overflown);this.choices.setStyles({'left':pos.left,'top':pos.bottom});this.choices.setStyle('width',(this.options.inheritWidth)?pos.width:this.options.dropDownWidth);this.fx.start(1);this.choiceOver(this.choices.getFirst());this.fireEvent('onShow',[this.element,this.choices])},prefetch:function(){var val=this.getQueryValue(this.element.getValue());if(val.length<this.options.minLength)this.hideChoices();else if(val==this.queryValue)this.showChoices();else this.query()},updateChoices:function(choices){this.choices.empty();this.selected=null;if(!choices||!choices.length)return;if(this.options.maxChoices<choices.length)choices.length=this.options.maxChoices;choices.each(this.options.injectChoice||function(choice,i){var el=new Element('li').setHTML(this.markQueryValue(choice));el.inputValue=choice;this.addChoiceEvents(el).injectInside(this.choices)},this);this.showChoices()},choiceOver:function(el){if(this.selected)this.selected.removeClass('autocompleter-selected');this.selected=el.addClass('autocompleter-selected')},choiceSelect:function(el){if(this.options.multi){var del=this.options.delimeter;var value=(this.element.value.trimLastElement(del)+el.inputValue).split(del);var fin=[];if(!this.options.allowDupes){value.each(function(item){if(fin.contains(item))fin.remove(item);fin.include(item)})}else fin=value;this.observer.value=this.element.value=fin.join(del)+del}else this.observer.value=this.element.value=el.inputValue;this.hideChoices();this.fireEvent('onSelect',[this.element,el.inputValue],20)},markQueryValue:function(txt){var val=(this.options.mult)?this.lastQueryElementValue:this.queryValue;return(this.options.markQuery&&val)?txt.replace(new RegExp('^('+val.escapeRegExp()+')','i'),'<span class="autocompleter-queried">$1</span>'):txt},addChoiceEvents:function(el){return el.addEvents({'mouseover':this.choiceOver.bind(this,[el]),'mousedown':this.choiceSelect.bind(this,[el])})},query:Class.empty});Autocompleter.Base.implement(new Events);Autocompleter.Base.implement(new Options);var OverlayFix=new Class({initialize:function(el){this.element=$(el);if(window.ie){this.element.addEvent('trash',this.destroy.bind(this));this.fix=new Element('iframe',{'properties':{'frameborder':'0','scrolling':'no','src':'javascript:false;'},'styles':{'position':'absolute','border':'none','display':'none','filter':'progid:DXImageTransform.Microsoft.Alpha(opacity=0)'}}).injectAfter(this.element)}},show:function(){if(this.fix)this.fix.setStyles($extend(this.element.getCoordinates(),{'display':'','zIndex':(this.element.getStyle('zIndex')||1)-1}));return this},hide:function(){if(this.fix)this.fix.setStyle('display','none');return this},destroy:function(){this.fix.remove()}});String.extend({lastElement:function(separator){separator=separator||' ';var txt=this;var index=txt.lastIndexOf(separator);var result=(index==-1)?txt:txt.substr(index+separator.length,txt.length);return result},trimLastElement:function(separator){separator=separator||' ';var txt=this;var index=this.lastIndexOf(separator);return(index==-1)?"":txt.substr(0,index+separator.length)}});Autocompleter.JsonP=Autocompleter.Base.extend({options:{postVar:'query',jsonpOptions:{},onRequest:Class.empty,onComplete:Class.empty,minLength:1,filterResponse:null},initialize:function(el,url,options){this.url=url;this.parent(el,options);if(this.options.filterResponse)this.filterResponse=this.options.filterResponse.bind(this)},query:function(){var multi=this.options.multi;var data=$extend({},this.options.jsonpOptions.data);if(multi)this.lastQueryElementValue=this.element.value.lastElement(this.options.delimeter);data[this.options.postVar]=(multi)?this.lastQueryElementValue:this.element.value;this.jsonp=new JsonP(this.url,$merge({data:data},this.options.jsonpOptions));this.jsonp.addEvent('onComplete',this.queryResponse.bind(this));this.fireEvent('onRequest',[this.element,this.jsonp]);this.jsonp.request()},queryResponse:function(resp){try{this.value=this.queryValue=this.element.value;var choices=this.filterResponse(resp);this.selected=false;this.hideChoices()}catch(e){try{dbug.log('jsonp request error: ',e)}catch(e){}}this.fireEvent(choices?'onComplete':'onFailure',[this.element,choices],20);if(!choices||!choices.length)return;this.updateChoices(choices)},filterResponse:function(resp){var regex=new RegExp('^'+this.queryValue.escapeRegExp(),'i');return this.tokens.filter(function(token){return regex.test(token)})}});Autocompleter.Local=Autocompleter.Base.extend({options:{minLength:0,filterTokens:null},initialize:function(el,tokens,options){this.parent(el,options);this.tokens=tokens;if(this.options.filterTokens)this.filterTokens=this.options.filterTokens.bind(this)},query:function(){this.hideChoices();this.queryValue=(this.options.multi)?this.element.value.lastElement(this.options.delimeter).trim():this.element.value;this.updateChoices(this.filterTokens())},filterTokens:function(token){var regex=new RegExp('^'+this.queryValue.escapeRegExp(),'i');return this.tokens.filter(function(token){return regex.test(token)})}});Autocompleter.Ajax={};Autocompleter.Ajax.Base=Autocompleter.Base.extend({options:{postVar:'value',postData:{},ajaxOptions:{},onRequest:Class.empty,onComplete:Class.empty},initialize:function(el,url,options){this.parent(el,options);this.ajax=new Ajax(url,$merge({autoCancel:true},this.options.ajaxOptions));this.ajax.addEvent('onComplete',this.queryResponse.bind(this));this.ajax.addEvent('onFailure',this.queryResponse.bind(this,[false]))},query:function(){var multi=this.options.multi;var data=$extend({},this.options.postData);if(multi)this.lastQueryElementValue=this.element.value.lastElement(this.options.delimeter);data[this.options.postVar]=(multi)?this.lastQueryElementValue:this.element.value;this.fireEvent('onRequest',[this.element,this.ajax]);this.ajax.request(data)},queryResponse:function(resp){this.value=this.queryValue=this.element.value;this.selected=false;this.hideChoices();this.fireEvent(resp?'onComplete':'onFailure',[this.element,this.ajax],20)}});Autocompleter.Ajax.Json=Autocompleter.Ajax.Base.extend({queryResponse:function(resp){this.parent(resp);var choices=Json.evaluate(resp||false);if(!choices||!choices.length)return;this.updateChoices(choices)}});Autocompleter.Ajax.Xhtml=Autocompleter.Ajax.Base.extend({options:{parseChoices:null},queryResponse:function(resp){this.parent(resp);if(!resp)return;this.choices.setHTML(resp).getChildren().each(this.options.parseChoices||this.parseChoices,this);this.showChoices()},parseChoices:function(el){var value=el.innerHTML;el.inputValue=value;el.setHTML(this.markQueryValue(value))}});var Observer=new Class({options:{periodical:false,delay:1000},initialize:function(el,onFired,options){this.setOptions(options);this.addEvent('onFired',onFired);this.element=$(el);this.listener=this.fired.bind(this);this.value=this.element.getValue();if(this.options.periodical)this.timer=this.listener.periodical(this.options.periodical);else this.element.addEvent('keyup',this.listener)},fired:function(){var value=this.element.getValue();if(this.value==value)return;this.clear();this.value=value;this.timeout=this.fireEvent.delay(this.options.delay,this,['onFired',[value]])},clear:function(){$clear(this.timeout);return this}});Observer.implement(new Options);Observer.implement(new Events);var Lightbox=new Class({options:{resizeDuration:400,resizeTransition:false,initialWidth:250,initialHeight:250,zIndex:10,animateCaption:true,showCounter:true,autoScanLinks:true,relString:'lightbox',useDefaultCss:true,assetBaseUrl:'http://www.cnet.com/html/rb/assets/global/slimbox/',onImageShow:Class.empty,onDisplay:Class.empty,onHide:Class.empty,overlayStyles:{}},initialize:function(options,anchors){this.setOptions(options);this.anchors=anchors||[];if(this.options.autoScanLinks){$$('a').each(function(el){if(el.getProperty('rel')&&el.getProperty('rel').test("^"+this.options.relString,'i')){if(!el.getProperty('lightboxed'))this.anchors.push(el)}},this)}if(!$$(this.anchors).length)return;if(this.options.useDefaultCss)this.addCss();$$(this.anchors).each(function(el){if(!el.getProperty('lightboxed')){el.setProperty('lightboxed',true);el.addEvent('click',function(e){new Event(e).stop();this.click(el)}.bind(this))}}.bind(this));this.eventKeyDown=this.keyboardListener.bindAsEventListener(this);this.eventPosition=this.position.bind(this);window.addEvent('domready',this.addHtmlElements.bind(this))},addHtmlElements:function(){this.overlay=new Element('div',{'class':'lbOverlay',styles:{'z-index':this.options.zIndex}}).injectInside(document.body).setStyles(this.options.overlayStyles);this.center=new Element('div',{styles:{width:this.options.initialWidth+'px',height:this.options.initialHeight+'px','margin-left':(-(this.options.initialWidth/2))+'px','display':'none','z-index':this.options.zIndex+1}}).injectInside(document.body).addClass('lbCenter');this.image=new Element('div',{'class':'lbImage'}).injectInside(this.center);this.prevLink=new Element('a',{'class':'lbPrevLink','href':'javascript:void(0);','styles':{'display':'none'}}).injectInside(this.image);this.nextLink=this.prevLink.clone().removeClass('lbPrevLink').addClass('lbNextLink').injectInside(this.image);this.prevLink.addEvent('click',this.previous.bind(this));this.nextLink.addEvent('click',this.next.bind(this));this.bottomContainer=new Element('div',{'class':'lbBottomContainer','styles':{'display':'none','z-index':this.options.zIndex+1}}).injectInside(document.body);this.bottom=new Element('div',{'class':'lbBottom'}).injectInside(this.bottomContainer);new Element('a',{'class':'lbCloseLink','href':'#'}).injectInside(this.bottom).onclick=this.overlay.onclick=this.close.bind(this);this.caption=new Element('div',{'class':'lbCaption'}).injectInside(this.bottom);this.number=new Element('div',{'class':'lbNumber'}).injectInside(this.bottom);new Element('div',{'styles':{'clear':'both'}}).injectInside(this.bottom);var nextEffect=this.nextEffect.bind(this);this.fx={overlay:this.overlay.effect('opacity',{duration:500}).hide(),resize:this.center.effects($extend({duration:this.options.resizeDuration,onComplete:nextEffect},this.options.resizeTransition?{transition:this.options.resizeTransition}:{})),image:this.image.effect('opacity',{duration:500,onComplete:nextEffect}),bottom:this.bottom.effect('margin-top',{duration:400,onComplete:nextEffect})};this.preloadPrev=new Element('img');this.preloadNext=new Element('img')},addCss:function(){window.addEvent('domready',function(){if(!$('SlimboxCss'))new Asset.css(this.options.assetBaseUrl+'slimbox.css',{id:'SlimboxCss'})}.bind(this))},click:function(link){link=$(link);var rel=link.getProperty('rel')||this.options.relString;if(rel==this.options.relString)return this.show(link.href,link.title);var j,imageNum,images=[];this.anchors.each(function(el){if(el.getProperty('rel')==link.getProperty('rel')){for(j=0;j<images.length;j++)if(images[j][0]==el.href)break;if(j==images.length){images.push([el.href,el.title]);if(el.href==link.href)imageNum=j}}},this);return this.open(images,imageNum)},show:function(url,title){return this.open([[url,title]],0)},open:function(images,imageNum){this.fireEvent('onDisplay');this.images=images;this.position();this.setup(true);this.top=(window.getScrollTop()+(window.getHeight()/15)).toInt();this.center.setStyles({top:this.top+'px',display:''});this.fx.overlay.start(0.8);return this.changeImage(imageNum)},position:function(){this.overlay.setStyles({'top':window.getScrollTop()+'px','height':window.getHeight()+'px'})},setup:function(open){var elements=$$('object, iframe');elements.extend($$(window.ie?'select':'embed'));elements.each(function(el){if(open)el.lbBackupStyle=el.getStyle('visibility');var vis=(open?'hidden':el.lbBackupStyle);el.setStyle('visibility',vis)});var fn=open?'addEvent':'removeEvent';window[fn]('scroll',this.eventPosition)[fn]('resize',this.eventPosition);document[fn]('keydown',this.eventKeyDown);this.step=0},keyboardListener:function(event){switch(event.keyCode){case 27:case 88:case 67:this.close();break;case 37:case 80:this.previous();break;case 39:case 78:this.next()}},previous:function(){return this.changeImage(this.activeImage-1)},next:function(){return this.changeImage(this.activeImage+1)},changeImage:function(imageNum){this.fireEvent('onImageShow',imageNum);if(this.step||(imageNum<0)||(imageNum>=this.images.length))return false;this.step=1;this.activeImage=imageNum;this.center.setStyle('backgroundColor','');this.bottomContainer.setStyle('display','none');this.prevLink.setStyle('display','none');this.nextLink.setStyle('display','none');this.fx.image.hide();this.center.addClass('lbLoading');this.preload=new Element('img').addEvent('load',this.nextEffect.bind(this)).setProperty('src',this.images[imageNum][0]);return false},nextEffect:function(){switch(this.step++){case 1:this.image.setStyle('backgroundImage','url('+this.images[this.activeImage][0]+')');this.image.setStyle('width',this.preload.width+'px');this.bottom.setStyle('width',this.preload.width+'px');this.image.setStyle('height',this.preload.height+'px');this.prevLink.setStyle('height',this.preload.height+'px');this.nextLink.setStyle('height',this.preload.height+'px');this.caption.setHTML(this.images[this.activeImage][1]||'');this.number.setHTML((!this.options.showCounter||(this.images.length==1))?'':'Image '+(this.activeImage+1)+' of '+this.images.length);if(this.activeImage)$(this.preloadPrev).setProperty('src',this.images[this.activeImage-1][0]);if(this.activeImage!=(this.images.length-1))$(this.preloadNext).setProperty('src',this.images[this.activeImage+1][0]);if(this.center.clientHeight!=this.image.offsetHeight){this.fx.resize.start({height:this.image.offsetHeight});break}this.step++;case 2:if(this.center.clientWidth!=this.image.offsetWidth){this.fx.resize.start({width:this.image.offsetWidth,marginLeft:-this.image.offsetWidth/2});break}this.step++;case 3:this.bottomContainer.setStyles({top:(this.top+this.center.getSize().size.y)+'px',height:'0px',marginLeft:this.center.getStyle('margin-left'),display:''});this.fx.image.start(1);break;case 4:this.center.style.backgroundColor='#000';if(this.options.animateCaption){this.fx.bottom.set(-this.bottom.offsetHeight);this.bottomContainer.setStyle('height','');this.fx.bottom.start(0);break}this.bottomContainer.style.height='';case 5:if(this.activeImage)this.prevLink.setStyle('display','');if(this.activeImage!=(this.images.length-1))this.nextLink.setStyle('display','');this.step=0}},close:function(){this.fireEvent('onHide');if(this.step<0)return;this.step=-1;if(this.preload){this.preload.onload=Class.empty;this.preload=null}for(var f in this.fx)this.fx[f].stop();this.center.setStyle('display','none');this.bottomContainer.setStyle('display','none');this.fx.overlay.chain(this.setup.pass(false,this)).start(0);return}});Lightbox.implement(new Options);Lightbox.implement(new Events);window.addEvent('domready',function(){new Lightbox()});var SimpleEditor=new Class({initialize:function(input,buttons,commands){this.commands=new Hash($merge(SimpleEditor.commands,commands||{}));this.input=$(input);this.buttons=$$(buttons);this.buttons.each(function(button){button.addEvent('click',function(){this.exec(button.getProperty('rel'))}.bind(this))}.bind(this));this.input.addEvent('keydown',function(e){e=new Event(e);if(e.control){var key=this.shortCutToKey(e.key);if(key){e.stop();this.exec(key)}}}.bind(this))},shortCutToKey:function(shortcut){var returnKey=false;this.commands.each(function(value,key){if(value.shortcut==shortcut)returnKey=key});return returnKey},addCommand:function(key,command,shortcut){this.commands.set(key,{command:command,shortcut:shortcut})},addCommands:function(commands){this.commands.extend(commands)},exec:function(key){var currentScrollPos;if(this.input.scrollTop||this.input.scrollLeft){currentScrollPos={scrollTop:this.input.scrollTop,scrollLeft:this.input.scrollLeft}}if(this.commands.hasKey(key))this.commands.get(key).command(this.input);if(currentScrollPos){this.input.scrollTop=currentScrollPos.scrollTop;this.input.scrollLeft=currentScrollPos.scrollLeft}}});$extend(SimpleEditor,{commands:{},addCommand:function(key,command,shortcut){SimpleEditor.commands[key]={command:command,shortcut:shortcut}},addCommands:function(commands){$extend(SimpleEditor.commands,commands)}});SimpleEditor.addCommands({bold:{shortcut:'b',command:function(input){input.insertAroundCursor({before:'<b>',after:'</b>'})}},underline:{shortcut:'u',command:function(input){input.insertAroundCursor({before:'<u>',after:'</u>'})}},anchor:{shortcut:'l',command:function(input){function simpleLinker(){if(window.TagMaker){if(!this.linkBuilder)this.linkBuilder=new TagMaker.anchor();this.linkBuilder.prompt(input)}else{var href=window.prompt('The URL for the link');var opts={before:'<a href="'+href+'">',after:'</a>'};if(!input.getSelectedText())opts.defaultMiddle=window.prompt('The link text');input.insertAroundCursor(opts)}}try{if(Trinket){if(!this.linkBulder){var lb=Trinket.available.filter(function(trinket){return trinket.name=='Link Builder'});this.linkBuilder=(lb.length)?lb[0]:new Trinket.LinkBuilder({context:'default'});this.linkBuilder.clickPrompt(input)}}else simpleLinker()}catch(e){simpleLinker()}}},copy:{shortcut:false,command:function(input){if(Clipboard)Clipboard.copyFromElement(input);else simpleErrorPopup('Woops','Sorry, this function doesn\'t work here; use ctrl+c.');input.focus()}},cut:{shortcut:false,command:function(input){if(Clipboard){Clipboard.copyFromElement(input);input.insertAtCursor('')}else simpleErrorPopup('Woops','Sorry, this function doesn\'t work here; use ctrl+x.')}},hr:{shortcut:'-',command:function(input){input.insertAtCursor('\n<hr/>\n')}},img:{shortcut:'g',command:function(input){if(window.TagMaker){if(!this.anchorBuilder)this.anchorBuilder=new TagMaker.image();this.anchorBuilder.prompt(input)}else{input.insertAtCursor('<img src="'+window.prompt('The url to the image')+'" />')}}},stripTags:{shortcut:'\\',command:function(input){input.insertAtCursor(input.getSelectedText().stripTags())}},sup:{shortcut:false,command:function(input){input.insertAroundCursor({before:'<sup>',after:'</sup>'})}},sub:{shortcut:false,command:function(input){input.insertAroundCursor({before:'<sub>',after:'</sub>'})}},paragraph:{shortcut:'enter',command:function(input){input.insertAroundCursor({before:'\n<p>\n',after:'\n</p>\n'})}},strike:{shortcut:'k',command:function(input){input.insertAroundCursor({before:'<strike>',after:'</strike>'})}},italics:{shortcut:'i',command:function(input){input.insertAroundCursor({before:'<i>',after:'</i>'})}},bullets:{shortcut:'8',command:function(input){input.insertAroundCursor({before:'<ul>\n	<li>',after:'</li>\n</ul>'})}},numberList:{shortcut:'=',command:function(input){input.insertAroundCursor({before:'<ol>\n	<li>',after:'</li>\n</ol>'})}},clean:{shortcut:false,command:function(input){input.tidy()}},preview:{shortcut:false,command:function(input){try{if(!this.container){this.container=new Element('div',{styles:{border:'1px solid black',padding:8,height:300,overflow:'auto'}});this.preview=new StickyWinModal({content:stickyWinHTML("preview",this.container,{width:600,buttons:[{text:'close',onClick:function(){this.container.empty()}.bind(this)}]}),showNow:false})}this.container.setHTML(input.getValue());this.preview.show()}catch(e){dbug.log('you need StickyWinModal and stickyWinHTML')}}}});var CNETAPI=new Class({initialize:function(partKey,url){CNETAPI.url=url||CNETAPI.url;CNETAPI.partKey=null;CNETAPI.partTag=null;if(Number(partKey))CNETAPI.partKey=partKey;else CNETAPI.partTag=partKey}});CNETAPI.url='http://api.cnet.com/restApi/v1.0';CNETAPI.Utils={};CNETAPI.Utils.Base=new Class({options:{jsonpOptions:{data:{viewType:'json'}},onComplete:Class.empty,onSuccess:Class.empty,onError:Class.empty,instantiateResults:false,resultClass:null,errorPath:'CNETResponse.Error.ErrorMessage.$'},initialize:function(options){this.setOptions($merge({jsonpOptions:{data:{partKey:CNETAPI.partKey,partTag:CNETAPI.partTag}}},options))},getQuery:function(url,options){options.data=options.data||{};$each(options.data,function(val,key){options.data[key]=$type(val)=="string"?unescape(val):val});var j=new JsonP(url||"",options);return j},packer:function(results){if($type(results)=="array")results=results.filter(function(result){return result});else if(results)results=[results];else results=[];if(this.options.instantiateResults&&this.options.resultClass){return results.map(function(obj){return new this.options.resultClass(obj)},this)}else{return results}},getMemberByPath:function(obj,path){if(path===""||path=="top"||!path)return obj;var member=obj;path.split(".").each(function(p){if(p==="")return;if(member[p])member=member[p];else member=obj},this);return(member==obj)?false:member},handleApiResults:function(obj,path){var error=this.getMemberByPath(obj,this.options.errorPath);return(error)?error:this.getMemberByPath(obj,path)},request:function(jsonData,urlSuffix,path){var jsonpOptions=$merge(this.options.jsonpOptions,{data:jsonData});var query=this.getQuery(CNETAPI.url+urlSuffix,jsonpOptions);query.addEvent('onComplete',function(results){results=this.handleApiResults(results,path);if($type(results)=="string"){dbug.log('CNET API Error: ',results);this.fireEvent('onError',[results,query,this])}else{this.fireEvent('onSuccess',[this.packer(results),query,this])}this.fireEvent('onComplete',[this.packer(results),query,this])}.bind(this));query.request();return this},throwErr:function(msg){function err(message){this.message=message;this.name="CNETAPI.Utils Exception:"};err.prototype.toString=function(){return this.name+': "'+this.message+'"'};throw new err(msg);}});CNETAPI.Utils.Base.implement(new Options,new Events);CNETAPI.Object=new Class({options:{onSuccess:Class.empty,onError:Class.empty,extraLookupData:{},type:""},ready:false,initialize:function(item,options){this.setOptions(options);this.type=this.options.type;item=($type(item)=="array"&&item.length==1)?item[0]:item;if(!item)return;if($type(item)=="object")this.parseData(item);else if($type(item)=="number")this.get(item);return},get:function(id){try{this.makeLookup().get(id)}catch(e){var msg='Error: error on GET: ';dbug.log(msg,e);this.fireEvent('onError',msg+e.message)}},process:function(obj){var data={};$H(obj).each(function(value,key){key=this.cleanKey(key);switch($type(value)){case"array":data[key]=value.map(function(v){return this.clean(v,key,key)},this);break;default:data[key]=this.clean(value,key,key)}},this);return data},cleanKey:function(key){return($type(key)=="string"&&key.test("^@"))?key.substring(1):key},clean:function(value,name,path){switch($type(value)){case"string":if(value=="false")value=false;if(value=="true")value=true;if($chk(Number(value)))value=Number(value);return value;case"function":return value;case"array":return value.map(function(v,i){return this.clean(v,i,path+'.'+name)},this);break;default:var vhash=$H(value);if(value.$&&vhash.length==1){return value.$}else{var cleaned={};vhash.each(function(value,key){key=this.cleanKey(key);if($type(value)=="object"&&value.$&&key.test("url","i")&&value.$.test("restApi")){cleaned.walk=cleaned.walk||{};cleaned.walk[key]=this.follow.pass([value.$,key,path],this)}cleaned[key]=this.clean(value,key,path+'.'+name)},this);return cleaned}}return this},makeLookup:function(){return new CNETAPI.Utils[this.options.type]($merge(this.options.extraLookupData,{instantiateResults:false,onError:this.handleError.bind(this),onSuccess:this.parseData.bind(this)}))},handleError:function(msg){this.fireEvent('onError',msg)},parseData:function(data){data=($type(data)=="array"&&data.length==1)?data[0]:data;this.json=data;this.data=this.process(data);this.ready=true;this.callChain();this.fireEvent('onSuccess',[this,this.data,this.json])},follow:function(value,name,path){dbug.log(name,value,path)}});CNETAPI.Object.implement(new Options,new Events,new Chain);CNETAPI.TechProduct=CNETAPI.Object.extend({options:{type:"TechProduct"}});CNETAPI.SoftwareProduct=CNETAPI.Object.extend({options:{type:"SoftwareProduct"},getSet:function(id){try{this.makeLookup().getSet(id)}catch(e){var msg='Error: error on getSet: ';dbug.log(msg,e);this.fireEvent('onError',msg+e.message)}}});CNETAPI.Category=CNETAPI.Object.extend({options:{type:"Category",siteId:null},initialize:function(item,options){this.children=[];if(options)this.setSiteId(options.siteId);this.parent(item,options)},setSiteId:function(id){this.setOptions({extraLookupData:{siteId:$chk(id)?id:this.options.siteId}});return this.options.extraLookupData.siteId},getChildren:function(options,data){var onSuccess=function(data){this.children=data.map(function(d){d.options.siteId=siteId;return d});this.callChain()}.bind(this);if(this.data.isLeaf){onSuccess([]);return this}options=options||{};var siteId=this.setSiteId(options.siteId);if(!$chk(siteId)){var msg='Error: you must supply a site id for category lookups.';dbug.log(msg);this.fireEvent('onError',msg);return null}else if(this.data.id){var util=new CNETAPI.Utils[this.options.type]($merge({instantiateResults:true,resultClass:CNETAPI.Category},options)).addEvent('onSuccess',onSuccess);util.getChildren(this.data.id,$merge(this.options.extraLookupData,data||{}));return this}else{return null}return this}});CNETAPI.NewsStory=CNETAPI.Object.extend({options:{type:"NewsStory"}});CNETAPI.NewsGallery=CNETAPI.Object.extend({options:{type:"NewsGallery"}});CNETAPI.Utils.SearchPaths={TechProduct:"/techProductSearch",NewsGallery:"/newsGallerySearch",NewsStory:"/newsStorySearch",SoftwareProduct:"/softwareProductSearch"};CNETAPI.Utils.TechProduct=CNETAPI.Utils.Base.extend({options:{resultClass:CNETAPI.TechProduct,instantiateResults:true,searchPath:CNETAPI.Utils.SearchPaths['TechProduct']},search:function(queryTerm,data){return this.request($merge({query:queryTerm},data),this.options.searchPath,"CNETResponse.TechProducts.TechProduct")},get:function(id,data){return this.request($merge({productId:id},data),"/techProduct","CNETResponse.TechProduct")}});CNETAPI.Utils.SoftwareProduct=CNETAPI.Utils.Base.extend({options:{resultClass:CNETAPI.SoftwareProduct,instantiateResults:true,searchPath:CNETAPI.Utils.SearchPaths['SoftwareProduct']},search:function(queryTerm,data){return this.request($merge({query:queryTerm},data),this.options.searchPath,"CNETResponse.SoftwareProducts.SoftwareProduct")},getSet:function(id,data){return this.request($merge({productSetId:id},data),"/softwareProduct","CNETResponse.SoftwareProduct")},get:function(id,data){return this.request($merge({productId:id},data),"/softwareProduct","CNETResponse.SoftwareProduct")}});CNETAPI.Utils.NewsStory=CNETAPI.Utils.Base.extend({options:{resultClass:CNETAPI.NewsStory,instantiateResults:true,searchPath:CNETAPI.Utils.SearchPaths['NewsStory']},search:function(queryTerm,data){return this.request($merge({query:queryTerm},data),this.options.searchPath,"CNETResponse.NewsStories.NewsStory")},get:function(id,data){return this.request($merge({storyId:id},data),this.options.searchPath,"CNETResponse.NewsStory")}});CNETAPI.Utils.NewsGallery=CNETAPI.Utils.Base.extend({options:{resultClass:CNETAPI.NewsGallery,instantiateResults:true,searchPath:CNETAPI.Utils.SearchPaths['NewsGallery']},search:function(queryTerm,data){return this.request($merge({query:queryTerm},data),this.options.searchPath,"CNETResponse.NewsStories.NewsStory")},get:function(id,data){return this.request($merge({galleryId:id},data),this.options.searchPath,"CNETResponse.NewsStory")}});CNETAPI.Utils.Category=CNETAPI.Utils.Base.extend({options:{resultClass:CNETAPI.Category,instantiateResults:true,siteId:null,searchPath:CNETAPI.Utils.SearchPaths['TechProduct']},packer:function(results){results=this.parent(results);return results.map(function(cat){cat.options.siteId=this.options.siteId;return cat},this)},get:function(id,data){data=data||{};data.siteId=data.siteId||this.options.siteId;if(!$chk(data.siteId)){dbug.log("You must supply a site id for category lookups");this.throwErr("You must supply a site id for category lookups");}this.options.siteId=data.siteId;return this.request($merge({categoryId:id},data),"/category","CNETResponse.Category")},getChildren:function(id,data){data=data||{};data.siteId=data.siteId||this.options.siteId;if(!$chk(data.siteId)){dbug.log("You must supply a site id for category lookups");this.throwErr("You must supply a site id for category lookups");}return this.request($chk(id)?$merge({categoryId:id},data):data,"/childCategories","CNETResponse.ChildCategories.Category")},search:function(queryTerm,type,data){data=$merge({results:1,iod:'relatedCats'},data);return this.request($merge({query:queryTerm},data),type||this.options.searchPath,"CNETResponse.RelatedCategories")}});function setCNETAssetBaseHref(baseHref){if(typeof stickyWinHtml!="undefined"){var CGFstickyWinHTML=stickyWinHTML.bind(window);stickyWinHTML=function(caption,body,options){return CGFstickyWinHTML(caption,body,$merge({baseHref:baseHref+'/stickyWinHTML/'},options))}}if(typeof TagMaker!="undefined"){TagMaker=TagMaker.extend({options:{baseHref:baseHref+'/tips/'}})}if(typeof simpleErrorPopup!="undefined"){var CGFsimpleErrorPopup=simpleErrorPopup.bind(window);simpleErrorPopup=function(msghdr,msg,baseHref){return CGFsimpleErrorPopup(msghdr,msg,baseHref||baseHref+"/simple.error.popup")}}if(typeof DatePicker!="undefined"){DatePicker=DatePicker.extend({options:{baseHref:baseHref}})}if(typeof ProductPicker!="undefined"){ProductPicker=ProductPicker.extend({options:{baseHref:baseHref+'/Picker'}})}if(typeof Autocompleter!="undefined"){Autocompleter.Base=Autocompleter.Base.extend({options:{baseHref:baseHref+'/autocompleter/'}})}if(typeof Lightbox!="undefined"){Lightbox=Lightbox.extend({options:{assetBaseUrl:baseHref+'/slimbox/'}})}};

/*	end packed code	*/
}